<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Waiting For You">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://WFUing.github.io//">
    <meta property="twitter:image" content="https://WFUing.github.io//" />
    

    
    <meta name="title" content="akka框架" />
    <meta property="og:title" content="akka框架" />
    <meta property="twitter:title" content="akka框架" />
    

    
    <meta name="description" content="这是一个纯粹的博客......">
    <meta property="og:description" content="这是一个纯粹的博客......" />
    <meta property="twitter:description" content="这是一个纯粹的博客......" />
    

    
    <meta property="twitter:card" content="Akka 是一个开源项目，基于 Apache 2 License。AKKA框架是用Scala写的，主要用于高并发与分布式应用，目前已经得到广泛地运用，例如Spark、Spray等框架在底层都使用了AKKA进行并发处理。" />
    
    

    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>akka框架 | </title>

    <link rel="canonical" href="/posts/tech/architecture/iot/akka/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="/css/font-awesome.all.min.css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>






<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Waiting For You</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">All Posts</a>
                    </li>
                    
                        
                    
                    
		    
		            <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/akka" title="akka">
                            akka
                        </a>
                        
                    </div>
                    <h1>akka框架</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                    Waiting For You
                             
                            on 
                            Friday, October 27, 2023
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <p>Akka可以在这里找到指定版本的下载链接： <a href="http://akka.io/downloads">http://akka.io/downloads</a>。</p>
<p>所有的示例代码都是编译通过的，如果想要查看源码，请查看 Akka 文档在 Github 上子项目，包含 <a href="https://github.com/akka/akka/tree/v2.4.17/akka-docs/rst/java/code/docs">Java</a> 和 <a href="https://github.com/akka/akka/tree/v2.4.17/akka-docs/rst/scala/code/docs">Scala</a> 两个部分。本教程主要是 Akka 的 Java 部分。</p>
<h2 id="actor-system">Actor System</h2>
<p>使用 Akka 可以让你从为 Actor 系统创建基础设施和编写控制基本行为所需的初级（<code>low-level</code>）代码中解脱出来。为了理解这一点，让我们看看你在代码中创建的 Actor 与 Akka 在内部为你创建和管理的 Actor 之间的关系，Actor 的生命周期和失败处理。</p>
<p>在你的项目中添加如下依赖：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- Maven --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>com.typesafe.akka<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>akka-actor_2.11<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>2.5.19<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- Gradle --&gt;</span>
</span></span><span class="line"><span class="cl">dependencies {
</span></span><span class="line"><span class="cl">  compile group: &#39;com.typesafe.akka&#39;, name: &#39;akka-actor_2.11&#39;, version: &#39;2.5.19&#39;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- sbt --&gt;</span>
</span></span><span class="line"><span class="cl">libraryDependencies += &#34;com.typesafe.akka&#34; %% &#34;akka-actor&#34; % &#34;2.5.19&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="akka-的-actor-层级">Akka 的 Actor 层级</h3>
<p>Akka 的 Actor 总是属于父 Actor。通常，你可以通过调用<code>getContext().actorOf()</code>来创建 Actor。与创建一个&quot;独立的&quot; Actor 不同，这会将新 Actor 作为一个子节点注入到已经存在的树中：创建 Actor 的 Actor 成为新创建的子 Actor 的父级。你可能会问，你创造的第一个 Actor 的父节点是谁？</p>
<p>如下图所示，所有的 Actor 都有一个共同的父节点，即用户守护者。可以使用<code>system.actorOf()</code>在当前 Actor 下创建新的 Actor 实例。正如我们在「<a href="https://github.com/guobinhit/akka-guide/blob/master/articles/qucikstart-akka-java.md">快速入门 Akka Java 指南</a>」中介绍的那样，创建 Actor 将返回一个有效的 URL 引用。例如，如果我们用<code>system.actorOf(…, &quot;someActor&quot;)</code>创建一个名为<code>someActor</code>的 Actor，它的引用将包括路径<code>/user/someActor</code>。</p>
<center>
<link rel="stylesheet" href="/css/hugo-easy-gallery.css" />
<div class="box" style="max-width:70%">
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="/actor-hierarchy.png" />
    </div>
    <a href="./actor-hierarchy.png" itemprop="contentUrl"></a>
      <figcaption align="center"><h4>Part 1: Actor Architecture</h4>
      </figcaption>
  </figure>
</div>
</center>
<p>事实上，在你在代码中创建 Actor 之前，Akka 已经在系统中创建了三个 Actor 。这些内置的 Actor 的名字包含<code>guardian</code>，因为他们守护他们所在路径下的每一个子 Actor。守护者 Actor 包括：</p>
<ul>
<li>
<p><code>/</code>，根守护者（<code>root guardian</code>）。这是系统中所有 Actor 的父 Actor，也是系统本身终止时要停止的最后一个 Actor。</p>
</li>
<li>
<p><code>/user</code>，守护者（<code>guardian</code>）。这是用户创建的所有 Actor 的父 Actor。不要让用户名混淆，它与最终用户和用户处理无关。使用 Akka 库创建的每个 Actor 都将有一个事先准备的固定路径<code>/user/</code>。</p>
</li>
<li>
<p><code>/system</code>，系统守护者（<code>system guardian</code>）。这是除上述三个 Actor 外，系统创建的所有 Actor 的父 Actor，</p>
</li>
</ul>
<p>在<code>Hello World</code>示例中，我们已经看到<code>system.actorOf()</code>如何直接在<code>/user</code>下创建 Actor。我们称之为顶级 Actor，尽管实际上它只是在用户定义的层次结构的顶部。你的<code>ActorSystem</code>中通常只有一个（或极少数）顶级 Actor。我们通过从现有的 Actor 调用<code>context.actorOf()</code>来创建子 Actor 或非顶级 Actor。<code>context.actorOf()</code>方法具有与<code>system.actorOf()</code>相同的签名，后者是其对应的顶级。</p>
<p>查看 Actor 层次结构的最简单方法是打印<code>ActorRef</code>实例。在这个小实验中，我们创建了一个 Actor，打印了它的引用，创建了这个 Actor 的一个子 Actor，并打印了这个子 Actor 的引用。我们从<code>Hello World</code>项目开始，如果你还没有下载它，请从「<a href="https://developer.lightbend.com/start/?group=akka&amp;project=akka-quickstart-java">Lightbend Tech Hub</a>」下载 QuickStart 项目。</p>
<p>在你的<code>Hello World</code>项目中，导航到<code>com.example</code>包并创建一个新的名为<code>ActorHierarchyExperiments.java</code>的 Java 文件。将下面代码段中的代码复制并粘贴到此新源文件中。保存文件并运行<code>sbt &quot;runMain com.example.ActorHierarchyExperiments&quot;</code>来观察输出。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">akka.actor.AbstractActor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">akka.actor.AbstractActor.Receive</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">akka.actor.ActorRef</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">akka.actor.ActorSystem</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">akka.actor.Props</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActorHierarchyExperiments</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ActorSystem</span> <span class="n">system</span> <span class="o">=</span> <span class="n">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&#34;testSystem&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ActorRef</span> <span class="n">firstRef</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="na">actorOf</span><span class="o">(</span><span class="n">PrintMyActorRefActor</span><span class="o">.</span><span class="na">props</span><span class="o">(),</span> <span class="s">&#34;first-actor&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;First: &#34;</span> <span class="o">+</span> <span class="n">firstRef</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">firstRef</span><span class="o">.</span><span class="na">tell</span><span class="o">(</span><span class="s">&#34;printit&#34;</span><span class="o">,</span> <span class="n">ActorRef</span><span class="o">.</span><span class="na">noSender</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;&gt;&gt;&gt; Press ENTER to exit &lt;&lt;&lt;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">system</span><span class="o">.</span><span class="na">terminate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">PrintMyActorRefActor</span> <span class="kd">extends</span> <span class="n">AbstractActor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="n">Props</span> <span class="nf">props</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Props</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">PrintMyActorRefActor</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">PrintMyActorRefActor</span><span class="o">::</span><span class="k">new</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Receive</span> <span class="nf">createReceive</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">matchEquals</span><span class="o">(</span><span class="s">&#34;printit&#34;</span><span class="o">,</span> <span class="n">p</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">ActorRef</span> <span class="n">secondRef</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">().</span><span class="na">actorOf</span><span class="o">(</span><span class="n">Props</span><span class="o">.</span><span class="na">empty</span><span class="o">(),</span> <span class="s">&#34;second-actor&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Second: &#34;</span> <span class="o">+</span> <span class="n">secondRef</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意信息要求第一个 Actor 完成工作的方式。我们使用父 Actor 的引用<code>firstRef.tell(&quot;printit&quot;, ActorRef.noSender())</code>发送消息。当代码执行时，输出包括第一个 Actor 的引用，以及匹配<code>printit</code>模式时创建的子 Actor 的引用。你的输出应该与下面的内容相似：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">First: Actor[akka://testSystem/user/first-actor#1053618476]
</span></span><span class="line"><span class="cl">Second: Actor[akka://testSystem/user/first-actor/second-actor#-1544706041]
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意 Actor 引用的结构：</p>
<ul>
<li>两条路径都以<code>akka://testSystem/</code>开头。因为所有 Actor 的引用都是有效的 URL，所以<code>akka://</code>是协议字段的值。</li>
<li>接下来，就像在万维网（<code>World Wide Web</code>）上一样，URL 标识系统。在本例中，系统名为<code>testSystem</code>，但它可以是任何其他名称。如果启用了多个系统之间的远程通信，则 URL 的这一部分包括主机名，以便其他系统可以在网络上找到它。</li>
<li>因为第二个 Actor 的引用包含路径<code>/first-actor/</code>，这个标识它为第一个 Actor 的子 Actor。</li>
<li>Actor 引用的最后一部分，即<code>#1053618476</code>或<code>#-1544706041</code>是一个在大多数情况下可以忽略的唯一标识符。</li>
</ul>
<p>既然你了解了 Actor 层次结构的样子，你可能会想：为什么我们需要这个层次结构？它是用来干什么的？</p>
<p>层次结构的一个重要作用是安全地管理 Actor 的生命周期。接下来，我们来考虑一下，这些知识如何帮助我们编写更好的代码。</p>
<h3 id="actor-的生命周期">Actor 的生命周期</h3>
<p>Actor 在被创建时就会出现，然后在用户请求时被停止。每当一个 Actor 被停止时，它的所有子 Actor 也会被递归地停止。这种行为大大简化了资源清理，并有助于避免诸如由打开的套接字和文件引起的资源泄漏。事实上，在处理初级多线程代码时，一个通常被忽视的困难是各种并发资源的生命周期管理。</p>
<p>要停止 Actor，建议的模式是调用 Actor 内部的<code>getContext().stop(getSelf())</code>来停止自身，通常是对某些用户定义的停止消息的响应，或者当 Actor 完成其任务时。从技术上讲，通过调用<code>getContext().stop(actorRef)</code>是可以停止另一个 Actor 的，但通过这种方式停止任意的 Actor 被认为是一种糟糕的做法：<strong>停止 Actor 的一个比较好的方法是，尝试向他们发送一个&quot;毒丸（<code>PoisonPill</code>）&ldquo;或自定义的停止消息</strong>。</p>
<p>Akka Actor 的 API 暴露了许多生命周期的钩子，你可以在 Actor 的实现中覆盖这些钩子。最常用的是<code>preStart()</code>和<code>postStop()</code>方法。</p>
<ul>
<li><code>preStart()</code>在 Actor 启动之后但在处理其第一条消息之前调用。</li>
<li><code>postStop()</code>在 Actor 停止之前调用，在此时之后将不再处理任何消息。</li>
</ul>
<p>让我们在一个简单的实验中使用生命周期中的<code>preStart()</code>和<code>postStop()</code>钩子来观察停止一个 Actor 时的行为。首先，将以下两个 Actor 类添加到项目中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">StartStopActor1</span> <span class="kd">extends</span> <span class="n">AbstractActor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="n">Props</span> <span class="nf">props</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Props</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">StartStopActor1</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">StartStopActor1</span><span class="o">::</span><span class="k">new</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preStart</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;first started&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">getContext</span><span class="o">().</span><span class="na">actorOf</span><span class="o">(</span><span class="n">StartStopActor2</span><span class="o">.</span><span class="na">props</span><span class="o">(),</span> <span class="s">&#34;second&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postStop</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;first stopped&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Receive</span> <span class="nf">createReceive</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">matchEquals</span><span class="o">(</span><span class="s">&#34;stop&#34;</span><span class="o">,</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">getContext</span><span class="o">().</span><span class="na">stop</span><span class="o">(</span><span class="n">getSelf</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">StartStopActor2</span> <span class="kd">extends</span> <span class="n">AbstractActor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="n">Props</span> <span class="nf">props</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Props</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">StartStopActor2</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">StartStopActor2</span><span class="o">::</span><span class="k">new</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preStart</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;second started&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postStop</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;second stopped&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Actor.emptyBehavior is a useful placeholder when we don&#39;t
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// want to handle any messages in the actor.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Receive</span> <span class="nf">createReceive</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来，创建一个主函数来启动 Actors，然后向他们发送<code>stop</code>消息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ActorRef</span> <span class="n">first</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="na">actorOf</span><span class="o">(</span><span class="n">StartStopActor1</span><span class="o">.</span><span class="na">props</span><span class="o">(),</span> <span class="s">&#34;first&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">first</span><span class="o">.</span><span class="na">tell</span><span class="o">(</span><span class="s">&#34;stop&#34;</span><span class="o">,</span> <span class="n">ActorRef</span><span class="o">.</span><span class="na">noSender</span><span class="o">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>你可以再次使用<code>sbt</code>命令来启动这个项目，其输出结果应该如下面这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">first started
</span></span><span class="line"><span class="cl">second started
</span></span><span class="line"><span class="cl">second stopped
</span></span><span class="line"><span class="cl">first stopped
</span></span></code></pre></td></tr></table>
</div>
</div><p>当我们停止<code>first</code> Actor 时，它会在停止自身之前，先停止了它的子 Actor <code>second</code>。这个顺序是严格的，在调用父 Actor 的<code>postStop()</code>钩子之前，会先调用所有子 Actor 的<code>postStop()</code>钩子。</p>
<p>在 Akka 参考手册的「<a href="https://doc.akka.io/docs/akka/current/actors.html#actor-lifecycle">Actor Lifecycle</a>」部分提供了关于 Actor 的全套生命周期钩子的详细信息。</p>
<h3 id="失败处理">失败处理</h3>
<p>父 Actor 和子 Actor 在他们的生命周期中是相互联系的。当一个 Actor 失败（抛出一个异常或从接收中冒出一个未处理的异常）时，它将暂时挂起。如前所述，失败信息被传播到父 Actor，然后父 Actor 决定如何处理由子 Actor 引起的异常。这样，父 Actor 就可以作为子 Actor 的监督者（<code>supervisors</code>）。默认的监督策略是停止并重新启动子 Actor。如果不更改默认策略，所有失败都会导致重新启动。</p>
<p>让我们在一个简单的实验中观察默认策略。将下面的类添加到项目中，就像之前的类一样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">SupervisingActor</span> <span class="kd">extends</span> <span class="n">AbstractActor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="n">Props</span> <span class="nf">props</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Props</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">SupervisingActor</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">SupervisingActor</span><span class="o">::</span><span class="k">new</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">ActorRef</span> <span class="n">child</span> <span class="o">=</span> <span class="n">getContext</span><span class="o">().</span><span class="na">actorOf</span><span class="o">(</span><span class="n">SupervisedActor</span><span class="o">.</span><span class="na">props</span><span class="o">(),</span> <span class="s">&#34;supervised-actor&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Receive</span> <span class="nf">createReceive</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">matchEquals</span><span class="o">(</span><span class="s">&#34;failChild&#34;</span><span class="o">,</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">child</span><span class="o">.</span><span class="na">tell</span><span class="o">(</span><span class="s">&#34;fail&#34;</span><span class="o">,</span> <span class="n">getSelf</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">SupervisedActor</span> <span class="kd">extends</span> <span class="n">AbstractActor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="n">Props</span> <span class="nf">props</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Props</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">SupervisedActor</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">SupervisedActor</span><span class="o">::</span><span class="k">new</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preStart</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;supervised actor started&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postStop</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;supervised actor stopped&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Receive</span> <span class="nf">createReceive</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">receiveBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">matchEquals</span><span class="o">(</span><span class="s">&#34;fail&#34;</span><span class="o">,</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;supervised actor fails now&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&#34;I failed!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">})</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后运行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ActorRef</span> <span class="n">supervisingActor</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="na">actorOf</span><span class="o">(</span><span class="n">SupervisingActor</span><span class="o">.</span><span class="na">props</span><span class="o">(),</span> <span class="s">&#34;supervising-actor&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">supervisingActor</span><span class="o">.</span><span class="na">tell</span><span class="o">(</span><span class="s">&#34;failChild&#34;</span><span class="o">,</span> <span class="n">ActorRef</span><span class="o">.</span><span class="na">noSender</span><span class="o">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>你应该看到类似如下的输出结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">supervised actor started
</span></span><span class="line"><span class="cl">supervised actor fails now
</span></span><span class="line"><span class="cl">supervised actor stopped
</span></span><span class="line"><span class="cl">supervised actor started
</span></span><span class="line"><span class="cl">[ERROR] [03/29/2017 10:47:14.150] [testSystem-akka.actor.default-dispatcher-2] [akka://testSystem/user/supervising-actor/supervised-actor] I failed!
</span></span><span class="line"><span class="cl">java.lang.Exception: I failed!
</span></span><span class="line"><span class="cl">        at tutorial_1.SupervisedActor$$anonfun$receive$4.applyOrElse(ActorHierarchyExperiments.scala:57)
</span></span><span class="line"><span class="cl">        at akka.actor.Actor$class.aroundReceive(Actor.scala:513)
</span></span><span class="line"><span class="cl">        at tutorial_1.SupervisedActor.aroundReceive(ActorHierarchyExperiments.scala:47)
</span></span><span class="line"><span class="cl">        at akka.actor.ActorCell.receiveMessage(ActorCell.scala:519)
</span></span><span class="line"><span class="cl">        at akka.actor.ActorCell.invoke(ActorCell.scala:488)
</span></span><span class="line"><span class="cl">        at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:257)
</span></span><span class="line"><span class="cl">        at akka.dispatch.Mailbox.run(Mailbox.scala:224)
</span></span><span class="line"><span class="cl">        at akka.dispatch.Mailbox.exec(Mailbox.scala:234)
</span></span><span class="line"><span class="cl">        at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
</span></span><span class="line"><span class="cl">        at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
</span></span><span class="line"><span class="cl">        at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
</span></span><span class="line"><span class="cl">        at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们看到失败后，被监督的 Actor 停止并立即重新启动。我们还看到一个日志条目，报告处理的异常，在本例中是我们的测试异常。在这个例子中，我们使用了<code>preStart()</code>和<code>postStop()</code>钩子，这是重启后和重启前默认调用的钩子，因此我们无法区分 Actor 内部是第一次启动还是重启。这通常是正确的做法，重新启动的目的是将 Actor 设置为已知的良好状态，这通常意味着一个干净的开始阶段。实际上，在重新启动时，调用的是<code>preRestart()</code>和<code>postRestart()</code>方法，但如果不重写这两个方法，则默认分别委托给<code>postStop()</code>和<code>preStart()</code>。你可以尝试重写这些附加方法，并查看输出是如何变化的。</p>
<p>无论如何，我们还是建议查看「<a href="https://github.com/guobinhit/akka-guide/blob/master/articles/general-concepts/supervision.md">监督和监控</a>」，以了解更深入的细节。</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://gitter.im/akka/akka?source=orgpage">Gitter Chat</a>，Akka 在线交流平台；</li>
<li><a href="https://discuss.lightbend.com/c/akka/">Akka Forums</a>，Akka 论坛；</li>
<li><a href="https://github.com/akka/akka">Akka in GitHub</a>，Akka 开源项目仓库；</li>
<li><a href="https://akka.io/">Akka Official Website</a>，Akka 官网；</li>
<li><a href="https://doc.akka.io/japi/akka/2.6/overview-summary.html">Akka Java API</a>，Akka 应用程序编程接口。</li>
<li>快速入门指南
<ul>
<li><a href="https://github.com/guobinhit/akka-guide/blob/master/articles/qucikstart-akka-java.md">快速入门 Akka Java 指南</a></li>
<li><a href="https://developer.lightbend.com/guides/akka-quickstart-scala/">快速入门 Akka Scala 指南</a></li>
</ul>
</li>
<li>gitbook
<ul>
<li><a href="https://zhangyi.gitbooks.io/akka-in-action/content/actor_system.html">https://zhangyi.gitbooks.io/akka-in-action/content/actor_system.html</a></li>
<li><a href="https://guobinhit.github.io/akka-guide/">https://guobinhit.github.io/akka-guide/</a></li>
</ul>
</li>
</ul>


                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/posts/tech/architecture/iot/state-machine/" data-toggle="tooltip" data-placement="top" title="State Machine">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/posts/tech/architecture/iot/reactive-manifesto/" data-toggle="tooltip" data-placement="top" title="响应式宣言(Reactive Manifesto)">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

                



            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    
                    
                    
                    

		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Waiting For You 2023
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
