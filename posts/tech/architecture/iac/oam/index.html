<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Open Application Model | Waiting For You</title>
<meta name="keywords" content="oam">
<meta name="description" content="Open Application Model 的目标是定义一种标准的、与基础设施无关的方法，用于描述跨混合环境、云甚至边缘设备的应用部署。该模型要解决的核心问题是如何组成分布式应用程序，然后成功地将其交给负责操作的人员。问题不在于如何编写程序，而在于如何采用面向服务（或面向微服务）架构的组件，并简化围绕此类应用的工作流程。">
<meta name="author" content="WFUing">
<link rel="canonical" href="https://WFUing.github.io/posts/tech/architecture/iac/oam/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.4826a65311a560dd509e51c68a8ba0b686724e899e3dd2073a0aabed6d1af607.css" integrity="sha256-SCamUxGlYN1QnlHGiougtoZyTomePdIHOgqr7W0a9gc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://WFUing.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://WFUing.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://WFUing.github.io/img/logo.gif">
<link rel="apple-touch-icon" href="https://WFUing.github.io/logo.gif">
<link rel="mask-icon" href="https://WFUing.github.io/logo.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            },
            "HTML-CSS": {
                availableFonts: ["Arial", "TeX"],
                preferredFont: "TeX",
                webFont: "TeX"
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>

<meta property="og:title" content="Open Application Model" />
<meta property="og:description" content="Open Application Model 的目标是定义一种标准的、与基础设施无关的方法，用于描述跨混合环境、云甚至边缘设备的应用部署。该模型要解决的核心问题是如何组成分布式应用程序，然后成功地将其交给负责操作的人员。问题不在于如何编写程序，而在于如何采用面向服务（或面向微服务）架构的组件，并简化围绕此类应用的工作流程。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://WFUing.github.io/posts/tech/architecture/iac/oam/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-17T09:21:20+08:00" />
<meta property="article:modified_time" content="2023-11-17T09:21:20+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Open Application Model"/>
<meta name="twitter:description" content="Open Application Model 的目标是定义一种标准的、与基础设施无关的方法，用于描述跨混合环境、云甚至边缘设备的应用部署。该模型要解决的核心问题是如何组成分布式应用程序，然后成功地将其交给负责操作的人员。问题不在于如何编写程序，而在于如何采用面向服务（或面向微服务）架构的组件，并简化围绕此类应用的工作流程。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://WFUing.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Technology",
      "item": "https://WFUing.github.io/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Architecture",
      "item": "https://WFUing.github.io/posts/tech/architecture/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Infrastructure as Code",
      "item": "https://WFUing.github.io/posts/tech/architecture/iac/"
    }, 
    {
      "@type": "ListItem",
      "position":  5 ,
      "name": "Open Application Model",
      "item": "https://WFUing.github.io/posts/tech/architecture/iac/oam/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Open Application Model",
  "name": "Open Application Model",
  "description": "Open Application Model 的目标是定义一种标准的、与基础设施无关的方法，用于描述跨混合环境、云甚至边缘设备的应用部署。该模型要解决的核心问题是如何组成分布式应用程序，然后成功地将其交给负责操作的人员。问题不在于如何编写程序，而在于如何采用面向服务（或面向微服务）架构的组件，并简化围绕此类应用的工作流程。",
  "keywords": [
    "oam"
  ],
  "articleBody": "1. Purpose and Goals Open Application Model 的目标是定义一种标准的、与基础设施无关的方法，用于描述跨混合环境、云甚至边缘设备的应用部署。\n该模型要解决的核心问题是如何组成分布式应用程序，然后成功地将其交给负责操作的人员。问题不在于如何编写程序，而在于如何采用面向服务（或面向微服务）架构的组件，并简化围绕此类应用的工作流程。\n例如，当代的云应用程序可能由几十个微服务组成，每个微服务负责广义上的 application 的一个独立部分。此类应用程序需要进行配置、部署、审核、更新和删除。有时必须将应用程序作为一个整体来处理，有时则需要更精细的粒度。最重要的是，此类应用程序通常不是由一个人或一个团队管理，而是由多个团队管理，他们必须通力合作，以实现可靠性、稳定性和及时性。\n该模型提供了对此类 workflow 的描述，描述本身具有声明性、可扩展性和最佳清晰度。此外，它还提出了操作此类应用程序的模式和流程。该模型将重点关注 cloud native（即 highly distributed）应用，涵盖公共云技术、内部部署解决方案以及物联网/边缘技术。这为现代应用交付系统奠定了坚实的基础，为云原生应用部署提供了标准但更高层次的描述。\nNon-goals 包括\n定义或规定特定的协调工具。 定义运行资源的模式，例如（但不限于）： Secrets (secure, encrypted values) Networks Volumes 描述或定义运行时基础设施本身。 2. Overview and Terminology 本节概述了 Open Application Model (OAM) 及其术语。本节首先确定了运行云本地应用程序过程中涉及的组织角色。然后，介绍本文档中使用的特定术语。\n本文档提出的云本地应用程序定义模型如下：\n云本地应用程序是一系列相互关联但又互不关联的组件（服务、任务、工作者）的集合，当这些组件与配置耦合并在合适的运行时基础架构中实例化时，可共同完成统一的功能目的。\n在当前版本中，该应用模式定义了以下内容：\nComponents 代表一个可运行的单元。 Workload types 标识组件可执行的不同工作负载 Traits 是覆盖层，可通过附加的特定操作功能来增强组件。Traits 代表操作员关注的问题，而不是开发人员/软件所有者关注的问题。 Application scopes 通过对具有共同属性或依赖性的组件进行分组，代表了应用的边界。 Application configuration 集合了一组组件实例、它们的特性、它们所在的应用范围，并结合了配置参数和元数据。 因此，应用程序是具有一系列运行特征的组件的集合，并被集中到一个或多个应用程序边界中。\n3. Component Model 本节定义组件模型。\n组件描述了可作为更大的分布式应用程序的一部分进行实例化的功能单元。应用程序部分将介绍如何将组件组合在一起以及如何配置这些组件的实例，而本节将重点介绍组件模型本身。\n组件定义（ComponentDefinition）实体的作用是允许组件提供者以基础设施中立格式声明此类执行单元的运行时特性。\n例如，应用程序中的每个微服务都被描述为一个组件。请注意，ComponentDefinition 本身并不是该微服务的实例，而是该微服务可配置属性的声明。这些可配置属性应作为参数列表公开，以便应用团队在部署时设置并实例化该组件。\n在实践中，一个简单的容器化工作负载、一个 Helm 图表或一个云数据库都可以建模为一个组件。\nTop-Level Attributes 以下是提供组件定义顶层信息的属性。\nAttribute Type Required Default Value Description apiVersion string Y A string that identifies the version of the schema the object should have. The core types uses core.oam.dev/v1beta1 in this version of model kind string Y Must be ComponentDefinition metadata Metadata Y Entity metadata. spec Spec Y The specification for the component definition. Metadata 该元数据部分由几个 top-level keys 组成。元数据提供有关对象内容的信息。\nAttribute Type Required Default Value Description name string Y A name for the schematic. name is subject to the restrictions listed beneath this table. labels map[string]string N A set of string key/value pairs used as arbitrary labels on this component. See the “Label format” section immediately below. annotations map[string]string N A set of string key/value pairs used as arbitrary descriptive text associated with this object. See the “Annotations format” section immediately below. name：group、kind、name 的组合必须是唯一的。两个不同的种类（例如组件和特质）可以使用相同的名称，而不会造成冲突。Version 不是区分因素。 Okay: 每种类型都允许使用名称 foo。\n1 2 3 4 5 6 7 8 9 apiVersion: core.oam.dev/v1alpha2 kind: Component metadata: name: foo --- apiVersion: core.oam.dev/v1alpha2 kind: Trait metadata: name: foo Okay: 每个组（one.dev 和 other.dev）都允许使用名称为 foo 的组件。\n1 2 3 4 5 6 7 8 9 apiVersion: one.dev/v1alpha2 kind: Component metadata: name: foo --- apiVersion: other.dev/v1alpha2 kind: Component metadata: name: foo NOT Okay: Version 不是命名空间限定符。\n1 2 3 4 5 6 7 8 9 apiVersion: core.oam.dev/v1alpha2 kind: Component metadata: name: foo --- apiVersion: core.oam.dev/v1 kind: Component metadata: name: foo name 字段的格式必须如下：\nname 字段为必填字段，必须在 63 个字符以内，以字母数字字符（[a-z0-9A-Z]）开头和结尾，中间包含破折号 (-)、下划线 (_)、点 (.)和字母数字。\n除非另有说明，否则 name 在 Group/Version/Kind 中必须是唯一的。\nLabel：标签遵循 Kubernetes 规范 进行标记： 有效的标签密钥有两部分：可选的前缀和名称，以斜线 (/) 分隔。名称部分是必需的，长度必须在 63 个字符以内，以字母数字字符（[a-z0-9A-Z]）开头和结尾，中间包含破折号 (-)、下划线 (_)、点 (.)和字母数字。前缀为可选项。如果指定了前缀，则前缀必须是 DNS 子域：由点（.）分隔的一系列 DNS 标签，总长度不超过 253 个字符，后跟斜线 (/)。\nAnnotations：注解提供了一种在对象元数据中附加任意文本的机制。注释对象遵循Kubernetes 规范： 注释是键/值对。有效的注解键有两个部分：可选的前缀和名称，以斜线（/）分隔。名称部分是必填项，必须少于或等于 63 个字符，以字母数字字符（[a-z0-9A-Z]）开头和结尾，中间包含破折号 (-)、下划线 (_)、点 (.)和字母数字。前缀为可选项。如果指定了前缀，则前缀必须是 DNS 子域：由点（.）分隔的一系列 DNS 标签，总长度不超过 253 个字符，后跟斜线 (/)。\n下列注释标签是 _predefined_ 和 RECOMMENDED\nAttribute Type Required Default Value Description description string N A short description of the component. version string N A user provided string defining the semantic version of the component, e.g. the release version of this software 如果未提供 version ，则根据 SemVer 规范，默认版本假定为 0.1.0。\n例子：\n1 2 3 4 5 6 7 metadata: name: alpine-task labels: app: my-app-v1 # Non-normative example annotations: version: \"1.0.1\" description: A task that is backed by an Alpine Linux filesystem 元数据部分用于所有示意图。它也与 Kubernetes 元数据部分兼容。但请注意，Kubernetes 元数据是 OAM 元数据的超集，包含 OAM 无法识别的属性。\nGroup, Version, and Kind 本文档中描述的许多 API 对象都使用了一种名为 “Group, Version, Kind” 的命名方案。该方案由 Kubernetes 推广，为 API 对象的命名间距和版本提供了一致的方式，在此用于 OAM API 对象的版本控制。本节将介绍该方案。\nGroup 组是收集多个相关 kinds 的 namespace 。组使用 DNS 命名约定。组的示例有\ncomponents.oam.dev functions.azure.com my.dev oam.dev 域下的所有组都被视为 OAM 对象的保留组。此处指定的所有对象都属于该域中的组。\n组必须是全局唯一的。\nVersion version 字符串是 API 的版本。按照通用范例，API 仅按主版本号进行版本控制。API 版本中省略了次版本号和补丁号。底层引擎的实际次要版本和补丁版本可能会重复，但它们必须重复此版本以处理任何破坏性更改。换句话说，主版本号是兼容性的保证，次版本号和补丁号不应改变这一保证。因此，API 的用户不能指定比主版本更细的粒度。\nAPI 版本号的前缀总是 v，后面跟一个或多个数字。\nv1 v2 v973 主要版本号中还有两个附加修饰符：\nalphaN（其中 N 为一位或多位数）表示该功能是试验性的，可能会被移除，但其当前的兼容性标记为 1。 betaN（其中 N 为一位或多位数）表示该特征尚未稳定。N 是兼容性标记。 标记为 alpha 或 beta 的 API 版本被认为是不稳定的，容易出现破坏性更改。\n一次只能使用两种修改器中的一种：\nv1alpha1 v973beta231 兼容性只能通过精确匹配来确定。v1 与 v2、v1alpha1 或 v1beta2 不兼容。\n版本没有唯一性要求。\nKind 种类是类型的名称。例如，组件的种类是 “组件”（Component），而特质的种类是 “特质”（Trait）。种类总是由首字母大写的单词组成，每个单词的第一个字母都要大写。种类应大写首字母缩写的每个字母（例如，HTTP，而不是 Http）。\n在一个组中，种类必须是唯一的。\nGroup/Version/Kind 的表述 Group/Version/Kind 的完全限定表示法是 GROUP/VERSION.KIND。下面是一些示例：\nlocal.dev/v7alpha2.Proxy cache.example.com/v1.Redis azure.com/v2.Functions 在示意图中，Group 和 Version 在一个字段中显示，Kind 在另一个字段中显示：\n1 2 apiVersion: local.dev/v7alpha2 kind: Proxy 在极少数情况下，有必要链接组和种类，但不指定版本。例如，在声明默认工作负载时就需要这样做。一般情况下，不推荐这种行为，但在必要时，本规范会遵循 Kubernetes 的模式，用复数种类名称和组来构建 DNS 名称：\n1 Proxies.local.dev # allowed but discouraged 这种形式不被接受为完全合格版本的替代形式。只有在模型明确规定接受这种形式的情况下才会被接受。\nSpec Attribute Type Required Default Value Description workload WorkloadTypeDescriptor Y Identifier to workload type of this component. schematic Schematic Y Schematic information for this component. WorkloadTypeDescriptor Attribute Type Required Default Value Description type string Y A reference to a WorkloadDefinition via name. definition WorkloadGVK Y Mutually exclusive to type, a reference to WorkloadDefinition via group, version, and kind. WorkloadGVK Attribute Type Required Default Value Description apiVersion string Y The API version the workload type. kind string Y The API kind of the workload type. Schematic 本节声明了一个组件的示意图，该组件可在以后的部署工作流程中作为应用程序的一部分实例化。请注意，OAM 本身并不强制要求如何实现示意图，只要它能做到以下几点即可：\n为可部署单元建模； 公开 JSON 模式或等效参数列表。 在 KubeVela 中，目前支持以下方案实现（“cue”、“helm “和 “kube”）。\nExample 下面是一个完整的基于 CUE 的组件定义示例，名为 “webserver”：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 apiVersion: core.oam.dev/v1beta1 kind: ComponentDefinition metadata: name: webserver annotations: definition.oam.dev/description: \"webserver is a combo of Deployment + Service\" spec: workload: definition: apiVersion: apps/v1 kind: Deployment schematic: cue: template: | output: { apiVersion: \"apps/v1\" kind: \"Deployment\" spec: { selector: matchLabels: { \"app.oam.dev/component\": context.name } template: { metadata: labels: { \"app.oam.dev/component\": context.name } spec: { containers: [{ name: context.name image: parameter.image if parameter[\"cmd\"] != _|_ { command: parameter.cmd } if parameter[\"env\"] != _|_ { env: parameter.env } if context[\"config\"] != _|_ { env: context.config } ports: [{ containerPort: parameter.port }] if parameter[\"cpu\"] != _|_ { resources: { limits: cpu: parameter.cpu requests: cpu: parameter.cpu } } }] } } } } // an extra template outputs: service: { apiVersion: \"v1\" kind: \"Service\" spec: { selector: { \"app.oam.dev/component\": context.name } ports: [ { port: parameter.port targetPort: parameter.port }, ] } } parameter: { image: string cmd?: [...string] port: *80 | int env?: [...{ name: string value?: string valueFrom?: { secretKeyRef: { name: string key: string } } }] cpu?: string } 在平台中安装了上述 webserver 后，用户就可以在应用程序中部署该组件，如下所示：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 apiVersion: core.oam.dev/v1beta1 kind: Application metadata: name: webserver-demo spec: components: - name: hello-world type: webserver # claim to deploy webserver component definition properties: # setting parameter values image: crccheck/hello-world port: 8000 # this port will be automatically exposed to public env: - name: \"foo\" value: \"bar\" cpu: \"100m\" 4. Workload Types 工作负载类型（Workload Types）的使用将在组件模型部分介绍，但这里将对工作负载类型定义进行说明。\n工作负载类型是给定组件定义的关键特征。工作负载类型由平台提供，以便用户检查平台并了解有哪些工作负载类型可供使用。请注意，工作负载类型不可扩展给最终用户（只能扩展给平台操作员）。因此，终端用户不得创建新的工作负载类型。\nWorkload Definition 工作负载类型以 “工作负载定义”（WorkloadDefinition）的形式呈现，此外，为了便于发现，工作负载定义还带有特性信息，可提示平台如何将特性 附加到引用该工作负载类型的给定组件上（即特性系统的适用于特性）。\nTop-Level Attributes Attribute Type Required Default Value Description apiVersion string Y A string that identifies the version of the schema the object should have. The core types uses core.oam.dev/v1beta1 in this version of model kind string Y Must be WorkloadDefinition metadata Metadata Y Entity metadata. spec Spec Y The specification for the workload definition. Spec Attribute Type Required Default Value Description definitionRef DefinitionRef Y Identifier to workload capability in the platform. DefinitionRef Attribute Type Required Default Value Description name string N Name identifier of the workload capability. Mutually exclusive to apiVersion and kind. apiVersion string N API version of the workload capability. kind string N Kind of the workload capability. Characteristics of Workload Types 下面工作负载定义中保留的 “metadata.labels” 用于表示工作负载类型的 _the distinguishing characteristics_。\n这些特征将通过 traits 系统的 _applies to_ 功能来实现。\nLabel Type Explain workload.oam.dev/replicable boolean Whether they are replicable. If not, no replication or scaling traits may be assigned. workload.oam.dev/daemonized boolean Whether they are daemonized. For daemon types, if the workload exits, this is considered a fault, and the system must fix it. For non-daemonized types, exit is considered a success if no error is reported. workload.oam.dev/exposed boolean Whether they are exposed, i.e. have a service endpoint with a stable name for network traffic. Workload types that have a service endpoint need a virtual IP address (VIP) with a DNS name to represent the component as a whole, addressable within their network scope and can be assigned traffic routing traits. workload.oam.dev/podspecable boolean Whether this workload can be addressed by Kubernetes PodSpec. If yes, the implementation could manipulate the workload by leveraging PodSpec structure, instead of being agnostic of the workload’s schematic. Categories of Workload Types Workload Type 可分为几类。\nOfficially Maintained Workload Type 正式维护的工作负载类型必须属于 “oam.dev “组。\n下面是一个官方维护工作负载类型的示例：\n1 2 3 4 5 6 kind: WorkloadDefinition metadata: name: Server spec: definitionRef: name: containerizedworkloads.core.oam.dev 该 Workload Type 的说明：\nName Category Schema Exposed Replicable Daemonized Server Core ContainerizedWorkload Yes Yes Yes Extended Workload Type 每个 OAM 运行时都可以定义本组之外的工作负载类型，它们将被视为扩展工作负载类型。扩展工作负载类型的名称和模式完全由 OAM 实施自行决定。\n下面是一个示例：\n1 2 3 4 5 6 kind: WorkloadDefinition metadata: name: redis.cache.aliyun.com spec: definitionRef: name: redis.cache.aliyun.com # this is an extended workload type 对于扩展工作负载类型，建议使用以下约定：\n使用 Group/Version/Kind 唯一标识工作负载能力。 name 遵循 Group/Version/Kind 中描述的格式。 WorkloadDefinition 的 name 与它所指向的 name 相同。 1 2 3 4 5 6 kind: WorkloadDefinition metadata: name: schema.example.com spec: definitionRef: name: schema.example.com Server 服务器是一种 OAM 核心工作负载类型，用于定义长期运行、可扩展的工作负载，这些负载有一个名称稳定的网络端点，用于接收整个组件的网络流量。常见用例包括暴露 API 的网络应用程序和服务。服务器工作负载类型具有以下特征：\n定义了一个容器运行时，同一容器的零个或多个副本可同时运行。 应用程序操作员可以通过应用和配置可用特性来增加或减少组件副本的数量。 服务器是守护进程化的。无论错误代码如何，运行时都必须尝试重新启动退出的副本。 服务器有一个网络端点，该端点具有自动分配的虚拟 IP 地址（VIP）和 DNS 名称，可在组件所属的网络范围内寻址。 如果服务器没有在至少一个容器上提供至少一个端口，实现就应该发出错误信息。\nHow to use? 在基于 OAM 的平台中安装以下工作负载定义： 1 2 3 4 5 6 7 apiVersion: core.oam.dev/v1beta1 kind: WorkloadDefinition metadata: name: Server spec: definitionRef: name: containerizedworkloads.core.oam.dev # the reference of schema for this workload type. In Kubernetes it should be a full name of API resource 将组件引用服务器定义为工作负载： 1 2 3 4 5 6 7 8 9 10 11 apiVersion: core.oam.dev/v1beta1 kind: ComponentDefinition metadata: name: webserver annotations: definition.oam.dev/description: \"webserver is a combo of Deployment + Service\" spec: workload: type: Server # reference above workload definition by name. schematic: ... # CUE code to define user schematic. Containerized Workload ContainerizedWorkload 是无服务器容器风格的工作负载定义，可作为 Azure ACI、AWS Fargate 或 Kubernetes 的简单无状态工作负载等运行时平台的长期运行容器化工作负载类型的模式。\n注意：根据设计，ContainerizedWorkload 模式并不等同于 Kubernetes Pod 规范。作为无服务器风格工作负载的模式，ContainerizedWorkload 计划只关注面向开发人员的基元，并且是自包含的，因此开发人员无需定义 ConfigMap 或 Secret 等对象。此外，它默认公开容器端口。因此，如果您正在为基于 Kubernetes 的 PaaS 寻找通用工作负载模式，我们建议您查看 PodSpecWorkload 规范。\n以下是 ContainerizedWorkload 的规范示意图。\nTop-Level Attributes of a containerized workload 这些属性提供了有关容器化工作负载的顶级信息。\nAttribute Type Required Default Value Description apiVersion string Y core.oam.dev/v1alpha2 kind string Y ContainerizedWorkload metadata Metadata Y containerized workload metadata. spec Spec Y A container for the containerized workload spec. Spec Attribute Type Required Default Value Description osType string N The OS required to host (all of) the component’s containers (since containers share a kernel with the underlying host). Possible values include:linuxwindows For extended runtimes, this is passed in unaltered. Default can be none and let the runtime decide where to place the component. arch string N The CPU architecture required to host (all of) the component’s containers (since containers share physical hardware with the underlying host). Possible values include:i386amd64armarm64 Default can be none and let the runtime chose architecture. containers []Container Y The OCI container(s) that implement the component. Container 本节介绍为该组件运行容器化工作负载所需的运行时配置。\nAttribute Type Required Default Value Description name string Y The container’s name. Must be unique per component. image string Y A path-like or URI-like representation of the location of an OCI image. Where applicable, this MAY be prefixed with a registry address, SHOULD be suffixed with a tag. resources Resources Y Resources required by the container. cmd []string N Entrypoint array. args []string N Arguments to the entrypoint. The container image’s CMD is used if this is not provided. env []Env N Environment variables for the container. config []ConfigFile N Locations to write configuration as files accessible within the container ports []Port N Ports exposed by the container. livenessProbe HealthProbe N Instructions for assessing whether the container is alive. readinessProbe HealthProbe N Instructions for assessing whether the container is in a suitable state to serve traffic. imagePullSecret string N Key that can be used to retrieve the credentials for pulling this secret. Resources 资源描述附加到运行时的计算资源。\nAttribute Type Required Default Value Description cpu CPU Y Specifies the attributes of the cpu resource required for the container. memory Memory Y Specifies the attributes of the memory resource required for the container. gpu GPU N Specifies the attributes of the gpu resources required for the container. volumes []Volume N Specifies the attributes of the volumes that the container uses. extended []ExtendedResource N Implementation-specific extended resource requirements 对于底层平台无法满足的任何资源，平台必须返回错误并停止部署。资源被视为一种需求，无法满足该需求意味着运行时不得部署应用程序。例如，如果应用程序请求 1P 内存，而内存量不可用，则应用程序部署必须失败。同样，如果应用程序需要 1 个 GPU，而运行时没有提供 GPU，则应用程序部署必须失败。\nCPU Attribute Type Required Default Value Description required double Y The minimum number of logical cpus required for running this container. Memory Attribute Type Required Default Value Description required string Y The minimum amount of memory required for running this container. The value should be a positive integer with/without unit suffix: P, T, G, M, K. If no unit is given, it defaults to ‘bytes’. GPU Attribute Type Required Default Value Description required double Y The minimum number of gpus required for running this container. Volume 卷描述了名称、挂载卷的位置、访问模式（如读/写或只读）以及挂载的共享策略。它还描述了卷所需的底层磁盘属性。\n路径格式取决于消费组件的操作系统，但实现应支持类似 UNIX 的路径表示法。\nAttribute Type Required Default Value Description name string Y Specifies the name used to reference the path. mountPath string Y Specifies the actual mount path in the filesystem. accessMode string N RW Specifies the access mode. Allowed values are RW (read/write) and RO (read-only). sharingPolicy string N Exclusive The sharing policy for the mount, indicating if it is expected to be shared or not. Allowed values are Exclusive and Shared. disk Disk N Specifies the attributes of the underneath disk resources required by the volume. Example:\n1 2 3 4 5 6 7 name: \"configuration\" mountPath: /etc/config accessMode: RO sharingPolicy: Shared disk: required: \"2G\" ephemeral: n 上述操作要求在路径 /etc/config 下挂载一个只读卷，该卷由一个至少提供 2G 非短暂存储空间的卷支持。\nDisk 磁盘指定卷所使用磁盘的属性。它描述了最小磁盘大小和磁盘是否短暂等信息。短暂磁盘表示组件需要节点上最小的磁盘大小才能运行。例如，图像处理组件可能需要节点上更大的缓存才能运行，这时可以使用短暂磁盘。当短暂磁盘设置为假时，表示将使用外部磁盘。\nAttribute Type Required Default Value Description required string Y The minimum disk size required for running this container. The value should be a positive value, greater than zero. ephemeral boolean N Specifies whether external disk needs to be mounted or not. ExtendedResource 扩展资源是针对特定实施资源的资源需求声明。例如，兼容 OAM 的平台可能会暴露出特殊的硬件。通过该字段，容器可以指出，为了让容器运行，需要提供此类特殊硬件。\nAttribute Type Required Default Value Description name string Y The name of the resource, as a Group/Version/Kind required string Y The required condition. name 字段必须是标识特定资源的 group/version/kind。\nExample:\n1 2 3 4 5 extended: - name: ext.example.com/v1.MotionSensor required: \"1\" - name: ext.example.com/v2beta4.ServoModel required: z141155-t100 如果已命名的扩展资源因故不可用，则在创建组件实例时，实现必须返回错误信息。\nEnv Env 将环境变量描述为 name/value 的字符串。\nAttribute Type Required Default Value Description name string Y The environment variable name. Must be unique per container. value string N The environment variable value. name 字段必须由有效的 Unicode 字母和数字字符以及 _ 和 - 组成。\nExample:\n1 2 3 env: - name: \"ADMIN_USER\" value: \"admin\" # This is a literal value ConfigFile ConfigFile 描述了容器内可用文件的路径，以及将写入该文件的数据。这提供了一种将配置文件注入容器的方法。\nAttribute Type Required Default Value Description path string Y An absolute path within the container. value string N The data to be written into the file at the specified path. If this is not supplied, fromParam must be supplied fromParam string N The parameter whose value should be written into this file as a value path 字段必须包含一个遵守底层操作系统路径规则的路径。如果给出的是相对路径，实现必须假定该路径是相对于容器根目录的。如果使用这样的路径会违反安全措施或路径布局要求，实现可能会产生错误\nExample:\n1 2 3 4 5 config: - path: \"/etc/access/default_user.txt\" value: \"admin\" # This is a literal value - path: \"/var/run/db-data\" fromParam: \"sourceData\" # This will cause the value to be read from the parameter whose name is `sourceData` 如果同时指定了 fromParam 和 value，则必须优先使用 fromParam，即使参数值是空值。如果两者都未指定，运行时必须产生错误。\nPort Attribute Type Required Default Value Description name string Y A descriptive name for the port. Must be unique per container. containerPort integer Y The port number. Must be unique per container. protocol string N TCP Indicates the transport layer protocol used by the server listening on the port. Valid values are TCP and UDP. name 字段必须是 ASCII 字符集（0061-007A）中的小写字母字符。\nHealthProbe HealthProbe 描述了如何执行探测操作以确定组件的健康状况。\nAttribute Type Required Default Value Description exec Exec N Instructions for assessing container health by executing a command. Either this attribute or the httpGet attribute or the tcpSocket attribute MUST be specified. This attribute is mutually exclusive with both the httpGet attribute and the tcpSocket attribute. httpGet HTTPGet N Instructions for assessing container health by executing an HTTP GET request. Either this attribute or the exec attribute or the tcpSocket attribute MUST be specified. This attribute is mutually exclusive with both the exec attribute and the tcpSocket attribute. tcpSocket TCPSocket N Instructions for assessing container health by probing a TCP socket. Either this attribute or the exec attribute or the httpGet attribute MUST be specified. This attribute is mutually exclusive with both the exec attribute and the httpGet attribute. initialDelaySeconds integer N 0 Number of seconds after the container is started before the first probe is initiated. periodSeconds integer N 10 How often, in seconds, to execute the probe. timeoutSeconds integer N 1 Number of seconds after which the probe times out. successThreshold integer N 1 Minimum consecutive successes for the probe to be considered successful after having failed. failureThreshold integer N 3 Number of consecutive failures required to determine the container is not alive (liveness probe) or not ready (readiness probe). Exec Attribute Type Required Default Value Description command []string Y A command to be executed inside the container to assess its health. Each space delimited token of the command is a separate array element. Commands exiting 0 are considered to be successful probes, whilst all other exit codes are considered failures. HTTPGet Attribute Type Required Default Value Description path string Y The endpoint, relative to the port, to which the HTTP GET request should be directed. port integer Y The TCP socket within the container to which the HTTP GET request should be directed. httpHeaders []HTTPHeader N Optional HTTP headers. HTTPHeader Attribute Type Required Default Value Description name string Y An HTTP header name. This must be unique per HTTP GET-based probe. value string Y An HTTP header value. name 和 value 都必须遵守 HTTP/1.1 关于有效[标头值]的规范(https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2)\nTCPSocket Attribute Type Required Default Value Description port integer Y The TCP socket within the container that should be probed to assess container health. 端口必须是大于 0 的整数。\nUnits for Time, CPU, Memory, and Disk 本规范的某些地方使用了某些度量单位。本节将介绍这些计量单位。\nTiming (Intervals) 对于计时，默认的时间单位是秒，用整数表示。\nCPU count CPU 数量用浮点数表示，其中 “1 “表示一个 CPU，“2 “表示两个 CPU，“0.5 “表示半个 CPU。\n该单位的确切含义因平台而异。 实施者应考虑逻辑 cpu 相当于一个 AWS vCPU 或一个 Azure vCore 或一个 GCP Core 或一个 IBM vCPU。允许使用分数值。如果运行时不支持小数单位，则必须向上舍入（上限函数）到下一个整数值。\nMemory and Disk 内存和磁盘空间使用 bytes/kilo/mega/giga/tera/peta 的符号，只使用主要单位：\n1024 is 1024 bytes 88K is 88 kilobytes 5M is 5 megabytes 7G is 7 gigabytes 100T is 100 terabytes 9999P is 9999 petabytes 如果在单位字母后附加 B，则必须忽略。因此，5M 和 5MB 被视为相同。大小写并不重要。15k 和 15K 必须视为相同的值。\nContainerized Workload JSON schema 对于非 Kubernetes 运行时实现，可以使用 JSON schema 作为有效的容器化工作负载模式。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 { \"$schema\": \"http://json-schema.org/draft-07/schema#\", \"$id\": \"http://oam.dev/v1/oam.workload.schema.json\", \"title\": \"Open Application Model Containerized Workload JSON Schema\", \"type\": \"object\", \"properties\": { \"apiVersion\": { \"type\": \"string\", \"description\": \"The specific version of the Open Application Model specification in use. This version of the specification covers apiVersions in core.oam.dev/v1alpha2.\" }, \"kind\": { \"type\": \"string\", \"description\": \"must be ContainerizedWorkload.\", \"enum\": [\"ContainerizedWorkload\"] }, \"metadata\": { \"type\": \"object\", \"description\": \"ContainerizedWorkload metadata.\", \"properties\": { \"name\": { \"type\":\"string\" }, \"labels\": { \"type\":\"object\", \"description\": \"A set of string key/value pairs used as arbitrary labels on this workload.\", \"additionalProperties\": { \"type\": \"string\" } }, \"annotations\": { \"type\":\"object\", \"description\": \"A set of string key/value pairs used as arbitrary annotations on this workload.\", \"additionalProperties\": { \"type\": \"string\" } } } }, \"spec\": { \"type\": \"object\", \"description\": \"A container for all remaining attributes.\", \"additionalProperties\": { \"$ref\": \"#/definitions/containerSpec\" } } }, \"required\": [\"apiVersion\", \"kind\", \"metadata\", \"spec\"], \"additionalProperties\": false, \"definitions\": { \"containerSpec\": { \"osType\":{ \"type\": \"string\", \"default\": \"linux\", \"description\": \"The OS required to host (all of) the component's containers (since containers share a kernel with the underlying host).\", \"enum\": [\"linux\", \"windows\"] }, \"arch\": { \"type\": \"string\", \"default\": \"amd64\", \"description\": \"The CPU architecture required to host (all of) the component's containers (since containers share physical hardware with the underlying host).\", \"enum\": [\"i386\", \"amd64\", \"arm\", \"arm64\"] }, \"containers\":{ \"type\": \"array\", \"description\": \"The OCI container(s) that implement the component.\", \"items\": { \"$ref\": \"#/definitions/container\" } }, \"required\": [\"containers\"], \"additionalProperties\": false }, \"container\": { \"type\": \"object\", \"description\": \"The runtime configuration necessary to run a containerized workload for this component.\", \"properties\": { \"name\": { \"type\": \"string\", \"description\": \"The container's name. Must be unique per component.\" }, \"image\": { \"type\": \"string\", \"description\": \"A path-like or URI-like representation of the location of an OCI image. Where applicable, this MAY be prefixed with a registry address, SHOULD be suffixed with a tag, and MUST be suffixed with a digest in OCI format. The digest may be used to compute the integrity of the image.\" }, \"resources\": { \"type\": \"object\", \"description\": \"Resources required by the container.\", \"properties\": { \"cpu\": { \"description\": \"Specifies the attributes of the cpu resource required for the container.\", \"type\": \"object\", \"properties\": { \"required\": { \"type\": \"number\", \"description\": \"The minimum number of logical cpus required for running this container.\" } } }, \"memory\": { \"description\": \"Specifies the attributes of the memory resource required for the container.\", \"type\": \"object\", \"properties\": { \"required\": { \"type\": \"string\", \"description\": \"The minimum amount of memory in MB required for running this container. The value should be a positive integer, greater than zero.\" } } }, \"gpu\": { \"description\": \"Specifies the attributes of the gpu resources required for the container.\", \"type\": \"object\", \"properties\": { \"required\": { \"type\": \"number\", \"description\": \"The minimum number of gpus required for running this container.\" } } }, \"volumes\": { \"description\": \"Specifies the attributes of the volumes that the container uses.\", \"type\": \"array\", \"items\": { \"type\": \"object\", \"properties\": { \"name\": { \"description\": \"Specifies the name used to reference the path.\", \"type\": \"string\" }, \"mountPath\": { \"description\": \"Specifies the actual mount path in the filesystem.\", \"type\": \"string\" }, \"accessMode\": { \"description\": \"Specifies the access mode.\", \"type\": \"string\", \"default\": \"RW\", \"enum\": [\"RW\", \"RO\"] }, \"sharingPolicy\": { \"description\": \"The sharing policy for the mount, indicating if it is expected to be shared or not.\", \"type\": \"string\", \"default\": \"Exclusive\", \"enum\": [\"Exclusive\", \"Shared\"] }, \"disk\": { \"description\": \"Specifies the actual mount path in the filesystem.\", \"type\": \"object\", \"properties\": { \"required\": { \"type\": \"string\", \"description\": \"The minimum disk size required for running this container. The value should be a positive integer, greater than zero.\" }, \"ephemeral\": { \"type\": \"boolean\", \"description\": \"Specifies whether external disk needs to be mounted or not.\" } } } }, \"required\": [\"name\", \"mountPath\"] } } } }, \"cmd\": { \"type\": \"string\", \"items\": { \"type\": \"string\" } }, \"args\": { \"type\": \"string\", \"items\": { \"type\": \"string\" } }, \"env\": { \"description\": \"Environment variables\", \"type\": \"array\", \"items\": { \"type\": \"object\", \"description\": \"a name/value pair\", \"properties\": { \"name\": { \"description\": \"The environment variable name. Must be unique per container.\", \"type\": \"string\", \"maxLength\": 256 }, \"value\": { \"description\": \"The environment variable value. If this is not supplied, fromParam must be supplied\", \"type\": \"string\", \"$comment\": \"POSIX may dictate a max length on this\", \"maxLength\": 2048 }, \"fromParam\": { \"description\": \"The parameter whose value should be substituted into this variable as a value\", \"type\": \"string\" } }, \"required\": [\"name\"], \"additionalProperties\": false } }, \"config\": { \"description\": \"Configuration files\", \"type\": \"array\", \"items\": { \"type\": \"object\", \"description\": \"a path and the value to be written into a file at that location\", \"properties\": { \"name\": { \"description\": \"The file name as an absolute path. Must be unique per container.\", \"type\": \"string\", \"$comment\": \"format of this value is operating system dependent.\", \"maxLength\": 256 }, \"value\": { \"description\": \"The value to be written into the file. If this is not supplied, fromParam must be supplied\", \"type\": \"string\" }, \"fromParam\": { \"description\": \"The parameter whose value should be written into this file as a value\", \"type\": \"string\" } }, \"required\": [ \"name\" ], \"additionalProperties\": false } }, \"ports\": { \"description\": \"Ports exposed by the container.\", \"type\": \"array\", \"items\": { \"type\": \"object\", \"properties\": { \"name\": { \"description\": \"A descriptive name for the port. Must be unique per container.\", \"type\": \"string\" }, \"containerPort\": { \"description\": \"The port number. Must be unique per container.\", \"type\": \"integer\" }, \"protocol\": { \"description\": \"Indicates the transport layer protocol used by the server listening on the port.\", \"type\": \"string\", \"default\": \"TCP\", \"enum\": [\"TCP\", \"UDP\"] } }, \"required\": [\"name\", \"containerPort\"], \"additionalProperties\": false } }, \"livenessProbe\": { \"description\": \"Instructions for assessing whether the container is alive.\", \"type\": \"object\", \"additionalProperties\": { \"$ref\": \"#/definitions/healthProbe\" } }, \"readinessProbe\": { \"description\": \"Instructions for assessing whether the container is in a suitable state to serve traffic.\", \"type\": \"object\", \"additionalProperties\": { \"$ref\": \"#/definitions/healthProbe\" } } }, \"required\": [\"name\", \"image\", \"resources\"], \"additionalProperties\": false }, \"healthProbe\": { \"description\": \"Health Probe describes how a probing operation is to be executed as a way of determining the health of a component.\", \"type\": \"object\", \"properties\": { \"exec\": { \"description\": \"Instructions for assessing container health by executing a command. Either this attribute or the httpGet attribute or the tcpSocket attribute MUST be specified. This attribute is mutually exclusive with both the httpGet attribute and the tcpSocket attribute.\", \"type\": \"object\", \"properties\": { \"command\": { \"description\": \"A command to be executed inside the container to assess its health. Each space delimited token of the command is a separate array element. Commands exiting 0 are considered to be successful probes, whilst all other exit codes are considered failures.\", \"type\": \"string\", \"items\": { \"type\": \"string\" } } } }, \"httpGet\": { \"description\": \"Instructions for assessing container health by executing an HTTP GET request. Either this attribute or the exec attribute or the tcpSocket attribute MUST be specified. This attribute is mutually exclusive with both the exec attribute and the tcpSocket attribute.\", \"type\": \"object\", \"properties\": { \"path\":{ \"description\": \"The endpoint, relative to the port, to which the HTTP GET request should be directed.\", \"type\": \"string\" }, \"port\": { \"description\": \"The TCP socket within the container to which the HTTP GET request should be directed.\", \"type\":\"integer\" }, \"httpHeaders\":{ \"type\": \"object\", \"description\": \"Optional HTTP headers.\", \"properties\": { \"name\": { \"description\": \"An HTTP header name. This must be unique per HTTP GET-based probe.\", \"type\": \"string\" }, \"value\": { \"description\": \"An HTTP header value.\", \"type\": \"string\" } }, \"required\": [\"value\", \"name\"], \"additionalProperties\": false } }, \"required\": [\"path\", \"port\"], \"additionalProperties\": false }, \"tcpSocket\": { \"description\": \"Instructions for assessing container health by probing a TCP socket. Either this attribute or the exec attribute or the httpGet attribute MUST be specified. This attribute is mutually exclusive with both the exec attribute and the httpGet attribute.\", \"type\": \"object\", \"properties\": { \"port\": { \"description\": \"The TCP socket within the container that should be probed to assess container health.\", \"type\": \"integer\" } }, \"required\": [\"port\"], \"additionalProperties\": false }, \"initialDelaySeconds\": { \"description\": \"Number of seconds after the container is started before the first probe is initiated.\", \"type\": \"integer\", \"default\": 0 }, \"periodSeconds\": { \"description\": \"How often, in seconds, to execute the probe.\", \"type\": \"integer\", \"default\": 10 }, \"timeoutSeconds\": { \"description\": \"Number of seconds after which the probe times out.\", \"type\":\"integer\", \"default\": 1 }, \"successThreshold\": { \"description\": \"Minimum consecutive successes for the probe to be considered successful after having failed.\", \"type\": \"integer\", \"default\": 1 }, \"failureThreshold\": { \"description\": \"Number of consecutive failures required to determine the container is not alive (liveness probe) or not ready (readiness probe).\", \"type\": \"integer\", \"default\": 3 } } } } } The Relationship of Component and Workload Type 简而言之，组件是工作负载类型的封装，预先定义了面向用户的示意图。组件需要明确声明其工作负载类型，以便 OAM 系统正常工作，即 OAM 特性系统将检查该工作负载类型信息，以验证特定特性是否可附加到该组件上。\n下面的示例可能有助于更好地解释它们之间的关系：\nWeb 服务组件封装了 Kubernetes 部署和服务。 在这种情况下，apps/v1.Deployment 就是该组件的工作负载类型。 封装 Kubernetes 部署的 后端 Worker 组件。 在这种情况下，apps/v1.Deployment 仍是该组件的工作负载类型。 将 Kubernetes 部署 + Ingress 作为模板的 Helm 图表也是一个组件。 该组件的工作负载类型是 apps/v1.Deployment。 从另一个角度看，组件定义 总是由某些组件提供商或软件构建商定义，而 工作负载定义 作为一种平台能力，总是由基础设施运营商维护。因此，OAM 平台的工作负载定义数量通常非常有限，而且变化不大，但总是有无数的组件定义由不同的提供商和用户维护。\n5. Application Scopes Application scopes 通过提供具有共同 group 行为的不同形式的应用边界，将组件组合成逻辑应用。\nApplication scopes 具有以下一般特征：\n在定义一组组件实例共有的行为或元数据时，应使用 Application scopes。 一个组件可以同时部署到多个不同类型的应用范围中。 Application scopes 类型可决定组件是否可同时部署到同一应用范围类型的多个实例中。 Application scopes 可用作组件组与基础设施（如网络）或外部功能（如身份提供商）所提供功能之间的连接机制。 下图说明了如何将组件分组到重叠的应用范围中以创建不同的应用边界：\n此示例显示了两个作用域类型，其中分布着四个组件。\n组件 A、B 和 C 部署在同一个健康作用域中。健康作用域将收集其组成组件的总体健康信息，并在组件升级操作期间对这些信息进行评估。需要根据一组组件的总体健康状况进行评估和/或执行操作的特性或组件可进一步使用健康范围提供的查询信息。这是应用程序的一个基本分组结构，它为组件之间的依赖关系提供了一个宽松的定义。\n组件 A 在自己的网络范围内与组件 B、C 和 D 隔离。这样，基础设施运营商就可以为不同的组件组提供不同的 SDN 设置，例如对后端组件的入站/出站规则进行更严格的限制。\nDefining an application scope 应用范围由 ScopeDefinition 实体表示。\nTop-Level Attributes 这些属性提供了有关应用范围的顶级信息。\nAttribute Type Required Default Value Description apiVersion string Y A string that identifies the version of the schema the object should have. The core types uses core.oam.dev/v1beta1 in this version of model. kind string Y Must end with ScopeDefinition. metadata Metadata Y Entity metadata. spec Spec Y A specification for scope attributes. Spec 该规范定义了作用域的构成部分。\nAttribute Type Required Default Value Description allowComponentOverlap bool N true Determines whether a component is allowed to be in multiple instances of this scope type simultaneously. When false, the runtime implementation MUST produce an error and stop deployment if an attempt is made to place a component into more than one instance of this scope type simultaneously. definitionRef DefinitionRef Y Identifier to scope capability in the platform. DefinitionRef Attribute Type Required Default Value Description name string N Name identifier of the scope capability. Mutually exclusive to apiVersion and kind. apiVersion string N API version of the scope capability. kind string N Kind of the scope capability. Examples 1 2 3 4 5 6 7 8 apiVersion: core.oam.dev/v1beta1 kind: ScopeDefinition metadata: name: healthscopes.core.oam.dev spec: allowComponentOverlap: true definitionRef: name: healthscopes.core.oam.dev Health Scope 健康范围将组件分组为一个总体健康组。组内各组件的总体健康状况为升级和回滚机制提供信息。\n健康范围汇总了组件的健康状态。可以设置健康范围的参数，以确定必须有多少百分比的组件处于不健康状态，才能认为整个范围处于不健康状态。\n健康作用域本身不会根据健康状态采取任何行动。它只是一个群组健康状况聚合器，可被应用程序的其他进程和部分查询和使用，例如：应用程序升级特质可监控健康范围的总体健康状况，并决定何时启动自动回滚。监控应用程序可以监控健康状况范围的总体健康状况以发出警报。\nProperties Attribute Type Required Default Value Description probe-timeout int32 Y ProbeTimeout is the amount of time in seconds to wait when receiving a response before marked failure. probe-interval int32 Y ProbeInterval is the amount of time in seconds between probing tries. Instance Example 例如，健康范围实例可以如下所示：\n1 2 3 4 5 6 7 apiVersion: core.oam.dev/v1alpha2 kind: HealthScope metadata: name: example-health-scope spec: probe-timeout: 5 probe-interval: 5 Usage Example 应用程序可以如下引用上述作用域实例：\n1 2 3 4 5 6 7 8 9 10 kind: Application metadata: name: example-appconfig spec: components: - componentName: example-component traits: ... scopes: healthscopes.core.oam.dev: example-health-scope Network Scope 网络范围将组件归入网络子网边界，并定义一般运行时网络模型。网络定义、规则和策略由基础设施的网络或 SDN 描述。\n网络范围将组件组合在一起，并将它们连接到网络或 SDN。网络本身必须由应用运营商定义和运营。\n流量管理功能也可查询网络范围，以确定服务网格的可发现性边界或 API 网关的 API 边界。\n如果未指定网络范围，平台必须将应用程序加入默认网络。在默认网络中，应用配置中的所有组件必须能够相互通信，健康探测器必须能够与定义了健康检查规则的任何组件联系。不过，加入的网络与平台有关。例如，基于集群的环境（如 Kubernetes）会声明集群范围内的网络。相反，真正的无服务器实现可能会将组件加入到仅包括组件和健康检查探针的网络中。\nProperties Attribute Type Required Default Value Description networkId string Y The id of the network, e.g. vpc-id, VNet name. subnetIds array Y A comma separated list of IDs of the subnets within the network. For example, ‘vsw-123’ or ‘vsw-123’,‘vsw-456’. There could be more than one subnet because there is a limit in the number of IPs in a subnet. If IPs are taken up, operators need to add another subnet into this network. internetGatewayType string Y The type of the gateway, options are ‘public’, ’nat’. Empty string means no gateway. Instance Example 例如，网络作用域实例可以如下所示：\n1 2 3 4 5 6 7 8 9 10 11 12 apiVersion: standard.oam.dev/v1alpha2 kind: NetworkScope metadata: name: example-vpc-network spec: allowComponentOverlap: true # can be skipped networkId: cool-vpc-network subnetIds: - cool-subnetwork - cooler-subnetwork - coolest-subnetwork internetGatewayType: nat Usage Example 应用程序可以如下引用上述作用域实例：\n1 2 3 4 5 6 7 8 9 10 kind: Application metadata: name: example-appconfig spec: components: - componentName: example-component traits: ... scopes: networkscopes.standard.oam.dev: example-vpc-network 6. Traits trait 是一种可自行决定的运行时叠加，可通过操作功能增强组件工作负载实例。它为应用程序操作员提供了一个机会，让他们可以对组件的配置做出特定的决定，而无需让组件提供者参与其中或破坏组件封装。\n例如，在 WordPress Helm 图表中注入一个 sidecar container 的 sidecar 特性。\n特性可以是适用于单个组件的分布式应用程序的任何配置，如流量路由规则（如负载平衡策略、网络入口路由、断路、速率限制）、自动扩展策略、升级策略等。\nrait Definition 本节具有规范性，因为性状是系统中可检查（也可能是可共享）的部分。所有特征都必须可以用以下格式表示。\n特质的定义与组件一样使用示意图。与工作负载定义一样，每个特质定义都有一个 definitionRef，它是对定义特质配置选项的模式的引用。\nTop-Level Attributes Attribute Type Required Default Value Description apiVersion string Y A string that identifies the version of the schema the object should have. The core types uses core.oam.dev/v1beta1 in this version of documentation. kind string Y Must be TraitDefinition metadata Metadata Y Information about the trait. spec Spec Y A specification for trait attributes. Spec Attribute Type Required Default Value Description appliesToWorkloads []string * The collection of workload type characteristics to which this trait applies. If this field is empty or unspecified or specified as \"*\", it means applies any workload type. A trait must apply to at least one workload type. This attribute must contain at least one value. conflictsWith []string N A list of traits that would be conflict with this trait when applied to same workload type. For example, autoscaling may conflict with cron-autoscaling. definitionRef DefinitionRef Y Identifier of the trait capability. DefinitionRef Attribute Type Required Default Value Description name string N Name identifier of the trait. Mutually exclusive to apiVersion and kind. apiVersion string N API version of the trait. kind string N Kind of trait. 建议使用 Group/Version/Kind 来唯一标识特征能力。如果使用 definitionRef.name，则必须包含可用于唯一标识的信息。\nApplication 部分将详细介绍用户如何将特质附加到组件。\nImplementing a Trait System 警告：本节仅面向 OAM 平台实施者（即 KubVela），如果您只对 OAM 概念感兴趣，请跳过本节。\n在本文档中，_traits system_ 被定义为运行时通过 traits 对组件实例应用和管理操作行为的方式。\n模型的运行时实现必须提供将操作行为附加到组件实例的特征系统。\n当一个组件上有一个以上的特征时，它必须是：\n按照规定的顺序应用特征 确定兼容性，如果特性组合无法满足要求则失败 特征按顺序应用，如果某些特征集表示依赖关系（例如，必须在 SSL 之前设置入口），则可通过设置明确的顺序来解决。\n一个组件实例只能有一个给定特质类型的配置。\n在完成所有特性配置之前，部署不应被标记为已完成。例如，如果网络服务器组件是与自动分级器特质一起部署的，那么在 (a) 网络服务器本身运行（由健康检查确定）和 (b) 自动分级器特质运行（由底层平台确定）之前，网络服务器不应被视为 “正在运行”。\n组件可指定多个特性；因此，运行时必须支持对组件应用零个或多个特性。如果底层运行时无法满足所请求的特性，运行时必须产生错误并停止部署。\n没有明确要求组合特质的机制。例如，一个特质（ssl）不能指定它要求另一个特质（ingress）应用于一个对象。但是，如果一个特质在没有另一个特质的情况下无法履行合约，那么特质的_实现_就应该失败。系统可以支持一种机制，在这种机制中，一个特质（sslIngress）由两个不同的特质实现（ssl和ingress）不透明地支持。\n在运行时可用的任何特征都必须在该运行时实现。例如，运行时中的 autoscaling 特性不可能没有实现。\nCategories of Traits 特质系统旨在作为运行时操作能力的扩展点，同时也为组件提供通用的、在某些情况下是必要的操作功能。\n特质的实施细节超出了本文档的范围。不过，为了允许运行时实施任意特质，同时保持一定程度的通用性，以实现不同运行时的应用程序可移植性，特质按以下方式进行分类：\nCore traits：这一类定义了一组类型名称为 core.oam.dev 组的特质定义。这些特性提供了某些工作负载类型和组件功能运行所必需的操作功能。运行时必须实现本模型中定义的这些特征。 Standard traits：该类别定义了一组类型名称为 standard.oam.dev 组的特征定义。这些特征提供了应用程序操作员常用的操作功能，并由大多数运行时实现。建议运行时使用本模型中定义的标准特性定义，以提供与标准特性定义中所列功能相当的操作功能。换句话说，如果运行时正在实现具有行为 foo 的特质，而行为 foo 的标准特质定义已经存在，那么运行时就应该使用标准 foo 特质定义。应用程序操作员如果希望最大限度地提高应用程序的可移植性，就应该使用这些 trait 定义。虽然这并不能保证应用程序的可移植性，但其目的是提高运行时之间的可移植性。 Extension traits：除核心特质和标准特质定义的特质外，该类别还允许运行时定义自己独有的特质定义集。运行时可选择以任意定义实现该类别中的任意一组特质。扩展特质类型名称不得位于 core.oam.dev 或 standard.oam.dev 组中。 Trait Characteristics 单个特征可与特定工作负载绑定（也可适用于所有工作负载）。特性可以声明适用于哪种工作负载。\n本模型并不对特质的简单或复杂程度设定要求。有些特性可能会提供大量可配置选项，而有些特性则可能不提供任何可配置选项。也不要求特质与其底层技术一样详尽。例如，自动缩放技术的实现可能会提供多种方法来确定组件何时应该缩放。但该特性可能只涉及其中的几种。同样，也可以定义多个自动缩放特性（每个特性都有唯一的名称），每个特性显示不同的可配置选项子集。或者，一个大的特质可以显示所有可能的自动缩放配置。\nOAM 平台的实现应能以下面解释的格式发现所有支持的特征。\n7. Application 应用程序实体定义了应用程序部署后将被实例化的组件列表。\n用户将指定每个组件的最终参数以及用于增强其功能或改变其行为的特性。此外，还可以指定一组范围，将不同的组件子集分组。\nTop-Level Attributes Attribute Type Required Default Value Description apiVersion string Y A string that identifies the version of the schema the object should have. The core types uses core.oam.dev/v1beta1 in this version of documentation. kind string Y Must be Application metadata Metadata Y Information about the application. spec Spec Y A specification for application attributes. Spec The specification of applications defines components to create, traits attached to each components, and a set of scopes the components drop in.\nAttribute Type Required Default Value Description components []Component Y Component specification. Component Attribute Type Required Default Value Description name string Y The name of the component instance. type string Y A reference to the component definition that will be instantiated by the application. Optionally a namespaced component may be referenced as /. The meaning of namespace is implementation specific depending on the runtime being used and the target platform where entities are created. In the case of the Kubernetes, the concept of namespace matches the existing one in Kubernetes. properties Properties Y A set of values assigned to the parameters exposed from the component schematic. traits []Trait N The traits to attach to this component instance. scopes map[string]string N A map with the scopes the component belongs to. The map uses the qualified scope definition name as key (e.g., “scope.company.com”), and the name of the scope as value (e.g., “myscope”). Notice that this reference implies that an entity of the target scope with the specific name exists. name 必须遵循这些命名规则：\nname 字段为必填字段，必须为 63 个字符或更少，以字母数字字符（[a-z0-9A-Z]）开头和结尾，中间包含破折号 (-)、下划线 (_)、点 (.)和字母数字。\nTrait Attribute Type Required Default Value Description type string N A reference to the name of trait definition. For one type of trait, there could be only one configuration in one component. properties Properties Y The properties values to use this trait. 注意 _Traits_ 不需要名称，因为 OAM 运行时负责实例化 traits。组件的名称预计将用于相关特质。\nProperties 属性指定了与实体属性相关联的值。\n当与 _Components_ 关联时，所设置的值将覆盖组件的参数，这些参数遵循 component schematic 中定义的示意图。\n当属性用于 _Traits_ 或 _Scopes_ 时，它们会设置这些实体实例化所需的值。其结构由 definition reference 决定。它可能是一个简单的值，也可能是一个复杂的对象。属性根据适合于特质或范围的模式进行验证。\nExample 下面是一个完整的 YAML 文件示例，其中表达了组件、特性和作用域。该示例展示了组件的四个可配置元素：type, properties, traits, and scopes。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 apiVersion: core.oam.dev/v1beta1 kind: Application metadata: name: my-example-app annotations: version: v1.0.0 description: \"Brief description of the application\" spec: components: - name: publicweb type: web-ui properties: # properties targeting component parameters. image: example/web-ui:v1.0.2@sha256:verytrustworthyhash param_1: \"enabled\" # param_1 is defined on the web-ui component traits: - type: ingress # ingress trait providing a public endpoint for the publicweb component of the application. properties: # properties are defined by the trait CRD spec. This example assumes path and port. path: / port: 8080 scopes: \"healthscopes.core.oam.dev\": \"app-health\" # An application level health scope including both components. - name: backend type: company/test-backend # test-backend is referenced from other namespace properties: debug: \"true\" # debug is a parameter defined in the test-backend component. traits: - type: scaler # scaler trait to specify the number of replicas for the backend component properties: replicas: 4 scopes: \"healthscopes.core.oam.dev\": \"app-health\" # An application level health scope including both components. 上例展示了一个完整的应用程序，包括其作用域、组件及其特性。该应用程序假定存在两个 component definitions，分别代表网络用户界面和假想应用程序的后台。两个 traits 用于增强组件的功能。首先是后台的scaler，用于设置复制因子；其次是ingress，用于将应用程序对外开放。此外，还使用 HealthScope 来检查网络和后端组件的状态。这是本例中任意设置的一组组件，并不一定需要所有组件。\n在实例化应用程序时，运行时将根据目标系统（如 Kubernetes）生成所需的实体，并执行与每个实体（如 traits）相关的模式。由于 _Traits_ 可以作为扩展添加到现有环境中，因此运行时必须能够创建任何通过 TraitDefinition 在系统中注册的 Trait 实体。\nComponent Instances _component instance_ 是在应用程序部署过程中创建的。它是在组件与配置一起部署时创建的。\n每次部署组件时，它都必须与应用程序一起部署。本规范的这一部分描述的是配置。 组件的每次后续 _upgrade_ 都会修改给定的实例，如果组件附加了任何修订感知特征，则会生成新的实例修订版。 当实例首次创建时，它处于 _initial revision state_。每次升级操作发生时，我们都会说该实例发生了新的_修订_。但是，我们并不假定在某个地方一定存储有相应的 revision 对象。 Releases 在 Twelve-Factor Applications 中，一个版本被定义为一个 build plus a set of configs。也就是说，对构建或配置的任何更改都会产生一个新版本。在开放式应用程序模型中，类似的情况是 component、trait和scope objects与应用程序结合在一起共同构成一个版本。\n对于 OAM 应用程序，一个版本是这样定义的：\n版本是一个已命名的应用程序及其相关组件、作用域和特性的描述。\n此外，随着应用程序的发布，其组件实例也会被发布。\n为适应发布的这一定义，OAM 平台应做出以下假设：\n应用程序是可变的。 对 application 的任何更改（概念上）都会导致新版本的发布，并取代旧版本。 如果更新了应用程序，而新版本包含了原应用程序中没有的组件，则必须创建组件实例。 特质同样应该根据相同的准则进行附加和分离 组件与应用范围的关系应根据相同的准则应用或删除 8. Practical Considerations Proposal Stages and the Maturity of the Specification 该模型目前处于 “草稿 “阶段，正在向 “工作稿 “迈进。工作草案之后，该规范将成为最终规范（如 1.0）。\n在草稿阶段，模型的任何部分都不被认为是稳定的 在工作草案期间，可能会添加功能和修复问题。可能会出现破坏性修改，但这是不正常的情况 在最终规范期间，模型只会更新勘误、语法修正和明确标注的 “说明性文字”。 一旦发布了最终规范（如 1.0），新版本的规范（如 1.1）可能会在粗稿阶段开始。\nMedia Types 示意图的媒体类型将在模型进入工作草案状态时确定。媒体类型初步将采用以下形式：\napplication/oam.TYPE.v1+json，其中 TYPE 替换为类型名称（如组件）。 Security 该模式目前的形式并没有规定一套具体的安全政策。不过，它确实为安全的某些方面提供了指导：\nOCI/Docker 图像必须尽可能用 SHA 引用 文件格式必须转换为规范格式，以便进行哈希运算 满足这两个条件后，就可以构建系统，其中原理图的摘要验证将保持系统所有组件的不变性。也就是说，如果示意图用哈希值引用了图像，那么验证示意图摘要的过程也能确保所提取的图像与生成示意图时使用的引用相同。 其他安全细节，如网络传输安全或静态数据的安全，超出了本模型的考虑范围。\n9. Design Principles Open Application Model 遵循一系列设计原则，以确保模型的清晰度、丰富性和可扩展性。\nSeparation of Concerns Separation of Concerns 是一种设计理念，在这种理念下，架构选择是根据所要解决的离散问题来进行的。像 component 和 application，或 schematics 和 configuration 这样的工件划分，都是按照功能或行为划分的。通过确定不同用户群体的角色和责任，将规格划分为与问题空间相匹配的概念。\nRuntime Neutrality Separation of Concerns 与运行时间无关。它不假定任何运行时特定的功能。相反，它旨在为应用程序所有者和操作员提供一个通用词汇表，以描述所需的拓扑结构和行为，而不受任何特定平台的影响。\nBalance (Elegance) 在确保关注点分离的同时，OAM 力求避免对在较小团队中担任多种角色的用户造成不必要的复杂性。简单的方案应只需投入最少的时间和精力即可实现，但复杂的方案应在不需要重新平台化的情况下加以解决。\nOAM 提供了多个抽象层，这样就可以独立于开发人员的关注点来捕捉操作关注点。\nReusability OAM 原理图中的组件可重复使用和共享。此外，这些组件独立于其所描述的代码，因此可以重复使用代码（容器），并防止出现 “锁定 “情况。\n该模型作为一个整体，旨在提供应用程序的 “分布式”，使同一个应用程序可以在不同的平台上执行而无需改动。应用程序的这种可移植性旨在使以下情况不仅成为可能，而且变得容易：\n将应用程序从开发人员工作站转移到生产集群或服务中 从一个实施方案迁移到另一个实施方案，无需更改代码 创建类似市场的环境，将应用程序部署到客户平台上 Application Models Are Not Programming Models 应用程序模型和编程模型之间有明显的区别。应用程序模型描述应用程序的组成及其组件的拓扑结构。它不涉及如何实现每个组件（语言、设计模式等）。\n另一方面，编程模型描述的是单个软件是如何组成的。开发人员使用它来实现应用程序组件。开放式应用程序模型提供了一种不需要编程模型的应用程序模型。\n",
  "wordCount" : "6041",
  "inLanguage": "zh",
  "datePublished": "2023-11-17T09:21:20+08:00",
  "dateModified": "2023-11-17T09:21:20+08:00",
  "author":{
    "@type": "Person",
    "name": "WFUing"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://WFUing.github.io/posts/tech/architecture/iac/oam/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Waiting For You",
    "logo": {
      "@type": "ImageObject",
      "url": "https://WFUing.github.io/img/logo.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://WFUing.github.io/" accesskey="h" title="Waiting For You (Alt + H)">Waiting For You</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://WFUing.github.io/search" title="🔍 (Alt &#43; /)" accesskey=/>
                    <span>🔍</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/" title="HOME">
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/posts" title="BLOGS">
                    <span>BLOGS</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/archives" title="ARCHIVE">
                    <span>ARCHIVE</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/tags" title="TAGS">
                    <span>TAGS</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/about" title="🙋🏻‍♂️">
                    <span>🙋🏻‍♂️</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://WFUing.github.io/">主页</a>&nbsp;»&nbsp;<a href="https://WFUing.github.io/posts/">Posts</a>&nbsp;»&nbsp;<a href="https://WFUing.github.io/posts/tech/">Technology</a>&nbsp;»&nbsp;<a href="https://WFUing.github.io/posts/tech/architecture/">Architecture</a>&nbsp;»&nbsp;<a href="https://WFUing.github.io/posts/tech/architecture/iac/">Infrastructure as Code</a></div>
    <h1 class="post-title">
      Open Application Model
    </h1>
    <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-11-17
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>6041字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>29分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>WFUing
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://WFUing.github.io/tags/oam/" style="color: var(--secondary)!important;">oam</a>
            </span>
        </span>
    </span>
</span>
        &nbsp;|&nbsp;标签: &nbsp;
        <ul class="post-tags-meta">
            <a href="https://WFUing.github.io/tags/oam/">oam</a>
        </ul>

        
        
        
        
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_page_pv">
            &nbsp;| 访问: <span id="busuanzi_value_page_pv"></span>
        </span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#1-purpose-and-goals" aria-label="1. Purpose and Goals">1. Purpose and Goals</a></li>
                    <li>
                        <a href="#2-overview-and-terminology" aria-label="2. Overview and Terminology">2. Overview and Terminology</a></li>
                    <li>
                        <a href="#3-component-model" aria-label="3. Component Model">3. Component Model</a><ul>
                            
                    <li>
                        <a href="#top-level-attributes" aria-label="Top-Level Attributes">Top-Level Attributes</a></li>
                    <li>
                        <a href="#metadata" aria-label="Metadata">Metadata</a><ul>
                            
                    <li>
                        <a href="#group-version-and-kind" aria-label="Group, Version, and Kind">Group, Version, and Kind</a><ul>
                            
                    <li>
                        <a href="#group" aria-label="Group">Group</a></li>
                    <li>
                        <a href="#version" aria-label="Version">Version</a></li>
                    <li>
                        <a href="#kind" aria-label="Kind">Kind</a></li>
                    <li>
                        <a href="#groupversionkind-%e7%9a%84%e8%a1%a8%e8%bf%b0" aria-label="Group/Version/Kind 的表述">Group/Version/Kind 的表述</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#spec" aria-label="Spec">Spec</a><ul>
                            
                    <li>
                        <a href="#workloadtypedescriptor" aria-label="WorkloadTypeDescriptor">WorkloadTypeDescriptor</a><ul>
                            
                    <li>
                        <a href="#workloadgvk" aria-label="WorkloadGVK">WorkloadGVK</a></li></ul>
                    </li>
                    <li>
                        <a href="#schematic" aria-label="Schematic">Schematic</a><ul>
                            
                    <li>
                        <a href="#example" aria-label="Example">Example</a></li></ul>
                    </li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#4-workload-types" aria-label="4. Workload Types">4. Workload Types</a><ul>
                            
                    <li>
                        <a href="#workload-definition" aria-label="Workload Definition">Workload Definition</a><ul>
                            
                    <li>
                        <a href="#top-level-attributes-1" aria-label="Top-Level Attributes">Top-Level Attributes</a></li>
                    <li>
                        <a href="#spec-1" aria-label="Spec">Spec</a><ul>
                            
                    <li>
                        <a href="#definitionref" aria-label="DefinitionRef">DefinitionRef</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#characteristics-of-workload-types" aria-label="Characteristics of Workload Types">Characteristics of Workload Types</a></li>
                    <li>
                        <a href="#categories-of-workload-types" aria-label="Categories of Workload Types">Categories of Workload Types</a><ul>
                            
                    <li>
                        <a href="#officially-maintained-workload-type" aria-label="Officially Maintained Workload Type">Officially Maintained Workload Type</a></li>
                    <li>
                        <a href="#extended-workload-type" aria-label="Extended Workload Type">Extended Workload Type</a></li></ul>
                    </li>
                    <li>
                        <a href="#server" aria-label="Server">Server</a><ul>
                            
                    <li>
                        <a href="#how-to-use" aria-label="How to use?">How to use?</a></li></ul>
                    </li>
                    <li>
                        <a href="#containerized-workload" aria-label="Containerized Workload">Containerized Workload</a><ul>
                            
                    <li>
                        <a href="#top-level-attributes-of-a-containerized-workload" aria-label="Top-Level Attributes of a containerized workload">Top-Level Attributes of a containerized workload</a></li>
                    <li>
                        <a href="#spec-2" aria-label="Spec">Spec</a></li>
                    <li>
                        <a href="#container" aria-label="Container">Container</a><ul>
                            
                    <li>
                        <a href="#resources" aria-label="Resources">Resources</a><ul>
                            
                    <li>
                        <a href="#cpu" aria-label="CPU">CPU</a></li>
                    <li>
                        <a href="#memory" aria-label="Memory">Memory</a></li>
                    <li>
                        <a href="#gpu" aria-label="GPU">GPU</a></li>
                    <li>
                        <a href="#volume" aria-label="Volume">Volume</a></li>
                    <li>
                        <a href="#disk" aria-label="Disk">Disk</a></li>
                    <li>
                        <a href="#extendedresource" aria-label="ExtendedResource">ExtendedResource</a></li></ul>
                    </li>
                    <li>
                        <a href="#env" aria-label="Env">Env</a></li>
                    <li>
                        <a href="#configfile" aria-label="ConfigFile">ConfigFile</a></li>
                    <li>
                        <a href="#port" aria-label="Port">Port</a></li>
                    <li>
                        <a href="#healthprobe" aria-label="HealthProbe">HealthProbe</a><ul>
                            
                    <li>
                        <a href="#exec" aria-label="Exec">Exec</a></li>
                    <li>
                        <a href="#httpget" aria-label="HTTPGet">HTTPGet</a></li>
                    <li>
                        <a href="#httpheader" aria-label="HTTPHeader">HTTPHeader</a></li>
                    <li>
                        <a href="#tcpsocket" aria-label="TCPSocket">TCPSocket</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#units-for-time-cpu-memory-and-disk" aria-label="Units for Time, CPU, Memory, and Disk">Units for Time, CPU, Memory, and Disk</a><ul>
                            
                    <li>
                        <a href="#timing-intervals" aria-label="Timing (Intervals)">Timing (Intervals)</a></li>
                    <li>
                        <a href="#cpu-count" aria-label="CPU count">CPU count</a></li>
                    <li>
                        <a href="#memory-and-disk" aria-label="Memory and Disk">Memory and Disk</a></li></ul>
                    </li>
                    <li>
                        <a href="#containerized-workload-json-schema" aria-label="Containerized Workload JSON schema">Containerized Workload JSON schema</a></li></ul>
                    </li>
                    <li>
                        <a href="#the-relationship-of-component-and-workload-type" aria-label="The Relationship of Component and Workload Type">The Relationship of Component and Workload Type</a></li></ul>
                    </li>
                    <li>
                        <a href="#5-application-scopes" aria-label="5. Application Scopes">5. Application Scopes</a><ul>
                            
                    <li>
                        <a href="#defining-an-application-scope" aria-label="Defining an application scope">Defining an application scope</a><ul>
                            
                    <li>
                        <a href="#top-level-attributes-2" aria-label="Top-Level Attributes">Top-Level Attributes</a></li>
                    <li>
                        <a href="#spec-3" aria-label="Spec">Spec</a><ul>
                            
                    <li>
                        <a href="#definitionref-1" aria-label="DefinitionRef">DefinitionRef</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#examples" aria-label="Examples">Examples</a></li>
                    <li>
                        <a href="#health-scope" aria-label="Health Scope">Health Scope</a><ul>
                            
                    <li>
                        <a href="#properties" aria-label="Properties">Properties</a></li>
                    <li>
                        <a href="#instance-example" aria-label="Instance Example">Instance Example</a></li>
                    <li>
                        <a href="#usage-example" aria-label="Usage Example">Usage Example</a></li></ul>
                    </li>
                    <li>
                        <a href="#network-scope" aria-label="Network Scope">Network Scope</a><ul>
                            
                    <li>
                        <a href="#properties-1" aria-label="Properties">Properties</a></li>
                    <li>
                        <a href="#instance-example-1" aria-label="Instance Example">Instance Example</a></li>
                    <li>
                        <a href="#usage-example-1" aria-label="Usage Example">Usage Example</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#6-traits" aria-label="6. Traits">6. Traits</a><ul>
                            
                    <li>
                        <a href="#rait-definition" aria-label="rait Definition">rait Definition</a><ul>
                            
                    <li>
                        <a href="#top-level-attributes-3" aria-label="Top-Level Attributes">Top-Level Attributes</a></li>
                    <li>
                        <a href="#spec-4" aria-label="Spec">Spec</a><ul>
                            
                    <li>
                        <a href="#definitionref-2" aria-label="DefinitionRef">DefinitionRef</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#implementing-a-trait-system" aria-label="Implementing a Trait System">Implementing a Trait System</a></li>
                    <li>
                        <a href="#categories-of-traits" aria-label="Categories of Traits">Categories of Traits</a></li>
                    <li>
                        <a href="#trait-characteristics" aria-label="Trait Characteristics">Trait Characteristics</a></li></ul>
                    </li>
                    <li>
                        <a href="#7-application" aria-label="7. Application">7. Application</a><ul>
                            
                    <li>
                        <a href="#top-level-attributes-4" aria-label="Top-Level Attributes">Top-Level Attributes</a></li>
                    <li>
                        <a href="#spec-5" aria-label="Spec">Spec</a><ul>
                            
                    <li>
                        <a href="#component" aria-label="Component">Component</a></li>
                    <li>
                        <a href="#trait" aria-label="Trait">Trait</a><ul>
                            
                    <li>
                        <a href="#properties-2" aria-label="Properties">Properties</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#example-1" aria-label="Example">Example</a></li>
                    <li>
                        <a href="#component-instances" aria-label="Component Instances">Component Instances</a><ul>
                            
                    <li>
                        <a href="#releases" aria-label="Releases">Releases</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#8-practical-considerations" aria-label="8. Practical Considerations">8. Practical Considerations</a><ul>
                            
                    <li>
                        <a href="#proposal-stages-and-the-maturity-of-the-specification" aria-label="Proposal Stages and the Maturity of the Specification">Proposal Stages and the Maturity of the Specification</a></li>
                    <li>
                        <a href="#media-types" aria-label="Media Types">Media Types</a></li>
                    <li>
                        <a href="#security" aria-label="Security">Security</a></li></ul>
                    </li>
                    <li>
                        <a href="#9-design-principles" aria-label="9. Design Principles">9. Design Principles</a><ul>
                            
                    <li>
                        <a href="#separation-of-concerns" aria-label="Separation of Concerns">Separation of Concerns</a></li>
                    <li>
                        <a href="#runtime-neutrality" aria-label="Runtime Neutrality">Runtime Neutrality</a></li>
                    <li>
                        <a href="#balance-elegance" aria-label="Balance (Elegance)">Balance (Elegance)</a></li>
                    <li>
                        <a href="#reusability" aria-label="Reusability">Reusability</a></li>
                    <li>
                        <a href="#application-models-are-not-programming-models" aria-label="Application Models Are Not Programming Models">Application Models Are Not Programming Models</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h2 id="1-purpose-and-goals">1. Purpose and Goals<a hidden class="anchor" aria-hidden="true" href="#1-purpose-and-goals">#</a></h2>
<p>Open Application Model 的目标是<strong>定义一种标准的、与基础设施无关的方法，用于描述跨混合环境、云甚至边缘设备的应用部署</strong>。</p>
<p>该模型要解决的核心问题是<strong>如何组成分布式应用程序</strong>，然后成功地将其交给负责操作的人员。问题不在于如何编写程序，而在于如何采用面向服务（或面向微服务）架构的组件，并简化围绕此类应用的工作流程。</p>
<p>例如，当代的云应用程序可能由几十个微服务组成，每个微服务负责广义上的 application 的一个独立部分。此类应用程序需要进行配置、部署、审核、更新和删除。有时必须将应用程序作为一个整体来处理，有时则需要更精细的粒度。最重要的是，此类应用程序通常不是由一个人或一个团队管理，而是由多个团队管理，他们必须通力合作，以实现可靠性、稳定性和及时性。</p>
<p>该模型提供了对此类 workflow 的描述，描述本身具有声明性、可扩展性和最佳清晰度。此外，它还提出了操作此类应用程序的模式和流程。该模型将重点关注 cloud native（即 highly distributed）应用，涵盖公共云技术、内部部署解决方案以及物联网/边缘技术。这为现代应用交付系统奠定了坚实的基础，为云原生应用部署提供了标准但更高层次的描述。</p>
<p>Non-goals 包括</p>
<ul>
<li>定义或规定特定的协调工具。</li>
<li>定义运行资源的模式，例如（但不限于）：
<ul>
<li>Secrets (secure, encrypted values)</li>
<li>Networks</li>
<li>Volumes</li>
</ul>
</li>
<li>描述或定义运行时基础设施本身。</li>
</ul>
<h2 id="2-overview-and-terminology">2. Overview and Terminology<a hidden class="anchor" aria-hidden="true" href="#2-overview-and-terminology">#</a></h2>
<p>本节概述了 Open Application Model (OAM) 及其术语。本节首先确定了运行云本地应用程序过程中涉及的组织角色。然后，介绍本文档中使用的特定术语。</p>
<p>本文档提出的云本地应用程序定义模型如下：</p>
<blockquote>
<p>云本地应用程序是一系列相互关联但又互不关联的组件（服务、任务、工作者）的集合，当这些组件与配置耦合并在合适的运行时基础架构中实例化时，可共同完成统一的功能目的。</p>
</blockquote>
<p>在当前版本中，该应用模式定义了以下内容：</p>
<ul>
<li>Components 代表一个可运行的单元。</li>
<li>Workload types 标识组件可执行的不同工作负载</li>
<li>Traits 是覆盖层，可通过附加的特定操作功能来增强组件。Traits 代表操作员关注的问题，而不是开发人员/软件所有者关注的问题。</li>
<li>Application scopes 通过对具有共同属性或依赖性的组件进行分组，代表了应用的边界。</li>
<li>Application configuration 集合了一组组件实例、它们的特性、它们所在的应用范围，并结合了配置参数和元数据。</li>
</ul>
<p>因此，应用程序是具有一系列运行特征的组件的集合，并被集中到一个或多个应用程序边界中。</p>
<center><figure>
    <img loading="lazy" src="./overview.png" width="100%"/> 
</figure>
</center>
<h2 id="3-component-model">3. Component Model<a hidden class="anchor" aria-hidden="true" href="#3-component-model">#</a></h2>
<p>本节定义组件模型。</p>
<p>组件描述了可作为更大的分布式应用程序的一部分进行实例化的功能单元。应用程序部分将介绍如何将组件组合在一起以及如何配置这些组件的实例，而本节将重点介绍组件模型本身。</p>
<center><figure>
    <img loading="lazy" src="./modern_app.png" width="100%"/> 
</figure>
</center>
<p>组件定义（ComponentDefinition）实体的作用是允许组件提供者以基础设施中立格式声明此类执行单元的运行时特性。</p>
<p>例如，应用程序中的每个微服务都被描述为一个组件。请注意，ComponentDefinition 本身并不是该微服务的实例，而是该微服务可配置属性的声明。这些可配置属性应作为参数列表公开，以便应用团队在部署时设置并实例化该组件。</p>
<p>在实践中，一个简单的容器化工作负载、一个 Helm 图表或一个云数据库都可以建模为一个组件。</p>
<h3 id="top-level-attributes">Top-Level Attributes<a hidden class="anchor" aria-hidden="true" href="#top-level-attributes">#</a></h3>
<p>以下是提供组件定义顶层信息的属性。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A string that identifies the version of the schema the object should have. The core types uses <code>core.oam.dev/v1beta1</code> in this version of model</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>Must be <code>ComponentDefinition</code></td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><a href="#metadata"><code>Metadata</code></a></td>
<td>Y</td>
<td></td>
<td>Entity metadata.</td>
</tr>
<tr>
<td><code>spec</code></td>
<td><a href="#spec"><code>Spec</code></a></td>
<td>Y</td>
<td></td>
<td>The specification for the component definition.</td>
</tr>
</tbody>
</table>
<h3 id="metadata">Metadata<a hidden class="anchor" aria-hidden="true" href="#metadata">#</a></h3>
<p>该元数据部分由几个 top-level keys 组成。元数据提供有关对象内容的信息。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A name for the schematic. <code>name</code> is subject to the restrictions listed beneath this table.</td>
</tr>
<tr>
<td><code>labels</code></td>
<td><code>map[string]string</code></td>
<td>N</td>
<td></td>
<td>A set of string key/value pairs used as arbitrary labels on this component. See the &ldquo;Label format&rdquo; section immediately below.</td>
</tr>
<tr>
<td><code>annotations</code></td>
<td><code>map[string]string</code></td>
<td>N</td>
<td></td>
<td>A set of string key/value pairs used as arbitrary descriptive text associated with this object. See the &ldquo;Annotations format&rdquo; section immediately below.</td>
</tr>
</tbody>
</table>
<ul>
<li><code>name</code>：group、kind、name 的组合必须是唯一的。两个不同的种类（例如组件和特质）可以使用相同的名称，而不会造成冲突。Version 不是区分因素。</li>
</ul>
<p><em>Okay:</em> 每种类型都允许使用名称 <code>foo</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Trait</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><em>Okay:</em> 每个组（<code>one.dev</code> 和 <code>other.dev</code>）都允许使用名称为 <code>foo</code> 的组件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">one.dev/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">other.dev/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><em>NOT Okay:</em> Version 不是命名空间限定符。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">foo</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>name 字段的格式必须如下：</p>
<blockquote>
<p>name 字段为必填字段，必须在 63 个字符以内，以字母数字字符（[a-z0-9A-Z]）开头和结尾，中间包含破折号 (-)、下划线 (_)、点 (.)和字母数字。</p>
</blockquote>
<p>除非另有说明，否则 name 在 Group/Version/Kind 中必须是唯一的。</p>
<ul>
<li>Label：标签遵循 <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Kubernetes 规范</a> 进行标记：</li>
</ul>
<blockquote>
<p>有效的标签密钥有两部分：可选的前缀和名称，以斜线 (/) 分隔。名称部分是必需的，长度必须在 63 个字符以内，以字母数字字符（[a-z0-9A-Z]）开头和结尾，中间包含破折号 (-)、下划线 (_)、点 (.)和字母数字。前缀为可选项。如果指定了前缀，则前缀必须是 DNS 子域：由点（.）分隔的一系列 DNS 标签，总长度不超过 253 个字符，后跟斜线 (/)。</p>
</blockquote>
<ul>
<li>Annotations：注解提供了一种在对象元数据中附加任意文本的机制。注释对象遵循<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/#syntax-and-character-set">Kubernetes 规范</a>：</li>
</ul>
<blockquote>
<p>注释是键/值对。有效的注解键有两个部分：可选的前缀和名称，以斜线（/）分隔。名称部分是必填项，必须少于或等于 63 个字符，以字母数字字符（[a-z0-9A-Z]）开头和结尾，中间包含破折号 (-)、下划线 (_)、点 (.)和字母数字。前缀为可选项。如果指定了前缀，则前缀必须是 DNS 子域：由点（.）分隔的一系列 DNS 标签，总长度不超过 253 个字符，后跟斜线 (/)。</p>
</blockquote>
<p>下列注释标签是 _predefined_ 和 RECOMMENDED</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>description</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>A short description of the component.</td>
</tr>
<tr>
<td><code>version</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>A user provided string defining the <a href="https://semver.org/">semantic version</a> of the component, e.g. the release version of this software</td>
</tr>
</tbody>
</table>
<p>如果未提供 <code>version</code> ，则根据 <a href="https://semver.org/">SemVer</a> 规范，默认版本假定为 <code>0.1.0</code>。</p>
<p>例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">alpine-task</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">my-app-v1 </span><span class="w"> </span><span class="c"># Non-normative example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1.0.1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l">A task that is backed by an Alpine Linux filesystem</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>元数据部分用于所有示意图。它也与 Kubernetes 元数据部分兼容。但请注意，Kubernetes 元数据是 OAM 元数据的超集，包含 OAM 无法识别的属性。</p>
<h4 id="group-version-and-kind">Group, Version, and Kind<a hidden class="anchor" aria-hidden="true" href="#group-version-and-kind">#</a></h4>
<p>本文档中描述的许多 API 对象都使用了一种名为 &ldquo;Group, Version, Kind&rdquo; 的命名方案。该方案由 Kubernetes 推广，为 API 对象的命名间距和版本提供了一致的方式，在此用于 OAM API 对象的版本控制。本节将介绍该方案。</p>
<h5 id="group">Group<a hidden class="anchor" aria-hidden="true" href="#group">#</a></h5>
<p>组是收集多个相关 kinds 的 namespace 。组使用 DNS 命名约定。组的示例有</p>
<ul>
<li>components.oam.dev</li>
<li>functions.azure.com</li>
<li>my.dev</li>
</ul>
<p>oam.dev 域下的所有组都被视为 OAM 对象的保留组。此处指定的所有对象都属于该域中的组。</p>
<p>组必须是全局唯一的。</p>
<h5 id="version">Version<a hidden class="anchor" aria-hidden="true" href="#version">#</a></h5>
<p>version 字符串是 API 的版本。按照通用范例，API 仅按主版本号进行版本控制。API 版本中省略了次版本号和补丁号。底层引擎的实际次要版本和补丁版本可能会重复，但它们必须重复此版本以处理任何破坏性更改。换句话说，主版本号是兼容性的保证，次版本号和补丁号不应改变这一保证。因此，API 的用户不能指定比主版本更细的粒度。</p>
<p>API 版本号的前缀总是 v，后面跟一个或多个数字。</p>
<ul>
<li>v1</li>
<li>v2</li>
<li>v973</li>
</ul>
<p>主要版本号中还有两个附加修饰符：</p>
<ul>
<li><code>alphaN</code>（其中 N 为一位或多位数）表示该功能是试验性的，可能会被移除，但其当前的兼容性标记为 1。</li>
<li><code>betaN</code>（其中 N 为一位或多位数）表示该特征尚未稳定。N 是兼容性标记。</li>
</ul>
<p>标记为 <code>alpha</code> 或 <code>beta</code> 的 API 版本被认为是不稳定的，容易出现破坏性更改。</p>
<p>一次只能使用两种修改器中的一种：</p>
<ul>
<li><code>v1alpha1</code></li>
<li><code>v973beta231</code></li>
</ul>
<p>兼容性只能通过精确匹配来确定。<code>v1</code> 与 <code>v2</code>、<code>v1alpha1</code> 或 <code>v1beta2</code> 不兼容。</p>
<p>版本没有唯一性要求。</p>
<h5 id="kind">Kind<a hidden class="anchor" aria-hidden="true" href="#kind">#</a></h5>
<p>种类是类型的名称。例如，组件的种类是 &ldquo;组件&rdquo;（Component），而特质的种类是 &ldquo;特质&rdquo;（Trait）。种类总是由首字母大写的单词组成，每个单词的第一个字母都要大写。种类应大写首字母缩写的每个字母（例如，HTTP，而不是 Http）。</p>
<p>在一个组中，种类必须是唯一的。</p>
<h5 id="groupversionkind-的表述">Group/Version/Kind 的表述<a hidden class="anchor" aria-hidden="true" href="#groupversionkind-的表述">#</a></h5>
<p>Group/Version/Kind 的完全限定表示法是 GROUP/VERSION.KIND。下面是一些示例：</p>
<ul>
<li><code>local.dev/v7alpha2.Proxy</code></li>
<li><code>cache.example.com/v1.Redis</code></li>
<li><code>azure.com/v2.Functions</code></li>
</ul>
<p>在示意图中，Group 和 Version 在一个字段中显示，Kind 在另一个字段中显示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">local.dev/v7alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Proxy</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在极少数情况下，有必要链接组和种类，但不指定版本。例如，在声明默认工作负载时就需要这样做。一般情况下，不推荐这种行为，但在必要时，本规范会遵循 Kubernetes 的模式，用复数种类名称和组来构建 DNS 名称：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Proxies.local.dev # allowed but discouraged
</span></span></code></pre></td></tr></table>
</div>
</div><p>这种形式不被接受为完全合格版本的替代形式。只有在模型明确规定接受这种形式的情况下才会被接受。</p>
<h3 id="spec">Spec<a hidden class="anchor" aria-hidden="true" href="#spec">#</a></h3>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>workload</code></td>
<td><a href="#workloadtypedescriptor"><code>WorkloadTypeDescriptor</code></a></td>
<td>Y</td>
<td></td>
<td>Identifier to <a href="#4-workload-types">workload type</a> of this component.</td>
</tr>
<tr>
<td><code>schematic</code></td>
<td><a href="#schematic">Schematic</a></td>
<td>Y</td>
<td></td>
<td>Schematic information for this component.</td>
</tr>
</tbody>
</table>
<h4 id="workloadtypedescriptor">WorkloadTypeDescriptor<a hidden class="anchor" aria-hidden="true" href="#workloadtypedescriptor">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A reference to a <code>WorkloadDefinition</code> via name.</td>
</tr>
<tr>
<td><code>definition</code></td>
<td><a href="#workloadgvk">WorkloadGVK</a></td>
<td>Y</td>
<td></td>
<td>Mutually exclusive to <code>type</code>, a reference to <code>WorkloadDefinition</code> via group, version, and kind.</td>
</tr>
</tbody>
</table>
<h5 id="workloadgvk">WorkloadGVK<a hidden class="anchor" aria-hidden="true" href="#workloadgvk">#</a></h5>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The API version the workload type.</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The API kind of the workload type.</td>
</tr>
</tbody>
</table>
<h4 id="schematic">Schematic<a hidden class="anchor" aria-hidden="true" href="#schematic">#</a></h4>
<p>本节声明了一个组件的示意图，该组件可在以后的部署工作流程中作为应用程序的一部分实例化。请注意，OAM 本身并不强制要求如何实现示意图，只要它能做到以下几点即可：</p>
<ol>
<li>为可部署单元建模；</li>
<li>公开 JSON 模式或等效参数列表。</li>
</ol>
<p>在 KubeVela 中，目前支持以下方案实现（&ldquo;cue&rdquo;、&ldquo;helm &ldquo;和 &ldquo;kube&rdquo;）。</p>
<h5 id="example">Example<a hidden class="anchor" aria-hidden="true" href="#example">#</a></h5>
<p>下面是一个完整的基于 CUE 的组件定义示例，名为 &ldquo;webserver&rdquo;：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ComponentDefinition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">definition.oam.dev/description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;webserver is a combo of Deployment + Service&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workload</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">definition</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">schematic</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cue</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">        output: {
</span></span></span><span class="line"><span class="cl"><span class="sd">            apiVersion: &#34;apps/v1&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">            kind:       &#34;Deployment&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">            spec: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                selector: matchLabels: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                    &#34;app.oam.dev/component&#34;: context.name
</span></span></span><span class="line"><span class="cl"><span class="sd">                }
</span></span></span><span class="line"><span class="cl"><span class="sd">                template: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                    metadata: labels: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                        &#34;app.oam.dev/component&#34;: context.name
</span></span></span><span class="line"><span class="cl"><span class="sd">                    }
</span></span></span><span class="line"><span class="cl"><span class="sd">                    spec: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                        containers: [{
</span></span></span><span class="line"><span class="cl"><span class="sd">                            name:  context.name
</span></span></span><span class="line"><span class="cl"><span class="sd">                            image: parameter.image
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">                            if parameter[&#34;cmd&#34;] != _|_ {
</span></span></span><span class="line"><span class="cl"><span class="sd">                                command: parameter.cmd
</span></span></span><span class="line"><span class="cl"><span class="sd">                            }
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">                            if parameter[&#34;env&#34;] != _|_ {
</span></span></span><span class="line"><span class="cl"><span class="sd">                                env: parameter.env
</span></span></span><span class="line"><span class="cl"><span class="sd">                            }
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">                            if context[&#34;config&#34;] != _|_ {
</span></span></span><span class="line"><span class="cl"><span class="sd">                                env: context.config
</span></span></span><span class="line"><span class="cl"><span class="sd">                            }
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">                            ports: [{
</span></span></span><span class="line"><span class="cl"><span class="sd">                                containerPort: parameter.port
</span></span></span><span class="line"><span class="cl"><span class="sd">                            }]
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">                            if parameter[&#34;cpu&#34;] != _|_ {
</span></span></span><span class="line"><span class="cl"><span class="sd">                                resources: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                                    limits:
</span></span></span><span class="line"><span class="cl"><span class="sd">                                        cpu: parameter.cpu
</span></span></span><span class="line"><span class="cl"><span class="sd">                                    requests:
</span></span></span><span class="line"><span class="cl"><span class="sd">                                        cpu: parameter.cpu
</span></span></span><span class="line"><span class="cl"><span class="sd">                                }
</span></span></span><span class="line"><span class="cl"><span class="sd">                            }
</span></span></span><span class="line"><span class="cl"><span class="sd">                        }]
</span></span></span><span class="line"><span class="cl"><span class="sd">                }
</span></span></span><span class="line"><span class="cl"><span class="sd">                }
</span></span></span><span class="line"><span class="cl"><span class="sd">            }
</span></span></span><span class="line"><span class="cl"><span class="sd">        }
</span></span></span><span class="line"><span class="cl"><span class="sd">        // an extra template
</span></span></span><span class="line"><span class="cl"><span class="sd">        outputs: service: {
</span></span></span><span class="line"><span class="cl"><span class="sd">            apiVersion: &#34;v1&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">            kind:       &#34;Service&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">            spec: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                selector: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                    &#34;app.oam.dev/component&#34;: context.name
</span></span></span><span class="line"><span class="cl"><span class="sd">                }
</span></span></span><span class="line"><span class="cl"><span class="sd">                ports: [
</span></span></span><span class="line"><span class="cl"><span class="sd">                    {
</span></span></span><span class="line"><span class="cl"><span class="sd">                        port:       parameter.port
</span></span></span><span class="line"><span class="cl"><span class="sd">                        targetPort: parameter.port
</span></span></span><span class="line"><span class="cl"><span class="sd">                    },
</span></span></span><span class="line"><span class="cl"><span class="sd">                ]
</span></span></span><span class="line"><span class="cl"><span class="sd">            }
</span></span></span><span class="line"><span class="cl"><span class="sd">        }
</span></span></span><span class="line"><span class="cl"><span class="sd">        parameter: {
</span></span></span><span class="line"><span class="cl"><span class="sd">            image: string
</span></span></span><span class="line"><span class="cl"><span class="sd">            cmd?: [...string]
</span></span></span><span class="line"><span class="cl"><span class="sd">            port: *80 | int
</span></span></span><span class="line"><span class="cl"><span class="sd">            env?: [...{
</span></span></span><span class="line"><span class="cl"><span class="sd">                name:   string
</span></span></span><span class="line"><span class="cl"><span class="sd">                value?: string
</span></span></span><span class="line"><span class="cl"><span class="sd">                valueFrom?: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                    secretKeyRef: {
</span></span></span><span class="line"><span class="cl"><span class="sd">                        name: string
</span></span></span><span class="line"><span class="cl"><span class="sd">                        key:  string
</span></span></span><span class="line"><span class="cl"><span class="sd">                    }
</span></span></span><span class="line"><span class="cl"><span class="sd">                }
</span></span></span><span class="line"><span class="cl"><span class="sd">            }]
</span></span></span><span class="line"><span class="cl"><span class="sd">            cpu?: string
</span></span></span><span class="line"><span class="cl"><span class="sd">        }</span><span class="w">        
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在平台中安装了上述 <code>webserver</code> 后，用户就可以在应用程序中部署该组件，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webserver-demo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">components</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-world</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">webserver              </span><span class="w"> </span><span class="c"># claim to deploy webserver component definition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">properties</span><span class="p">:</span><span class="w">                   </span><span class="c"># setting parameter values</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">crccheck/hello-world</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8000</span><span class="w">                  </span><span class="c"># this port will be automatically exposed to public</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;foo&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;bar&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;100m&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4-workload-types">4. Workload Types<a hidden class="anchor" aria-hidden="true" href="#4-workload-types">#</a></h2>
<p>工作负载类型（Workload Types）的使用将在组件模型部分介绍，但这里将对工作负载类型定义进行说明。</p>
<p>工作负载类型是给定组件定义的关键特征。工作负载类型由平台提供，以便用户检查平台并了解有哪些工作负载类型可供使用。请注意，工作负载类型不可扩展给最终用户（只能扩展给平台操作员）。因此，终端用户不得创建新的工作负载类型。</p>
<h3 id="workload-definition">Workload Definition<a hidden class="anchor" aria-hidden="true" href="#workload-definition">#</a></h3>
<p>工作负载类型以 &ldquo;工作负载定义&rdquo;（<code>WorkloadDefinition</code>）的形式呈现，此外，为了便于发现，工作负载定义还带有<a href="#characteristics-of-workload-types">特性信息</a>，可提示平台如何将<a href="6.traits.md">特性</a> 附加到引用该工作负载类型的给定组件上（即特性系统的<em>适用于</em>特性）。</p>
<h4 id="top-level-attributes-1">Top-Level Attributes<a hidden class="anchor" aria-hidden="true" href="#top-level-attributes-1">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A string that identifies the version of the schema the object should have. The core types uses <code>core.oam.dev/v1beta1</code> in this version of model</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>Must be <code>WorkloadDefinition</code></td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><a href="#metadata"><code>Metadata</code></a></td>
<td>Y</td>
<td></td>
<td>Entity metadata.</td>
</tr>
<tr>
<td><code>spec</code></td>
<td><a href="#spec"><code>Spec</code></a></td>
<td>Y</td>
<td></td>
<td>The specification for the workload definition.</td>
</tr>
</tbody>
</table>
<h4 id="spec-1">Spec<a hidden class="anchor" aria-hidden="true" href="#spec-1">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>definitionRef</code></td>
<td><a href="#definitionref"><code>DefinitionRef</code></a></td>
<td>Y</td>
<td></td>
<td>Identifier to workload capability in the platform.</td>
</tr>
</tbody>
</table>
<h5 id="definitionref">DefinitionRef<a hidden class="anchor" aria-hidden="true" href="#definitionref">#</a></h5>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>Name identifier of the workload capability. Mutually exclusive to <code>apiVersion</code> and <code>kind</code>.</td>
</tr>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>API version of the workload capability.</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>Kind of the workload capability.</td>
</tr>
</tbody>
</table>
<h3 id="characteristics-of-workload-types">Characteristics of Workload Types<a hidden class="anchor" aria-hidden="true" href="#characteristics-of-workload-types">#</a></h3>
<p>下面工作负载定义中保留的 &ldquo;metadata.labels&rdquo; 用于表示工作负载类型的 _the distinguishing characteristics_。</p>
<p>这些特征将通过 traits 系统的 _applies to_ 功能来实现。</p>
<table>
<thead>
<tr>
<th>Label</th>
<th>Type</th>
<th>Explain</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>workload.oam.dev/replicable</code></td>
<td>boolean</td>
<td>Whether they are replicable. If not, no replication or scaling traits may be assigned.</td>
</tr>
<tr>
<td><code>workload.oam.dev/daemonized</code></td>
<td>boolean</td>
<td>Whether they are daemonized. For daemon types, if the workload exits, this is considered a fault, and the system must fix it. For non-daemonized types, exit is considered a success if no error is reported.</td>
</tr>
<tr>
<td><code>workload.oam.dev/exposed</code></td>
<td>boolean</td>
<td>Whether they are exposed, i.e. have a service endpoint with a stable name for network traffic. Workload types that have a service endpoint need a virtual IP address (VIP) with a DNS name to represent the component as a whole, addressable within their network scope and can be assigned traffic routing traits.</td>
</tr>
<tr>
<td><code>workload.oam.dev/podspecable</code></td>
<td>boolean</td>
<td>Whether this workload can be addressed by Kubernetes <code>PodSpec</code>. If yes, the implementation could manipulate the workload by leveraging <code>PodSpec</code> structure, instead of being agnostic of the workload&rsquo;s schematic.</td>
</tr>
</tbody>
</table>
<h3 id="categories-of-workload-types">Categories of Workload Types<a hidden class="anchor" aria-hidden="true" href="#categories-of-workload-types">#</a></h3>
<p>Workload Type 可分为几类。</p>
<h4 id="officially-maintained-workload-type">Officially Maintained Workload Type<a hidden class="anchor" aria-hidden="true" href="#officially-maintained-workload-type">#</a></h4>
<p>正式维护的工作负载类型必须属于 &ldquo;oam.dev &ldquo;组。</p>
<p>下面是一个官方维护工作负载类型的示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">WorkloadDefinition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">definitionRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">containerizedworkloads.core.oam.dev</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>该 Workload Type 的说明：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Category</th>
<th>Schema</th>
<th>Exposed</th>
<th>Replicable</th>
<th>Daemonized</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#server">Server</a></td>
<td>Core</td>
<td><a href="#containerized-workload">ContainerizedWorkload</a></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h4 id="extended-workload-type">Extended Workload Type<a hidden class="anchor" aria-hidden="true" href="#extended-workload-type">#</a></h4>
<p>每个 OAM 运行时都可以定义本组之外的工作负载类型，它们将被视为扩展工作负载类型。扩展工作负载类型的名称和模式完全由 OAM 实施自行决定。</p>
<p>下面是一个示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">WorkloadDefinition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">redis.cache.aliyun.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">definitionRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">redis.cache.aliyun.com</span><span class="w"> </span><span class="c"># this is an extended workload type</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>对于扩展工作负载类型，建议使用以下约定：</p>
<ul>
<li>使用 <code>Group/Version/Kind</code> 唯一标识工作负载能力。</li>
<li><code>name</code> 遵循 <a href="#group-version-and-kind">Group/Version/Kind</a> 中描述的格式。</li>
<li><code>WorkloadDefinition</code> 的 <code>name</code> 与它所指向的 <code>name</code> 相同。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">WorkloadDefinition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">schema.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">definitionRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">schema.example.com</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="server">Server<a hidden class="anchor" aria-hidden="true" href="#server">#</a></h3>
<p>服务器是一种 OAM 核心工作负载类型，用于定义长期运行、可扩展的工作负载，这些负载有一个名称稳定的网络端点，用于接收整个组件的网络流量。常见用例包括暴露 API 的网络应用程序和服务。服务器工作负载类型具有以下特征：</p>
<ul>
<li>定义了一个容器运行时，同一容器的零个或多个副本可同时运行。</li>
<li>应用程序操作员可以通过应用和配置可用特性来增加或减少组件副本的数量。</li>
<li>服务器是守护进程化的。无论错误代码如何，运行时都必须尝试重新启动退出的副本。</li>
<li>服务器有一个网络端点，该端点具有自动分配的虚拟 IP 地址（VIP）和 DNS 名称，可在组件所属的网络范围内寻址。</li>
</ul>
<blockquote>
<p>如果服务器没有在至少一个容器上提供至少一个端口，实现就应该发出错误信息。</p>
</blockquote>
<h4 id="how-to-use">How to use?<a hidden class="anchor" aria-hidden="true" href="#how-to-use">#</a></h4>
<ol>
<li>在基于 OAM 的平台中安装以下工作负载定义：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">WorkloadDefinition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">definitionRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">containerizedworkloads.core.oam.dev</span><span class="w"> </span><span class="c"># the reference of schema for this workload type. In Kubernetes it should be a full name of API resource</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>将组件引用服务器定义为工作负载：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ComponentDefinition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">definition.oam.dev/description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;webserver is a combo of Deployment + Service&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workload</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Server</span><span class="w"> </span><span class="c"># reference above workload definition by name.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">schematic</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">...</span><span class="w"> </span><span class="c"># CUE code to define user schematic.</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="containerized-workload">Containerized Workload<a hidden class="anchor" aria-hidden="true" href="#containerized-workload">#</a></h3>
<p>ContainerizedWorkload 是无服务器容器风格的工作负载定义，可作为 Azure ACI、AWS Fargate 或 Kubernetes 的简单无状态工作负载等运行时平台的长期运行容器化工作负载类型的模式。</p>
<blockquote>
<p>注意：根据设计，ContainerizedWorkload 模式并不等同于 Kubernetes Pod 规范。作为无服务器风格工作负载的模式，ContainerizedWorkload 计划只关注面向开发人员的基元，并且是自包含的，因此开发人员无需定义 ConfigMap 或 Secret 等对象。此外，它默认公开容器端口。因此，如果您正在为基于 Kubernetes 的 PaaS 寻找通用工作负载模式，我们建议您查看 PodSpecWorkload 规范。</p>
</blockquote>
<p>以下是 ContainerizedWorkload 的规范示意图。</p>
<h4 id="top-level-attributes-of-a-containerized-workload">Top-Level Attributes of a containerized workload<a hidden class="anchor" aria-hidden="true" href="#top-level-attributes-of-a-containerized-workload">#</a></h4>
<p>这些属性提供了有关容器化工作负载的顶级信息。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td><code>core.oam.dev/v1alpha2</code></td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td><code>ContainerizedWorkload</code></td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><a href="#metadata"><code>Metadata</code></a></td>
<td>Y</td>
<td></td>
<td>containerized workload metadata.</td>
</tr>
<tr>
<td><code>spec</code></td>
<td><a href="#spec-2"><code>Spec</code></a></td>
<td>Y</td>
<td></td>
<td>A container for the containerized workload spec.</td>
</tr>
</tbody>
</table>
<h4 id="spec-2">Spec<a hidden class="anchor" aria-hidden="true" href="#spec-2">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>osType</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>The OS required to host (all of) the component&rsquo;s containers (since containers share a kernel with the underlying host). Possible values include:<ul><li>linux</li><li>windows</li></ul> For extended runtimes, this is passed in unaltered. Default can be none and let the runtime decide where to place the component.</td>
</tr>
<tr>
<td><code>arch</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>The CPU architecture required to host (all of) the component&rsquo;s containers (since containers share physical hardware with the underlying host). Possible values include:<ul><li>i386</li><li>amd64</li><li>arm</li><li>arm64</li></ul> Default can be none and let the runtime chose architecture.</td>
</tr>
<tr>
<td><code>containers</code></td>
<td><a href="#container"><code>[]Container</code></a></td>
<td>Y</td>
<td></td>
<td>The OCI container(s) that implement the component.</td>
</tr>
</tbody>
</table>
<h4 id="container">Container<a hidden class="anchor" aria-hidden="true" href="#container">#</a></h4>
<p>本节介绍为该组件运行容器化工作负载所需的运行时配置。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The container&rsquo;s name. Must be unique per component.</td>
</tr>
<tr>
<td><code>image</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A path-like or URI-like representation of the location of an OCI image. Where applicable, this MAY be prefixed with a registry address, SHOULD be suffixed with a tag.</td>
</tr>
<tr>
<td><code>resources</code></td>
<td><a href="#resources"><code>Resources</code></a></td>
<td>Y</td>
<td></td>
<td>Resources required by the container.</td>
</tr>
<tr>
<td><code>cmd</code></td>
<td><code>[]string</code></td>
<td>N</td>
<td></td>
<td>Entrypoint array.</td>
</tr>
<tr>
<td><code>args</code></td>
<td><code>[]string</code></td>
<td>N</td>
<td></td>
<td>Arguments to the entrypoint. The container image&rsquo;s CMD is used if this is not provided.</td>
</tr>
<tr>
<td><code>env</code></td>
<td><a href="#env"><code>[]Env</code></a></td>
<td>N</td>
<td></td>
<td>Environment variables for the container.</td>
</tr>
<tr>
<td><code>config</code></td>
<td><a href="#configfile"><code>[]ConfigFile</code></a></td>
<td>N</td>
<td></td>
<td>Locations to write configuration as files accessible within the container</td>
</tr>
<tr>
<td><code>ports</code></td>
<td><a href="#port"><code>[]Port</code></a></td>
<td>N</td>
<td></td>
<td>Ports exposed by the container.</td>
</tr>
<tr>
<td><code>livenessProbe</code></td>
<td><a href="#healthprobe"><code>HealthProbe</code></a></td>
<td>N</td>
<td></td>
<td>Instructions for assessing whether the container is alive.</td>
</tr>
<tr>
<td><code>readinessProbe</code></td>
<td><a href="#healthprobe"><code>HealthProbe</code></a></td>
<td>N</td>
<td></td>
<td>Instructions for assessing whether the container is in a suitable state to serve traffic.</td>
</tr>
<tr>
<td><code>imagePullSecret</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>Key that can be used to retrieve the credentials for pulling this secret.</td>
</tr>
</tbody>
</table>
<h5 id="resources">Resources<a hidden class="anchor" aria-hidden="true" href="#resources">#</a></h5>
<p>资源描述附加到运行时的计算资源。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cpu</code></td>
<td><a href="#cpu"><code>CPU</code></a></td>
<td>Y</td>
<td></td>
<td>Specifies the attributes of the cpu resource required for the container.</td>
</tr>
<tr>
<td><code>memory</code></td>
<td><a href="#memory"><code>Memory</code></a></td>
<td>Y</td>
<td></td>
<td>Specifies the attributes of the memory resource required for the container.</td>
</tr>
<tr>
<td><code>gpu</code></td>
<td><a href="#gpu"><code>GPU</code></a></td>
<td>N</td>
<td></td>
<td>Specifies the attributes of the gpu resources required for the container.</td>
</tr>
<tr>
<td><code>volumes</code></td>
<td><a href="#volume"><code>[]Volume</code></a></td>
<td>N</td>
<td></td>
<td>Specifies the attributes of the volumes that the container uses.</td>
</tr>
<tr>
<td><code>extended</code></td>
<td><a href="#extendedresource"><code>[]ExtendedResource</code></a></td>
<td>N</td>
<td></td>
<td>Implementation-specific extended resource requirements</td>
</tr>
</tbody>
</table>
<p>对于底层平台无法满足的任何资源，平台必须返回错误并停止部署。资源被视为一种需求，无法满足该需求意味着运行时不得部署应用程序。例如，如果应用程序请求 <code>1P</code> 内存，而内存量不可用，则应用程序部署必须失败。同样，如果应用程序需要 <code>1</code> 个 GPU，而运行时没有提供 GPU，则应用程序部署必须失败。</p>
<h6 id="cpu">CPU<a hidden class="anchor" aria-hidden="true" href="#cpu">#</a></h6>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>required</code></td>
<td><code>double</code></td>
<td>Y</td>
<td></td>
<td>The minimum number of logical cpus required for running this container.</td>
</tr>
</tbody>
</table>
<h6 id="memory">Memory<a hidden class="anchor" aria-hidden="true" href="#memory">#</a></h6>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>required</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The minimum amount of memory required for running this container. The value should be a positive integer with/without unit suffix: P, T, G, M, K. If no unit is given, it defaults to &lsquo;bytes&rsquo;.</td>
</tr>
</tbody>
</table>
<h6 id="gpu">GPU<a hidden class="anchor" aria-hidden="true" href="#gpu">#</a></h6>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>required</code></td>
<td><code>double</code></td>
<td>Y</td>
<td></td>
<td>The minimum number of gpus  required for running this container.</td>
</tr>
</tbody>
</table>
<h6 id="volume">Volume<a hidden class="anchor" aria-hidden="true" href="#volume">#</a></h6>
<p>卷描述了名称、挂载卷的位置、访问模式（如读/写或只读）以及挂载的共享策略。它还描述了卷所需的底层磁盘属性。</p>
<p>路径格式取决于消费组件的操作系统，但实现应支持类似 UNIX 的路径表示法。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>Specifies the name used to reference the path.</td>
</tr>
<tr>
<td><code>mountPath</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>Specifies the actual mount path in the filesystem.</td>
</tr>
<tr>
<td><code>accessMode</code></td>
<td><code>string</code></td>
<td>N</td>
<td><code>RW</code></td>
<td>Specifies the access mode. Allowed values are <code>RW</code> (read/write) and <code>RO</code> (read-only).</td>
</tr>
<tr>
<td><code>sharingPolicy</code></td>
<td><code>string</code></td>
<td>N</td>
<td><code>Exclusive</code></td>
<td>The sharing policy for the mount, indicating if it is expected to be shared or not. Allowed values are <code>Exclusive</code> and <code>Shared</code>.</td>
</tr>
<tr>
<td><code>disk</code></td>
<td><a href="#disk"><code>Disk</code></a></td>
<td>N</td>
<td></td>
<td>Specifies the attributes of the underneath disk resources required by the volume.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;configuration&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l">RO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">sharingPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Shared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">disk</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2G&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ephemeral</span><span class="p">:</span><span class="w"> </span><span class="kc">n</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上述操作要求在路径 <code>/etc/config</code> 下挂载一个只读卷，该卷由一个至少提供 2G 非短暂存储空间的卷支持。</p>
<h6 id="disk">Disk<a hidden class="anchor" aria-hidden="true" href="#disk">#</a></h6>
<p>磁盘指定卷所使用磁盘的属性。它描述了最小磁盘大小和磁盘是否短暂等信息。短暂磁盘表示组件需要节点上最小的磁盘大小才能运行。例如，图像处理组件可能需要节点上更大的缓存才能运行，这时可以使用短暂磁盘。当短暂磁盘设置为假时，表示将使用外部磁盘。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>required</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The minimum disk size required for running this container. The value should be a positive value, greater than zero.</td>
</tr>
<tr>
<td><code>ephemeral</code></td>
<td><code>boolean</code></td>
<td>N</td>
<td></td>
<td>Specifies whether external disk needs to be mounted or not.</td>
</tr>
</tbody>
</table>
<h6 id="extendedresource">ExtendedResource<a hidden class="anchor" aria-hidden="true" href="#extendedresource">#</a></h6>
<p>扩展资源是针对特定实施资源的资源需求声明。例如，兼容 OAM 的平台可能会暴露出特殊的硬件。通过该字段，容器可以指出，为了让容器运行，需要提供此类特殊硬件。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The name of the resource, as a Group/Version/Kind</td>
</tr>
<tr>
<td><code>required</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The required condition.</td>
</tr>
</tbody>
</table>
<p><code>name</code> 字段必须是标识特定资源的 group/version/kind。</p>
<p>Example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">extended</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ext.example.com/v1.MotionSensor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ext.example.com/v2beta4.ServoModel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l">z141155-t100</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果已命名的扩展资源因故不可用，则在创建组件实例时，实现必须返回错误信息。</p>
<h5 id="env">Env<a hidden class="anchor" aria-hidden="true" href="#env">#</a></h5>
<p>Env 将环境变量描述为 name/value 的字符串。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The environment variable name. Must be unique per container.</td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>The environment variable value.</td>
</tr>
</tbody>
</table>
<p><code>name</code> 字段必须由有效的 Unicode 字母和数字字符以及 <code>_</code> 和 <code>-</code> 组成。</p>
<p>Example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;ADMIN_USER&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;admin&#34;</span><span class="w">  </span><span class="c"># This is a literal value</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="configfile">ConfigFile<a hidden class="anchor" aria-hidden="true" href="#configfile">#</a></h5>
<p>ConfigFile 描述了容器内可用文件的路径，以及将写入该文件的数据。这提供了一种将配置文件注入容器的方法。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>An absolute path within the container.</td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>The data to be written into the file at the specified path. If this is not supplied, <code>fromParam</code> must be supplied</td>
</tr>
<tr>
<td><code>fromParam</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>The parameter whose value should be written into this file as a value</td>
</tr>
</tbody>
</table>
<p>path 字段必须包含一个遵守底层操作系统路径规则的路径。如果给出的是相对路径，实现必须假定该路径是相对于容器根目录的。如果使用这样的路径会违反安全措施或路径布局要求，实现可能会产生错误</p>
<p>Example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/access/default_user.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;admin&#34;</span><span class="w">  </span><span class="c"># This is a literal value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/var/run/db-data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">fromParam</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;sourceData&#34;</span><span class="w"> </span><span class="c"># This will cause the value to be read from the parameter whose name is `sourceData`</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>如果同时指定了 <code>fromParam</code> 和 <code>value</code>，则必须优先使用 <code>fromParam</code>，即使参数值是空值。如果两者都未指定，运行时必须产生错误。</p>
<h5 id="port">Port<a hidden class="anchor" aria-hidden="true" href="#port">#</a></h5>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A descriptive name for the port. Must be unique per container.</td>
</tr>
<tr>
<td><code>containerPort</code></td>
<td><code>integer</code></td>
<td>Y</td>
<td></td>
<td>The port number. Must be unique per container.</td>
</tr>
<tr>
<td><code>protocol</code></td>
<td><code>string</code></td>
<td>N</td>
<td><code>TCP</code></td>
<td>Indicates the transport layer protocol used by the server listening on the port. Valid values are <code>TCP</code> and <code>UDP</code>.</td>
</tr>
</tbody>
</table>
<p><code>name</code> 字段必须是 ASCII 字符集（0061-007A）中的小写字母字符。</p>
<h5 id="healthprobe">HealthProbe<a hidden class="anchor" aria-hidden="true" href="#healthprobe">#</a></h5>
<p>HealthProbe 描述了如何执行探测操作以确定组件的健康状况。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exec</code></td>
<td><a href="#exec"><code>Exec</code></a></td>
<td>N</td>
<td></td>
<td>Instructions for assessing container health by executing a command. Either this attribute or the <code>httpGet</code> attribute or the <code>tcpSocket</code> attribute MUST be specified. This attribute is mutually exclusive with both the <code>httpGet</code> attribute and the <code>tcpSocket</code> attribute.</td>
</tr>
<tr>
<td><code>httpGet</code></td>
<td><a href="#httpget"><code>HTTPGet</code></a></td>
<td>N</td>
<td></td>
<td>Instructions for assessing container health by executing an HTTP GET request. Either this attribute or the <code>exec</code> attribute or the <code>tcpSocket</code> attribute MUST be specified. This attribute is mutually exclusive with both the <code>exec</code> attribute and the <code>tcpSocket</code> attribute.</td>
</tr>
<tr>
<td><code>tcpSocket</code></td>
<td><a href="#tcpsocket"><code>TCPSocket</code></a></td>
<td>N</td>
<td></td>
<td>Instructions for assessing container health by probing a TCP socket. Either this attribute or the <code>exec</code> attribute or the <code>httpGet</code> attribute MUST be specified. This attribute is mutually exclusive with both the <code>exec</code> attribute and the <code>httpGet</code> attribute.</td>
</tr>
<tr>
<td><code>initialDelaySeconds</code></td>
<td><code>integer</code></td>
<td>N</td>
<td><code>0</code></td>
<td>Number of seconds after the container is started before the first probe is initiated.</td>
</tr>
<tr>
<td><code>periodSeconds</code></td>
<td><code>integer</code></td>
<td>N</td>
<td><code>10</code></td>
<td>How often, in seconds, to execute the probe.</td>
</tr>
<tr>
<td><code>timeoutSeconds</code></td>
<td><code>integer</code></td>
<td>N</td>
<td><code>1</code></td>
<td>Number of seconds after which the probe times out.</td>
</tr>
<tr>
<td><code>successThreshold</code></td>
<td><code>integer</code></td>
<td>N</td>
<td><code>1</code></td>
<td>Minimum consecutive successes for the probe to be considered successful after having failed.</td>
</tr>
<tr>
<td><code>failureThreshold</code></td>
<td><code>integer</code></td>
<td>N</td>
<td><code>3</code></td>
<td>Number of consecutive failures required to determine the container is not alive (liveness probe) or not ready (readiness probe).</td>
</tr>
</tbody>
</table>
<h6 id="exec">Exec<a hidden class="anchor" aria-hidden="true" href="#exec">#</a></h6>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>command</code></td>
<td><code>[]string</code></td>
<td>Y</td>
<td></td>
<td>A command to be executed inside the container to assess its health. Each space delimited token of the command is a separate array element. Commands exiting <code>0</code> are considered to be successful probes, whilst all other exit codes are considered failures.</td>
</tr>
</tbody>
</table>
<h6 id="httpget">HTTPGet<a hidden class="anchor" aria-hidden="true" href="#httpget">#</a></h6>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The endpoint, relative to the <code>port</code>, to which the HTTP GET request should be directed.</td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>integer</code></td>
<td>Y</td>
<td></td>
<td>The TCP socket within the container to which the HTTP GET request should be directed.</td>
</tr>
<tr>
<td><code>httpHeaders</code></td>
<td><a href="#httpheader"><code>[]HTTPHeader</code></a></td>
<td>N</td>
<td></td>
<td>Optional HTTP headers.</td>
</tr>
</tbody>
</table>
<h6 id="httpheader">HTTPHeader<a hidden class="anchor" aria-hidden="true" href="#httpheader">#</a></h6>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>An HTTP header name. This must be unique per HTTP GET-based probe.</td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>An HTTP header value.</td>
</tr>
</tbody>
</table>
<p><code>name</code> 和 <code>value</code> 都必须遵守 HTTP/1.1 关于有效[标头值]的规范(<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2">https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2</a>)</p>
<h6 id="tcpsocket">TCPSocket<a hidden class="anchor" aria-hidden="true" href="#tcpsocket">#</a></h6>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>port</code></td>
<td><code>integer</code></td>
<td>Y</td>
<td></td>
<td>The TCP socket within the container that should be probed to assess container health.</td>
</tr>
</tbody>
</table>
<p>端口必须是大于 0 的整数。</p>
<h4 id="units-for-time-cpu-memory-and-disk">Units for Time, CPU, Memory, and Disk<a hidden class="anchor" aria-hidden="true" href="#units-for-time-cpu-memory-and-disk">#</a></h4>
<p>本规范的某些地方使用了某些度量单位。本节将介绍这些计量单位。</p>
<h5 id="timing-intervals">Timing (Intervals)<a hidden class="anchor" aria-hidden="true" href="#timing-intervals">#</a></h5>
<p>对于计时，默认的时间单位是秒，用整数表示。</p>
<h5 id="cpu-count">CPU count<a hidden class="anchor" aria-hidden="true" href="#cpu-count">#</a></h5>
<p>CPU 数量用浮点数表示，其中 &ldquo;1 &ldquo;表示一个 CPU，&ldquo;2 &ldquo;表示两个 CPU，&ldquo;0.5 &ldquo;表示半个 CPU。</p>
<p>该单位的确切含义因平台而异。 实施者应考虑逻辑 cpu 相当于一个 AWS vCPU 或一个 Azure vCore 或一个 GCP Core 或一个 IBM vCPU。允许使用分数值。如果运行时不支持小数单位，则必须向上舍入（上限函数）到下一个整数值。</p>
<h5 id="memory-and-disk">Memory and Disk<a hidden class="anchor" aria-hidden="true" href="#memory-and-disk">#</a></h5>
<p>内存和磁盘空间使用 bytes/kilo/mega/giga/tera/peta 的符号，只使用主要单位：</p>
<ul>
<li><code>1024</code> is 1024 bytes</li>
<li><code>88K</code> is 88 kilobytes</li>
<li><code>5M</code> is 5 megabytes</li>
<li><code>7G</code> is 7 gigabytes</li>
<li><code>100T</code> is 100 terabytes</li>
<li><code>9999P</code> is 9999 petabytes</li>
</ul>
<p>如果在单位字母后附加 <code>B</code>，则必须忽略。因此，<code>5M</code> 和 <code>5MB</code> 被视为相同。大小写并不重要。<code>15k</code> 和 <code>15K</code> 必须视为相同的值。</p>
<h4 id="containerized-workload-json-schema">Containerized Workload JSON schema<a hidden class="anchor" aria-hidden="true" href="#containerized-workload-json-schema">#</a></h4>
<p>对于非 Kubernetes 运行时实现，可以使用 JSON schema 作为有效的容器化工作负载模式。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">&#34;$schema&#34;: </span><span class="s2">&#34;http://json-schema.org/draft-07/schema#&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">&#34;$id&#34;: </span><span class="s2">&#34;http://oam.dev/v1/oam.workload.schema.json&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">&#34;title&#34;: </span><span class="s2">&#34;Open Application Model Containerized Workload JSON Schema&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;apiVersion&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The specific version of the Open Application Model specification in use. This version of the specification covers apiVersions in core.oam.dev/v1alpha2.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;kind&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;must be ContainerizedWorkload.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;enum&#34;: </span><span class="p">[</span><span class="s2">&#34;ContainerizedWorkload&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;metadata&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;ContainerizedWorkload metadata.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;name&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;labels&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;A set of string key/value pairs used as arbitrary labels on this workload.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;additionalProperties&#34;: { &#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w"> </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;annotations&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;A set of string key/value pairs used as arbitrary annotations on this workload.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;additionalProperties&#34;: { &#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w"> </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;spec&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;A container for all remaining attributes.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;additionalProperties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;$ref&#34;: </span><span class="s2">&#34;#/definitions/containerSpec&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;apiVersion&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;kind&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;metadata&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;spec&#34;</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">&#34;definitions&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;containerSpec&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s2">&#34;osType&#34;</span><span class="p">:</span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;default&#34;: </span><span class="s2">&#34;linux&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The OS required to host (all of) the component&#39;s containers (since containers share a kernel with the underlying host).&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;enum&#34;: </span><span class="p">[</span><span class="s2">&#34;linux&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;windows&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;arch&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;default&#34;: </span><span class="s2">&#34;amd64&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The CPU architecture required to host (all of) the component&#39;s containers (since containers share physical hardware with the underlying host).&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;enum&#34;: </span><span class="p">[</span><span class="s2">&#34;i386&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;amd64&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;arm&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;arm64&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s2">&#34;containers&#34;</span><span class="p">:</span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;array&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The OCI container(s) that implement the component.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;items&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;$ref&#34;: </span><span class="s2">&#34;#/definitions/container&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;containers&#34;</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;container&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The runtime configuration necessary to run a containerized workload for this component.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;name&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The container&#39;s name. Must be unique per component.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;image&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;A path-like or URI-like representation of the location of an OCI image. Where applicable, this MAY be prefixed with a registry address, SHOULD be suffixed with a tag, and MUST be suffixed with a digest in OCI format. The digest may be used to compute the integrity of the image.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;resources&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Resources required by the container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;cpu&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies the attributes of the cpu resource required for the container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;required&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;number&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The minimum number of logical cpus required for running this container.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;memory&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies the attributes of the memory resource required for the container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;required&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The minimum amount of memory in MB required for running this container. The value should be a positive integer, greater than zero.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;gpu&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies the attributes of the gpu resources required for the container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;required&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;number&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The minimum number of gpus required for running this container.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;volumes&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies the attributes of the volumes that the container uses.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;array&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;items&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;name&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies the name used to reference the path.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;mountPath&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies the actual mount path in the filesystem.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;accessMode&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies the access mode.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;default&#34;: </span><span class="s2">&#34;RW&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;enum&#34;: </span><span class="p">[</span><span class="s2">&#34;RW&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;RO&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;sharingPolicy&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The sharing policy for the mount, indicating if it is expected to be shared or not.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;default&#34;: </span><span class="s2">&#34;Exclusive&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;enum&#34;: </span><span class="p">[</span><span class="s2">&#34;Exclusive&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;Shared&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;disk&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies the actual mount path in the filesystem.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                            </span><span class="nt">&#34;required&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The minimum disk size required for running this container. The value should be a positive integer, greater than zero.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                            </span><span class="nt">&#34;ephemeral&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;boolean&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Specifies whether external disk needs to be mounted or not.&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                        </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;mountPath&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;cmd&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;items&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;args&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;items&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;env&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Environment variables&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;array&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;items&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;a name/value pair&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;name&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The environment variable name. Must be unique per container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;maxLength&#34;: </span><span class="m">256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;value&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The environment variable value. If this is not supplied, fromParam must be supplied&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;$comment&#34;: </span><span class="s2">&#34;POSIX may dictate a max length on this&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;maxLength&#34;: </span><span class="m">2048</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;fromParam&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The parameter whose value should be substituted into this variable as a value&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;config&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Configuration files&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;array&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;items&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;a path and the value to be written into a file at that location&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;name&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The file name as an absolute path. Must be unique per container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;$comment&#34;: </span><span class="s2">&#34;format of this value is operating system dependent.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;maxLength&#34;: </span><span class="m">256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;value&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The value to be written into the file. If this is not supplied, fromParam must be supplied&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;fromParam&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The parameter whose value should be written into this file as a value&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="s2">&#34;name&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;ports&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Ports exposed by the container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;array&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;items&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;name&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;A descriptive name for the port. Must be unique per container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;containerPort&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The port number. Must be unique per container.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;integer&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;protocol&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Indicates the transport layer protocol used by the server listening on the port.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;default&#34;: </span><span class="s2">&#34;TCP&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;enum&#34;: </span><span class="p">[</span><span class="s2">&#34;TCP&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;UDP&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;containerPort&#34;</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;livenessProbe&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Instructions for assessing whether the container is alive.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;additionalProperties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;$ref&#34;: </span><span class="s2">&#34;#/definitions/healthProbe&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;readinessProbe&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Instructions for assessing whether the container is in a suitable state to serve traffic.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;additionalProperties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;$ref&#34;: </span><span class="s2">&#34;#/definitions/healthProbe&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;image&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;resources&#34;</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;healthProbe&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Health Probe describes how a probing operation is to be executed as a way of determining the health of a component.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;exec&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Instructions for assessing container health by executing a command. Either this attribute or the httpGet attribute or the tcpSocket attribute MUST be specified. This attribute is mutually exclusive with both the httpGet attribute and the tcpSocket attribute.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;command&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;A command to be executed inside the container to assess its health. Each space delimited token of the command is a separate array element. Commands exiting 0 are considered to be successful probes, whilst all other exit codes are considered failures.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;items&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;httpGet&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Instructions for assessing container health by executing an HTTP GET request. Either this attribute or the exec attribute or the tcpSocket attribute MUST be specified. This attribute is mutually exclusive with both the exec attribute and the tcpSocket attribute.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="s2">&#34;path&#34;</span><span class="p">:</span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The endpoint, relative to the port, to which the HTTP GET request should be directed.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;port&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The TCP socket within the container to which the HTTP GET request should be directed.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;integer&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="s2">&#34;httpHeaders&#34;</span><span class="p">:</span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Optional HTTP headers.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;name&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;An HTTP header name. This must be unique per HTTP GET-based probe.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="nt">&#34;value&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;An HTTP header value.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;string&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;value&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;name&#34;</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;port&#34;</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;tcpSocket&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Instructions for assessing container health by probing a TCP socket. Either this attribute or the exec attribute or the httpGet attribute MUST be specified. This attribute is mutually exclusive with both the exec attribute and the httpGet attribute.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;object&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;properties&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">&#34;port&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;The TCP socket within the container that should be probed to assess container health.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;integer&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;required&#34;: </span><span class="p">[</span><span class="s2">&#34;port&#34;</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;additionalProperties&#34;: </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;initialDelaySeconds&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Number of seconds after the container is started before the first probe is initiated.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;integer&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;default&#34;: </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;periodSeconds&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;How often, in seconds, to execute the probe.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;integer&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;default&#34;: </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;timeoutSeconds&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Number of seconds after which the probe times out.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="s2">&#34;type&#34;</span><span class="p">:</span><span class="s2">&#34;integer&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;default&#34;: </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;successThreshold&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Minimum consecutive successes for the probe to be considered successful after having failed.&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;integer&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;default&#34;: </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">&#34;failureThreshold&#34;: </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;description&#34;: </span><span class="s2">&#34;Number of consecutive failures required to determine the container is not alive (liveness probe) or not ready (readiness probe).&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;type&#34;: </span><span class="s2">&#34;integer&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">&#34;default&#34;: </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>}<span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="the-relationship-of-component-and-workload-type">The Relationship of Component and Workload Type<a hidden class="anchor" aria-hidden="true" href="#the-relationship-of-component-and-workload-type">#</a></h3>
<p>简而言之，组件是工作负载类型的<strong>封装</strong>，预先定义了面向用户的示意图。组件需要明确声明其工作负载类型，以便 OAM 系统正常工作，即 OAM 特性系统将检查该工作负载类型信息，以验证特定特性是否可附加到该组件上。</p>
<p>下面的示例可能有助于更好地解释它们之间的关系：</p>
<ul>
<li>Web 服务组件封装了 Kubernetes 部署和服务。
<ul>
<li>在这种情况下，<code>apps/v1.Deployment</code> 就是该组件的工作负载类型。</li>
</ul>
</li>
<li>封装 Kubernetes 部署的 后端 Worker 组件。
<ul>
<li>在这种情况下，<code>apps/v1.Deployment</code> 仍是该组件的工作负载类型。</li>
</ul>
</li>
<li>将 Kubernetes 部署 + Ingress 作为模板的 Helm 图表也是一个组件。
<ul>
<li>该组件的工作负载类型是 <code>apps/v1.Deployment</code>。</li>
</ul>
</li>
</ul>
<center><figure>
    <img loading="lazy" src="./concepts.png" width="100%"/> 
</figure>
</center>
<p>从另一个角度看，组件定义 总是由某些组件提供商或软件构建商定义，而 工作负载定义 作为一种平台能力，总是由基础设施运营商维护。因此，OAM 平台的工作负载定义数量通常非常有限，而且变化不大，但总是有无数的组件定义由不同的提供商和用户维护。</p>
<h2 id="5-application-scopes">5. Application Scopes<a hidden class="anchor" aria-hidden="true" href="#5-application-scopes">#</a></h2>
<p>Application scopes 通过提供具有共同 group 行为的不同形式的应用边界，将组件组合成逻辑应用。</p>
<p>Application scopes 具有以下一般特征：</p>
<ul>
<li>在定义一组组件实例共有的行为或元数据时，应使用 Application scopes。</li>
<li>一个组件可以同时部署到多个不同类型的应用范围中。</li>
<li>Application scopes 类型可决定组件是否可同时部署到同一应用范围类型的多个实例中。</li>
<li>Application scopes 可用作组件组与基础设施（如网络）或外部功能（如身份提供商）所提供功能之间的连接机制。</li>
</ul>
<p>下图说明了如何将组件分组到重叠的应用范围中以创建不同的应用边界：</p>
<center><figure>
    <img loading="lazy" src="./scopes-diagram-1.png" width="100%"/> 
</figure>
</center>
<p>此示例显示了两个作用域类型，其中分布着四个组件。</p>
<p>组件 A、B 和 C 部署在同一个健康作用域中。健康作用域将收集其组成组件的总体健康信息，并在组件升级操作期间对这些信息进行评估。需要根据一组组件的总体健康状况进行评估和/或执行操作的特性或组件可进一步使用健康范围提供的查询信息。这是应用程序的一个基本分组结构，它为组件之间的依赖关系提供了一个宽松的定义。</p>
<p>组件 A 在自己的网络范围内与组件 B、C 和 D 隔离。这样，基础设施运营商就可以为不同的组件组提供不同的 SDN 设置，例如对后端组件的入站/出站规则进行更严格的限制。</p>
<h3 id="defining-an-application-scope">Defining an application scope<a hidden class="anchor" aria-hidden="true" href="#defining-an-application-scope">#</a></h3>
<p>应用范围由 ScopeDefinition 实体表示。</p>
<h4 id="top-level-attributes-2">Top-Level Attributes<a hidden class="anchor" aria-hidden="true" href="#top-level-attributes-2">#</a></h4>
<p>这些属性提供了有关应用范围的顶级信息。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A string that identifies the version of the schema the object should have. The core types uses <code>core.oam.dev/v1beta1</code> in this version of model.</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>Must end with <code>ScopeDefinition</code>.</td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><a href="#metadata"><code>Metadata</code></a></td>
<td>Y</td>
<td></td>
<td>Entity metadata.</td>
</tr>
<tr>
<td><code>spec</code></td>
<td><a href="#spec-3"><code>Spec</code></a></td>
<td>Y</td>
<td></td>
<td>A specification for scope attributes.</td>
</tr>
</tbody>
</table>
<h4 id="spec-3">Spec<a hidden class="anchor" aria-hidden="true" href="#spec-3">#</a></h4>
<p>该规范定义了作用域的构成部分。</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allowComponentOverlap</code></td>
<td><code>bool</code></td>
<td>N</td>
<td>true</td>
<td>Determines whether a component is allowed to be in multiple instances of this scope type simultaneously. When false, the runtime implementation MUST produce an error and stop deployment if an attempt is made to place a component into more than one instance of this scope type simultaneously.</td>
</tr>
<tr>
<td><code>definitionRef</code></td>
<td><a href="#definitionref"><code>DefinitionRef</code></a></td>
<td>Y</td>
<td></td>
<td>Identifier to scope capability in the platform.</td>
</tr>
</tbody>
</table>
<h5 id="definitionref-1">DefinitionRef<a hidden class="anchor" aria-hidden="true" href="#definitionref-1">#</a></h5>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>Name identifier of the scope capability. Mutually exclusive to <code>apiVersion</code> and <code>kind</code>.</td>
</tr>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>API version of the scope capability.</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>Kind of the scope capability.</td>
</tr>
</tbody>
</table>
<h3 id="examples">Examples<a hidden class="anchor" aria-hidden="true" href="#examples">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ScopeDefinition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">healthscopes.core.oam.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allowComponentOverlap</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">definitionRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">healthscopes.core.oam.dev</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="health-scope">Health Scope<a hidden class="anchor" aria-hidden="true" href="#health-scope">#</a></h3>
<p>健康范围将组件分组为一个总体健康组。组内各组件的总体健康状况为升级和回滚机制提供信息。</p>
<p>健康范围汇总了组件的健康状态。可以设置健康范围的参数，以确定必须有多少百分比的组件处于不健康状态，才能认为整个范围处于不健康状态。</p>
<p>健康作用域本身不会根据健康状态采取任何行动。它只是一个群组健康状况聚合器，可被应用程序的其他进程和部分查询和使用，例如：应用程序升级特质可监控健康范围的总体健康状况，并决定何时启动自动回滚。监控应用程序可以监控健康状况范围的总体健康状况以发出警报。</p>
<h4 id="properties">Properties<a hidden class="anchor" aria-hidden="true" href="#properties">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>probe-timeout</code></td>
<td><code>int32</code></td>
<td>Y</td>
<td></td>
<td>ProbeTimeout is the amount of time in seconds to wait when receiving a response before marked failure.</td>
</tr>
<tr>
<td><code>probe-interval</code></td>
<td><code>int32</code></td>
<td>Y</td>
<td></td>
<td>ProbeInterval is the amount of time in seconds between probing tries.</td>
</tr>
</tbody>
</table>
<h4 id="instance-example">Instance Example<a hidden class="anchor" aria-hidden="true" href="#instance-example">#</a></h4>
<p>例如，健康范围实例可以如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HealthScope</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-health-scope</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">probe-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">probe-interval</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="usage-example">Usage Example<a hidden class="anchor" aria-hidden="true" href="#usage-example">#</a></h4>
<p>应用程序可以如下引用上述作用域实例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-appconfig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">components</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">componentName</span><span class="p">:</span><span class="w"> </span><span class="l">example-component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">traits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">scopes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">healthscopes.core.oam.dev</span><span class="p">:</span><span class="w"> </span><span class="l">example-health-scope</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="network-scope">Network Scope<a hidden class="anchor" aria-hidden="true" href="#network-scope">#</a></h3>
<p>网络范围将组件归入网络子网边界，并定义一般运行时网络模型。网络定义、规则和策略由基础设施的网络或 SDN 描述。</p>
<p>网络范围将组件组合在一起，并将它们连接到网络或 SDN。网络本身必须由应用运营商定义和运营。</p>
<p>流量管理功能也可查询网络范围，以确定服务网格的可发现性边界或 API 网关的 API 边界。</p>
<p>如果未指定网络范围，平台必须将应用程序加入默认网络。在默认网络中，应用配置中的所有组件必须能够相互通信，健康探测器必须能够与定义了健康检查规则的任何组件联系。不过，加入的网络与平台有关。例如，基于集群的环境（如 Kubernetes）会声明集群范围内的网络。相反，真正的无服务器实现可能会将组件加入到仅包括组件和健康检查探针的网络中。</p>
<h4 id="properties-1">Properties<a hidden class="anchor" aria-hidden="true" href="#properties-1">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>networkId</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The id of the network, e.g. vpc-id, VNet name.</td>
</tr>
<tr>
<td><code>subnetIds</code></td>
<td><code>array</code></td>
<td>Y</td>
<td></td>
<td>A comma separated list of IDs of the subnets within the network. For example, &lsquo;vsw-123&rsquo; or &lsquo;vsw-123&rsquo;,&lsquo;vsw-456&rsquo;. There could be more than one subnet because there is a limit in the number of IPs in a subnet. If IPs are taken up, operators need to add another subnet into this network.</td>
</tr>
<tr>
<td><code>internetGatewayType</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>The type of the gateway, options are &lsquo;public&rsquo;, &rsquo;nat&rsquo;. Empty string means no gateway.</td>
</tr>
</tbody>
</table>
<h4 id="instance-example-1">Instance Example<a hidden class="anchor" aria-hidden="true" href="#instance-example-1">#</a></h4>
<p>例如，网络作用域实例可以如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">standard.oam.dev/v1alpha2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">NetworkScope</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-vpc-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allowComponentOverlap</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="c"># can be skipped</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">networkId</span><span class="p">:</span><span class="w"> </span><span class="l">cool-vpc-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">subnetIds</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">cool-subnetwork</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">cooler-subnetwork</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">coolest-subnetwork</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">internetGatewayType</span><span class="p">:</span><span class="w"> </span><span class="l">nat</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="usage-example-1">Usage Example<a hidden class="anchor" aria-hidden="true" href="#usage-example-1">#</a></h4>
<p>应用程序可以如下引用上述作用域实例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">example-appconfig</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">components</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">componentName</span><span class="p">:</span><span class="w"> </span><span class="l">example-component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">traits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">scopes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">networkscopes.standard.oam.dev</span><span class="p">:</span><span class="w"> </span><span class="l">example-vpc-network</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="6-traits">6. Traits<a hidden class="anchor" aria-hidden="true" href="#6-traits">#</a></h2>
<p>trait 是一种可自行决定的运行时叠加，可通过操作功能增强组件工作负载实例。它为应用程序操作员提供了一个机会，让他们可以对组件的配置做出特定的决定，而无需让组件提供者参与其中或破坏组件封装。</p>
<blockquote>
<p>例如，在 WordPress Helm 图表中注入一个 sidecar container 的 sidecar 特性。</p>
</blockquote>
<p>特性可以是适用于单个组件的分布式应用程序的任何配置，如流量路由规则（如负载平衡策略、网络入口路由、断路、速率限制）、自动扩展策略、升级策略等。</p>
<h3 id="rait-definition">rait Definition<a hidden class="anchor" aria-hidden="true" href="#rait-definition">#</a></h3>
<p>本节具有规范性，因为性状是系统中可检查（也可能是可共享）的部分。所有特征都必须可以用以下格式表示。</p>
<p>特质的定义与组件一样使用示意图。与工作负载定义一样，每个特质定义都有一个 definitionRef，它是对定义特质配置选项的模式的引用。</p>
<h4 id="top-level-attributes-3">Top-Level Attributes<a hidden class="anchor" aria-hidden="true" href="#top-level-attributes-3">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A string that identifies the version of the schema the object should have. The core types uses <code>core.oam.dev/v1beta1</code> in this version of documentation.</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>Must be <code>TraitDefinition</code></td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><a href="#metadata"><code>Metadata</code></a></td>
<td>Y</td>
<td></td>
<td>Information about the trait.</td>
</tr>
<tr>
<td><code>spec</code></td>
<td><a href="#spec-4"><code>Spec</code></a></td>
<td>Y</td>
<td></td>
<td>A specification for trait attributes.</td>
</tr>
</tbody>
</table>
<h4 id="spec-4">Spec<a hidden class="anchor" aria-hidden="true" href="#spec-4">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>appliesToWorkloads</code></td>
<td><code>[]string</code></td>
<td>*</td>
<td></td>
<td>The collection of <a href="#4-workload-types">workload type characteristics</a> to which this trait applies. If this field is empty or unspecified or specified as <code>&quot;*&quot;</code>, it means applies <em>any workload type</em>. A trait must apply to at least one workload type. This attribute must contain at least one value.</td>
</tr>
<tr>
<td><code>conflictsWith</code></td>
<td><code>[]string</code></td>
<td>N</td>
<td></td>
<td>A list of traits that would be conflict with this trait when applied to same workload type. For example, <code>autoscaling</code> may conflict with <code>cron-autoscaling</code>.</td>
</tr>
<tr>
<td><code>definitionRef</code></td>
<td><a href="#definitionref"><code>DefinitionRef</code></a></td>
<td>Y</td>
<td></td>
<td>Identifier of the trait capability.</td>
</tr>
</tbody>
</table>
<h5 id="definitionref-2">DefinitionRef<a hidden class="anchor" aria-hidden="true" href="#definitionref-2">#</a></h5>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>Name identifier of the trait. Mutually exclusive to <code>apiVersion</code> and <code>kind</code>.</td>
</tr>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>API version of the trait.</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>N</td>
<td></td>
<td>Kind of trait.</td>
</tr>
</tbody>
</table>
<p>建议使用 <a href="#group-version-and-kind">Group/Version/Kind</a> 来唯一标识特征能力。如果使用 <code>definitionRef.name</code>，则必须包含可用于唯一标识的信息。</p>
<p><a href="#7-application">Application</a> 部分将详细介绍用户如何将特质附加到组件。</p>
<h3 id="implementing-a-trait-system">Implementing a Trait System<a hidden class="anchor" aria-hidden="true" href="#implementing-a-trait-system">#</a></h3>
<blockquote>
<p>警告：本节仅面向 OAM 平台实施者（即 KubVela），如果您只对 OAM 概念感兴趣，请跳过本节。</p>
</blockquote>
<p>在本文档中，_traits system_ 被定义为运行时通过 traits 对组件实例应用和管理操作行为的方式。</p>
<p>模型的运行时实现必须提供将操作行为附加到组件实例的特征系统。</p>
<p>当一个组件上有一个以上的特征时，它必须是：</p>
<ul>
<li>按照规定的顺序应用特征</li>
<li>确定兼容性，如果特性组合无法满足要求则失败</li>
</ul>
<p>特征按顺序应用，如果某些特征集表示依赖关系（例如，必须在 SSL 之前设置入口），则可通过设置明确的顺序来解决。</p>
<p>一个组件实例只能有一个给定特质类型的配置。</p>
<p>在完成所有特性配置之前，部署不应被标记为已完成。例如，如果网络服务器组件是与自动分级器特质一起部署的，那么在 (a) 网络服务器本身运行（由健康检查确定）和 (b) 自动分级器特质运行（由底层平台确定）之前，网络服务器不应被视为 &ldquo;正在运行&rdquo;。</p>
<p>组件可指定多个特性；因此，运行时必须支持对组件应用零个或多个特性。如果底层运行时无法满足所请求的特性，运行时必须产生错误并停止部署。</p>
<p>没有明确要求组合特质的机制。例如，一个特质（<code>ssl</code>）不能指定它要求另一个特质（<code>ingress</code>）应用于一个对象。但是，如果一个特质在没有另一个特质的情况下无法履行合约，那么特质的_实现_就应该失败。系统可以支持一种机制，在这种机制中，一个特质（<code>sslIngress</code>）由两个不同的特质实现（<code>ssl</code>和<code>ingress</code>）不透明地支持。</p>
<p>在运行时可用的任何特征都必须在该运行时实现。例如，运行时中的 <code>autoscaling</code> 特性不可能没有实现。</p>
<h3 id="categories-of-traits">Categories of Traits<a hidden class="anchor" aria-hidden="true" href="#categories-of-traits">#</a></h3>
<p>特质系统旨在作为运行时操作能力的扩展点，同时也为组件提供通用的、在某些情况下是必要的操作功能。</p>
<p>特质的实施细节超出了本文档的范围。不过，为了允许运行时实施任意特质，同时保持一定程度的通用性，以实现不同运行时的应用程序可移植性，特质按以下方式进行分类：</p>
<ul>
<li>Core traits：这一类定义了一组类型名称为 <code>core.oam.dev</code> 组的特质定义。这些特性提供了某些工作负载类型和组件功能运行所必需的操作功能。运行时必须实现本模型中定义的这些特征。</li>
<li>Standard traits：该类别定义了一组类型名称为 <code>standard.oam.dev</code> 组的特征定义。这些特征提供了应用程序操作员常用的操作功能，并由大多数运行时实现。建议运行时使用本模型中定义的标准特性定义，以提供与标准特性定义中所列功能相当的操作功能。换句话说，如果运行时正在实现具有行为 <code>foo</code> 的特质，而行为 <code>foo</code> 的标准特质定义已经存在，那么运行时就应该使用标准 <code>foo</code> 特质定义。应用程序操作员如果希望最大限度地提高应用程序的可移植性，就应该使用这些 trait 定义。虽然这并不能保证应用程序的可移植性，但其目的是提高运行时之间的可移植性。</li>
<li>Extension traits：除核心特质和标准特质定义的特质外，该类别还允许运行时定义自己独有的特质定义集。运行时可选择以任意定义实现该类别中的任意一组特质。扩展特质类型名称不得位于 <code>core.oam.dev</code> 或 <code>standard.oam.dev</code> 组中。</li>
</ul>
<h3 id="trait-characteristics">Trait Characteristics<a hidden class="anchor" aria-hidden="true" href="#trait-characteristics">#</a></h3>
<p>单个特征可与特定工作负载绑定（也可适用于所有工作负载）。特性可以声明适用于哪种工作负载。</p>
<p>本模型并不对特质的简单或复杂程度设定要求。有些特性可能会提供大量可配置选项，而有些特性则可能不提供任何可配置选项。也不要求特质与其底层技术一样详尽。例如，自动缩放技术的实现可能会提供多种方法来确定组件何时应该缩放。但该特性可能只涉及其中的几种。同样，也可以定义多个自动缩放特性（每个特性都有唯一的名称），每个特性显示不同的可配置选项子集。或者，一个大的特质可以显示所有可能的自动缩放配置。</p>
<p>OAM 平台的实现应能以下面解释的格式发现所有支持的特征。</p>
<h2 id="7-application">7. Application<a hidden class="anchor" aria-hidden="true" href="#7-application">#</a></h2>
<p>应用程序实体定义了应用程序部署后将被实例化的组件列表。</p>
<p>用户将指定每个组件的最终参数以及用于增强其功能或改变其行为的特性。此外，还可以指定一组范围，将不同的组件子集分组。</p>
<h3 id="top-level-attributes-4">Top-Level Attributes<a hidden class="anchor" aria-hidden="true" href="#top-level-attributes-4">#</a></h3>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>A string that identifies the version of the schema the object should have. The core types uses <code>core.oam.dev/v1beta1</code> in this version of documentation.</td>
</tr>
<tr>
<td><code>kind</code></td>
<td><code>string</code></td>
<td>Y</td>
<td></td>
<td>Must be <code>Application</code></td>
</tr>
<tr>
<td><code>metadata</code></td>
<td><a href="#metadata"><code>Metadata</code></a></td>
<td>Y</td>
<td></td>
<td>Information about the application.</td>
</tr>
<tr>
<td><code>spec</code></td>
<td><a href="#spec-5"><code>Spec</code></a></td>
<td>Y</td>
<td></td>
<td>A specification for application attributes.</td>
</tr>
</tbody>
</table>
<h3 id="spec-5">Spec<a hidden class="anchor" aria-hidden="true" href="#spec-5">#</a></h3>
<p>The specification of applications defines components to create, traits attached to each components, and a set of scopes the components drop in.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>components</code></td>
<td><a href="#component"><code>[]Component</code></a></td>
<td>Y</td>
<td></td>
<td>Component specification.</td>
</tr>
</tbody>
</table>
<h4 id="component">Component<a hidden class="anchor" aria-hidden="true" href="#component">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>Y</td>
<td></td>
<td>The name of the component instance.</td>
</tr>
<tr>
<td><code>type</code></td>
<td>string</td>
<td>Y</td>
<td></td>
<td>A reference to the <a href="3.component_model.md">component definition</a> that will be instantiated by the application. Optionally a namespaced component may be referenced as <code>&lt;namespace&gt;/&lt;component_name&gt;</code>. The meaning of <em>namespace</em> is implementation specific depending on the runtime being used and the target platform where entities are created. In the case of the Kubernetes, the concept of <code>namespace</code> matches the existing one in Kubernetes.</td>
</tr>
<tr>
<td><code>properties</code></td>
<td><a href="#properties"><code>Properties</code></a></td>
<td>Y</td>
<td></td>
<td>A set of values assigned to the parameters exposed from the <a href="3.component_model.md#schematic">component schematic</a>.</td>
</tr>
<tr>
<td><code>traits</code></td>
<td><a href="#trait"><code>[]Trait</code></a></td>
<td>N</td>
<td></td>
<td>The traits to attach to this component instance.</td>
</tr>
<tr>
<td><code>scopes</code></td>
<td><code>map[string]string</code></td>
<td>N</td>
<td></td>
<td>A map with the scopes the component belongs to. The map uses the qualified scope definition name as key (e.g., &ldquo;scope.company.com&rdquo;), and the name of the scope as value (e.g., &ldquo;myscope&rdquo;). Notice that this reference implies that an entity of the target scope with the specific name exists.</td>
</tr>
</tbody>
</table>
<p><code>name</code> 必须遵循这些命名规则：</p>
<blockquote>
<p>name 字段为必填字段，必须为 63 个字符或更少，以字母数字字符（[a-z0-9A-Z]）开头和结尾，中间包含破折号 (-)、下划线 (_)、点 (.)和字母数字。</p>
</blockquote>
<h4 id="trait">Trait<a hidden class="anchor" aria-hidden="true" href="#trait">#</a></h4>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td>string</td>
<td>N</td>
<td></td>
<td>A reference to the name of trait definition. For one type of trait, there could be only one configuration in one component.</td>
</tr>
<tr>
<td><code>properties</code></td>
<td><a href="#properties"><code>Properties</code></a></td>
<td>Y</td>
<td></td>
<td>The properties values to use this trait.</td>
</tr>
</tbody>
</table>
<p>注意 _Traits_ 不需要名称，因为 OAM 运行时负责实例化 traits。组件的名称预计将用于相关特质。</p>
<h5 id="properties-2">Properties<a hidden class="anchor" aria-hidden="true" href="#properties-2">#</a></h5>
<p>属性指定了与实体属性相关联的值。</p>
<p>当与 _Components_ 关联时，所设置的值将覆盖组件的参数，这些参数遵循 <a href="#3-component-model">component schematic</a> 中定义的示意图。</p>
<p>当属性用于 _Traits_ 或 _Scopes_ 时，它们会设置这些实体实例化所需的值。其结构由 <a href="#6-traits">definition reference</a> 决定。它可能是一个简单的值，也可能是一个复杂的对象。属性根据适合于特质或范围的模式进行验证。</p>
<h3 id="example-1">Example<a hidden class="anchor" aria-hidden="true" href="#example-1">#</a></h3>
<p>下面是一个完整的 YAML 文件示例，其中表达了组件、特性和作用域。该示例展示了组件的四个可配置元素：type, properties, traits, and scopes。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">core.oam.dev/v1beta1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-example-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1.0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Brief description of the application&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">components</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">publicweb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">web-ui</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">properties</span><span class="p">:</span><span class="w"> </span><span class="c"># properties targeting component parameters.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">example/web-ui:v1.0.2@sha256:verytrustworthyhash</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">param_1</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;enabled&#34;</span><span class="w"> </span><span class="c"># param_1 is defined on the web-ui component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">traits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ingress</span><span class="w"> </span><span class="c"># ingress trait providing a public endpoint for the publicweb component of the application.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">properties</span><span class="p">:</span><span class="w"> </span><span class="c"># properties are defined by the trait CRD spec. This example assumes path and port.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">scopes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;healthscopes.core.oam.dev&#34;: </span><span class="s2">&#34;app-health&#34;</span><span class="w"> </span><span class="c"># An application level health scope including both components.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">company/test-backend</span><span class="w"> </span><span class="c"># test-backend is referenced from other namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w"> </span><span class="c"># debug is a parameter defined in the test-backend component.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">traits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">scaler</span><span class="w"> </span><span class="c"># scaler trait to specify the number of replicas for the backend component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">scopes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">&#34;healthscopes.core.oam.dev&#34;: </span><span class="s2">&#34;app-health&#34;</span><span class="w"> </span><span class="c"># An application level health scope including both components.</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上例展示了一个完整的应用程序，包括其作用域、组件及其特性。该应用程序假定存在两个 <a href="#3-component-model">component definitions</a>，分别代表网络用户界面和假想应用程序的后台。两个 <a href="#6-traits">traits</a> 用于增强组件的功能。首先是后台的<em>scaler</em>，用于设置复制因子；其次是<em>ingress</em>，用于将应用程序对外开放。此外，还使用 HealthScope 来检查网络和后端组件的状态。这是本例中任意设置的一组组件，并不一定需要所有组件。</p>
<p>在实例化应用程序时，运行时将根据目标系统（如 Kubernetes）生成所需的实体，并执行与每个实体（如 traits）相关的模式。由于 _Traits_ 可以作为扩展添加到现有环境中，因此运行时必须能够创建任何通过 <a href="#6-traits">TraitDefinition</a> 在系统中注册的 Trait 实体。</p>
<h3 id="component-instances">Component Instances<a hidden class="anchor" aria-hidden="true" href="#component-instances">#</a></h3>
<p>_component instance_ 是在应用程序部署过程中创建的。它是在组件与配置一起部署时创建的。</p>
<ul>
<li>每次部署组件时，它都必须与应用程序一起部署。本规范的这一部分描述的是配置。</li>
<li>组件的每次后续 _upgrade_ 都会修改给定的实例，如果组件附加了任何修订感知特征，则会生成新的实例修订版。</li>
<li>当实例首次创建时，它处于 _initial revision state_。每次升级操作发生时，我们都会说该实例发生了新的_修订_。但是，我们并不假定在某个地方一定存储有相应的 <code>revision</code> 对象。</li>
</ul>
<h4 id="releases">Releases<a hidden class="anchor" aria-hidden="true" href="#releases">#</a></h4>
<p>在 <a href="https://12factor.net/"><em>Twelve-Factor Applications</em></a> 中，一个版本被定义为一个 <a href="https://12factor.net/build-release-run">build plus a set of configs</a>。也就是说，对构建或配置的任何更改都会产生一个新版本。在开放式应用程序模型中，类似的情况是 component、trait和scope objects与应用程序结合在一起共同构成一个版本。</p>
<p>对于 OAM 应用程序，一个版本是这样定义的：</p>
<blockquote>
<p>版本是一个已命名的应用程序及其相关组件、作用域和特性的描述。</p>
</blockquote>
<p>此外，随着应用程序的发布，其组件实例也会被发布。</p>
<p>为适应发布的这一定义，OAM 平台应做出以下假设：</p>
<ul>
<li>应用程序是可变的。</li>
<li>对 <a href="#7-application">application</a> 的任何更改（概念上）都会导致新版本的发布，并取代旧版本。</li>
<li>如果更新了应用程序，而新版本包含了原应用程序中没有的组件，则必须创建组件实例。</li>
<li>特质同样应该根据相同的准则进行附加和分离</li>
<li>组件与应用范围的关系应根据相同的准则应用或删除</li>
</ul>
<h2 id="8-practical-considerations">8. Practical Considerations<a hidden class="anchor" aria-hidden="true" href="#8-practical-considerations">#</a></h2>
<h3 id="proposal-stages-and-the-maturity-of-the-specification">Proposal Stages and the Maturity of the Specification<a hidden class="anchor" aria-hidden="true" href="#proposal-stages-and-the-maturity-of-the-specification">#</a></h3>
<p>该模型目前处于 &ldquo;草稿 &ldquo;阶段，正在向 &ldquo;工作稿 &ldquo;迈进。工作草案之后，该规范将成为最终规范（如 1.0）。</p>
<ul>
<li>在草稿阶段，模型的任何部分都不被认为是稳定的</li>
<li>在工作草案期间，可能会添加功能和修复问题。可能会出现破坏性修改，但这是不正常的情况</li>
<li>在最终规范期间，模型只会更新勘误、语法修正和明确标注的 &ldquo;说明性文字&rdquo;。</li>
</ul>
<p>一旦发布了最终规范（如 1.0），新版本的规范（如 1.1）可能会在粗稿阶段开始。</p>
<h3 id="media-types">Media Types<a hidden class="anchor" aria-hidden="true" href="#media-types">#</a></h3>
<p>示意图的媒体类型将在模型进入工作草案状态时确定。媒体类型初步将采用以下形式：</p>
<ul>
<li>application/oam.TYPE.v1+json，其中 TYPE 替换为类型名称（如组件）。</li>
</ul>
<h3 id="security">Security<a hidden class="anchor" aria-hidden="true" href="#security">#</a></h3>
<p>该模式目前的形式并没有规定一套具体的安全政策。不过，它确实为安全的某些方面提供了指导：</p>
<ul>
<li>OCI/Docker 图像必须尽可能用 SHA 引用</li>
<li>文件格式必须转换为规范格式，以便进行哈希运算</li>
<li>满足这两个条件后，就可以构建系统，其中原理图的摘要验证将保持系统所有组件的不变性。也就是说，如果示意图用哈希值引用了图像，那么验证示意图摘要的过程也能确保所提取的图像与生成示意图时使用的引用相同。</li>
</ul>
<p>其他安全细节，如网络传输安全或静态数据的安全，超出了本模型的考虑范围。</p>
<h2 id="9-design-principles">9. Design Principles<a hidden class="anchor" aria-hidden="true" href="#9-design-principles">#</a></h2>
<p>Open Application Model 遵循一系列设计原则，以确保模型的清晰度、丰富性和可扩展性。</p>
<h3 id="separation-of-concerns">Separation of Concerns<a hidden class="anchor" aria-hidden="true" href="#separation-of-concerns">#</a></h3>
<p>Separation of Concerns 是一种设计理念，在这种理念下，架构选择是根据所要解决的离散问题来进行的。像 component 和 application，或 schematics 和 configuration 这样的工件划分，都是按照功能或行为划分的。通过确定不同用户群体的角色和责任，将规格划分为与问题空间相匹配的概念。</p>
<h3 id="runtime-neutrality">Runtime Neutrality<a hidden class="anchor" aria-hidden="true" href="#runtime-neutrality">#</a></h3>
<p>Separation of Concerns 与运行时间无关。它不假定任何运行时特定的功能。相反，它旨在为应用程序所有者和操作员提供一个通用词汇表，以描述所需的拓扑结构和行为，而不受任何特定平台的影响。</p>
<h3 id="balance-elegance">Balance (Elegance)<a hidden class="anchor" aria-hidden="true" href="#balance-elegance">#</a></h3>
<p>在确保关注点分离的同时，OAM 力求避免对在较小团队中担任多种角色的用户造成不必要的复杂性。简单的方案应只需投入最少的时间和精力即可实现，但复杂的方案应在不需要重新平台化的情况下加以解决。</p>
<p>OAM 提供了多个抽象层，这样就可以独立于开发人员的关注点来捕捉操作关注点。</p>
<h3 id="reusability">Reusability<a hidden class="anchor" aria-hidden="true" href="#reusability">#</a></h3>
<p>OAM 原理图中的组件可重复使用和共享。此外，这些组件独立于其所描述的代码，因此可以重复使用代码（容器），并防止出现 &ldquo;锁定 &ldquo;情况。</p>
<p>该模型作为一个整体，旨在提供应用程序的 &ldquo;分布式&rdquo;，使同一个应用程序可以在不同的平台上执行而无需改动。应用程序的这种可移植性旨在使以下情况不仅成为可能，而且变得容易：</p>
<ul>
<li>将应用程序从开发人员工作站转移到生产集群或服务中</li>
<li>从一个实施方案迁移到另一个实施方案，无需更改代码</li>
<li>创建类似市场的环境，将应用程序部署到客户平台上</li>
</ul>
<h3 id="application-models-are-not-programming-models">Application Models Are Not Programming Models<a hidden class="anchor" aria-hidden="true" href="#application-models-are-not-programming-models">#</a></h3>
<p>应用程序模型和编程模型之间有明显的区别。应用程序模型描述应用程序的组成及其组件的拓扑结构。它不涉及如何实现每个组件（语言、设计模式等）。</p>
<p>另一方面，编程模型描述的是单个软件是如何组成的。开发人员使用它来实现应用程序组件。开放式应用程序模型提供了一种不需要编程模型的应用程序模型。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://WFUing.github.io/tags/oam/">oam</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://WFUing.github.io/posts/tech/language/dsl/iot-dsl/">
    <span class="title">下一页 »</span>
    <br>
    <span>iot 相关 dsl</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Open Application Model on twitter"
        href="https://twitter.com/intent/tweet/?text=Open%20Application%20Model&amp;url=https%3a%2f%2fWFUing.github.io%2fposts%2ftech%2farchitecture%2fiac%2foam%2f&amp;hashtags=oam">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Open Application Model on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fWFUing.github.io%2fposts%2ftech%2farchitecture%2fiac%2foam%2f&amp;title=Open%20Application%20Model&amp;summary=Open%20Application%20Model&amp;source=https%3a%2f%2fWFUing.github.io%2fposts%2ftech%2farchitecture%2fiac%2foam%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Open Application Model on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fWFUing.github.io%2fposts%2ftech%2farchitecture%2fiac%2foam%2f&title=Open%20Application%20Model">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Open Application Model on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fWFUing.github.io%2fposts%2ftech%2farchitecture%2fiac%2foam%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Open Application Model on whatsapp"
        href="https://api.whatsapp.com/send?text=Open%20Application%20Model%20-%20https%3a%2f%2fWFUing.github.io%2fposts%2ftech%2farchitecture%2fiac%2foam%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Open Application Model on telegram"
        href="https://telegram.me/share/url?text=Open%20Application%20Model&amp;url=https%3a%2f%2fWFUing.github.io%2fposts%2ftech%2farchitecture%2fiac%2foam%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Open Application Model on ycombinator"
        href="https://news.ycombinator.com/submitlink?t=Open%20Application%20Model&u=https%3a%2f%2fWFUing.github.io%2fposts%2ftech%2farchitecture%2fiac%2foam%2f">
        <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
            <path
                d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
        </svg>
    </a>
</div>

  </footer>
<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">💬评论</span>
        <hr />
    </div>
    <div id="tcomment"></div>
    <script src="https://cdn.staticfile.org/twikoo/1.4.11/twikoo.all.min.js"></script>
    <script>
        twikoo.init({
            envId: "https://twikoo-api-three-gamma.vercel.app/",  
            el: "#tcomment",
            lang: 'zh-CN',
            region: 'ap-guangzhou',  
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        });
    </script>
</div>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://WFUing.github.io/">Waiting For You</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
