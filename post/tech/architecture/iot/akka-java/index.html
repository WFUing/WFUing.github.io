<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>快速入门 Akka Java 指南 | Waiting For You</title>
<meta name="keywords" content="akka">
<meta name="description" content="Akka 是一个用于在 JVM 上构建高并发、分布式和可容错的事件驱动应用程序的运行时工具包。Akka 既可以用于 Java，也可以用于 Scala。本指南通过描述 Java 版本的Hello World示例来介绍 Akka。">
<meta name="author" content="WFUing">
<link rel="canonical" href="https://WFUing.github.io/post/tech/architecture/iot/akka-java/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.078343916625d121842bb25d5797d26510dec739246c5291e7aa1c8bdfed3a34.css" integrity="sha256-B4NDkWYl0SGEK7JdV5fSZRDexzkkbFKR56oci9/tOjQ=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://WFUing.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://WFUing.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://WFUing.github.io/img/logo.gif">
<link rel="apple-touch-icon" href="https://WFUing.github.io/logo.gif">
<link rel="mask-icon" href="https://WFUing.github.io/logo.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
    processEscapes: true,
    processEnvironments: true,
    autoload: {
      color: [],
      colorv2: ['color']
    },
    packages: {'[+]': ['noerrors']}
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/noerrors']
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>
<meta property="og:title" content="快速入门 Akka Java 指南" />
<meta property="og:description" content="Akka 是一个用于在 JVM 上构建高并发、分布式和可容错的事件驱动应用程序的运行时工具包。Akka 既可以用于 Java，也可以用于 Scala。本指南通过描述 Java 版本的Hello World示例来介绍 Akka。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://WFUing.github.io/post/tech/architecture/iot/akka-java/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-10-30T09:16:13+08:00" />
<meta property="article:modified_time" content="2023-10-30T09:16:13+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="快速入门 Akka Java 指南"/>
<meta name="twitter:description" content="Akka 是一个用于在 JVM 上构建高并发、分布式和可容错的事件驱动应用程序的运行时工具包。Akka 既可以用于 Java，也可以用于 Scala。本指南通过描述 Java 版本的Hello World示例来介绍 Akka。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://WFUing.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Technology",
      "item": "https://WFUing.github.io/post/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Architecture",
      "item": "https://WFUing.github.io/post/tech/architecture/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Internet of Things",
      "item": "https://WFUing.github.io/post/tech/architecture/iot/"
    }, 
    {
      "@type": "ListItem",
      "position":  5 ,
      "name": "快速入门 Akka Java 指南",
      "item": "https://WFUing.github.io/post/tech/architecture/iot/akka-java/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "快速入门 Akka Java 指南",
  "name": "快速入门 Akka Java 指南",
  "description": "Akka 是一个用于在 JVM 上构建高并发、分布式和可容错的事件驱动应用程序的运行时工具包。Akka 既可以用于 Java，也可以用于 Scala。本指南通过描述 Java 版本的Hello World示例来介绍 Akka。",
  "keywords": [
    "akka"
  ],
  "articleBody": "Akka 是一个用于在 JVM 上构建高并发、分布式和可容错的事件驱动应用程序的运行时工具包。Akka 既可以用于 Java，也可以用于 Scala。本指南通过描述 Java 版本的Hello World示例来介绍 Akka。\nActors 是 Akka 的执行单元。Actor 模型是一种抽象，它让编写正确的并发、并行和分布式系统更加容易。Hello World示例说明了 Akka 的基础知识。在 30 分钟内，你应该能够下载并运行示例，并使用本指南了解示例是如何构造的。这会让你初步了解 Akka 的魅力，希望这能够让你拥有深入了解 Akka 的兴趣！\n在体验过这个示例之后，想深入了解 Akka，阅读「Getting Started Guide」是一个很好的选择。\n下载示例 Java 版本的Hello World示例是一个包含 Maven 和 Gradle 构建文件的压缩项目。你可以在 Linux、MacOS 或 Windows 上运行它。唯一的先决条件是安装 Java 8 和 Maven 或 Gradle。\n下载和解压示例：\n在「Lightbend Tech Hub」上通过点击CREATE A PROJECT FOR ME下载压缩文件。 将 ZIP 文件解压缩到方便的位置： 在 Linux 和 OSX 系统上，打开终端并使用命令unzip akka-quickstart-java.zip。 在 Windows 上，使用文件资源管理器等工具提取项目。 运行示例 确保你已经安装了构建工具，然后打开终端窗口，并从项目目录中键入以下命令以运行Hello World：\n1 2 3 4 5 // Maven $ mvn compile exec:exec // Grade $ gradle run 输出应该如下所示（一直向右滚动以查看 Actor 输出）：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 // Maven Scanning for projects... [INFO] [INFO] ------------------------\u003c hello-akka-java:app \u003e------------------------- [INFO] Building app 1.0 [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ app --- [WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent! [INFO] [INFO] --- exec-maven-plugin:1.6.0:exec (default-cli) @ app --- [2019-10-12 09:20:30,248] [INFO] [akka.event.slf4j.Slf4jLogger] [helloakka-akka.actor.default-dispatcher-3] [] - Slf4jLogger started SLF4J: A number (1) of logging calls during the initialization phase have been intercepted and are SLF4J: now being replayed. These are subject to the filtering rules of the underlying logging system. SLF4J: See also http://www.slf4j.org/codes.html#replay \u003e\u003e\u003e Press ENTER to exit \u003c\u003c\u003c [2019-10-12 09:20:30,288] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6] [akka://helloakka/user/greeter] - Hello Charles! [2019-10-12 09:20:30,290] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3] [akka://helloakka/user/Charles] - Greeting 1 for Charles [2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6] [akka://helloakka/user/greeter] - Hello Charles! [2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3] [akka://helloakka/user/Charles] - Greeting 2 for Charles [2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6] [akka://helloakka/user/greeter] - Hello Charles! [2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3] [akka://helloakka/user/Charles] - Greeting 3 for Charles // Grade :run [2019-10-12 09:47:16,399] [INFO] [akka.event.slf4j.Slf4jLogger] [helloakka-akka.actor.default-dispatcher-3] [] - Slf4jLogger started SLF4J: A number (1) of logging calls during the initialization phase have been intercepted and are SLF4J: now being replayed. These are subject to the filtering rules of the underlying logging system. SLF4J: See also http://www.slf4j.org/codes.html#replay \u003e\u003e\u003e Press ENTER to exit \u003c\u003c\u003c [2019-10-12 09:47:16,437] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6] [akka://helloakka/user/greeter] - Hello Charles! [2019-10-12 09:47:16,439] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3] [akka://helloakka/user/Charles] - Greeting 1 for Charles [2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6] [akka://helloakka/user/greeter] - Hello Charles! [2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3] [akka://helloakka/user/Charles] - Greeting 2 for Charles [2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6] [akka://helloakka/user/greeter] - Hello Charles! [2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3] [akka://helloakka/user/Charles] - Greeting 3 for Charles \u003c=========----\u003e 75% EXECUTING [27s] \u003e :run 恭喜你，你刚刚运行了你的第一个 Akka 应用程序。\nHello World 都做了什么？ 示例包含了三个Actor：\nGreeter： 接收命令来Greet其他人，并使用Greeted来确认收到了消息。 GreeterBot：接收到从其他Greeter回复的问候，并发送多个额外的问候消息，并收集回复信息直到达到指定的数量。 GreeterMain：引导一切的守护Actor 使用 Actor 模型的好处 Akka 的以下特性使你能够以直观的方式解决困难的并发性和可伸缩性挑战：\n事件驱动模型：Event-driven model，Actor 通过响应消息来执行工作。Actor 之间的通信是异步的，允许 Actor 发送消息并继续自己的工作，而不是阻塞等待响应。 强隔离原则：Strong isolation principles，与 Java 中的常规对象不同，Actor 在调用的方法方面，没有一个公共 API。相反，它的公共 API 是通过 Actor 处理的消息来定义的。这可以防止 Actor 之间共享状态；观察另一个 Actor 状态的唯一方法是向其发送请求状态的消息。 位置透明：Location transparency，系统通过工厂方法构造 Actor 并返回对实例的引用。因为位置无关紧要，所以 Actor 实例可以启动、停止、移动和重新启动，以向上和向下扩展以及从意外故障中恢复。 轻量级：Lightweight，每个实例只消耗几百个字节，这实际上允许数百万并发 Actor 存在于一个应用程序中。 让我们看看在Hello World示例中使用 Actor 和消息一起工作的一些最佳实践。\n定义 Actor 和消息 每个Actor定义它可以接收的消息类型T。类(classes)和对象(objects)由于不可变并支持模式匹配，可以当做非常特别的消息类型。我们在Actor中会用到这些特性接收匹配的消息。\nHello World的 Actor 使用三种不同的消息：\nGreet：向Greeter执行问候的指令； Greeted：Greeter用来确认问候发生时回复的消息； SayHello：GreeterMain开始执行问候进程的指令； 在定义 Actor 及其消息时，请记住以下建议：\n因为消息是 Actor 的公共 API，所以定义具有良好名称、丰富语义和特定于域的含义的消息是一个很好的实践，即使它们只是包装你的数据类型，这将使基于 Actor 的系统更容易使用、理解和调试。 消息应该是不可变的，因为它们在不同的线程之间共享。 将 Actor 的关联消息作为静态类放在 Actor 的类中是一个很好的实践，这使得理解 Actor 期望和处理的消息类型更加容易。 通过静态工厂方法获得Actor的初始行为是一个很好的实践 让我们来看看Greeter，GreeterBot和GreeterMain的实现是如何证明上述的这些实践建议的。\n让我们看看 Actor 如何实现Greeter和Printer来演示这些最佳实践。\nGreeter Actor 下面的代码段来自于Greeter.java，其实现了Greeter Actor：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 public class Greeter extends AbstractBehavior\u003cGreeter.Greet\u003e { public static final class Greet { public final String whom; public final ActorRef\u003cGreeted\u003e replyTo; public Greet(String whom, ActorRef\u003cGreeted\u003e replyTo) { this.whom = whom; this.replyTo = replyTo; } } public static final class Greeted { public final String whom; public final ActorRef\u003cGreet\u003e from; public Greeted(String whom, ActorRef\u003cGreet\u003e from) { this.whom = whom; this.from = from; } } public static Behavior\u003cGreet\u003e create() { return Behaviors.setup(Greeter::new); } private Greeter(ActorContext\u003cGreet\u003e context) { super(context); } @Override public Receive\u003cGreet\u003e createReceive() { return newReceiveBuilder().onMessage(Greet.class, this::onGreet).build(); } private Behavior\u003cGreet\u003e onGreet(Greet command) { getContext().getLog().info(\"Hello {}!\", command.whom); command.replyTo.tell(new Greeted(command.whom, getContext().getSelf())); return this; } } 上面这个代码片段定义了两种消息类型，一种被Actor用来问候其他人，另外一种被Actor用来确认问候已经完成。Greet类型不仅包含了被问候人的信息，还持有了ActorRef，是由消息发送者提供的以便于GreeterActor可以发回确认信息。\nActor的行为被定义为Greeter继承自AbstractBehavior，带有newReceiveBuilder的工厂行为。处理下一条信息然后可能导致与处理当前这条信息的行为不同。只要当前实例是可变的就可以通过修改当前实例来更新状态。在当前这个例子中，我们不需要更新任何状态，所以我们直接返回this而不包含任何字段更新，这也意味着，处理下一条消息的行为与当前相同。\n被当前行为处理的消息类型被声明为类Greet。通常，一个actor处理超过一种具体的消息类型，这样会有一个所有消息类型可以实现的公共的接口。\n在最后一行我们能看到GreeterActor使用tell方法发送消息到另外一个Actor。这是一个不会阻塞调用者线程的异步操作。\n因为replyTo地址通过类型ActorRef进行声明，编译器仅允许我们发送这种类型的消息，使用其他消息类型会导致编译错误。\n这个Actor可以接收的消息类型和回复的消息类型定义了我们所说的协议。当前用例是一个简单的请求-回复协议，但Actor可以定义任意我们需要的复杂协议。协议与其行为被恰当的包装在了一个范围——Greeter类\nGreeter bot actor 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 package $package$; import akka.actor.typed.Behavior; import akka.actor.typed.javadsl.*; public class GreeterBot extends AbstractBehavior\u003cGreeter.Greeted\u003e { public static Behavior\u003cGreeter.Greeted\u003e create(int max) { return Behaviors.setup(context -\u003e new GreeterBot(context, max)); } private final int max; private int greetingCounter; private GreeterBot(ActorContext\u003cGreeter.Greeted\u003e context, int max) { super(context); this.max = max; } @Override public Receive\u003cGreeter.Greeted\u003e createReceive() { return newReceiveBuilder().onMessage(Greeter.Greeted.class, this::onGreeted).build(); } private Behavior\u003cGreeter.Greeted\u003e onGreeted(Greeter.Greeted message) { greetingCounter++; getContext().getLog().info(\"Greeting {} for {}\", greetingCounter, message.whom); if (greetingCounter == max) { return Behaviors.stopped(); } else { message.from.tell(new Greeter.Greet(message.whom, getContext().getSelf())); return this; } } } 注意这个Actor如何使用实例变量管理计数器。不需要诸如synchronized或AtomicInteger这样的并发保护，因为一个Actor实例一次只处理一条消息。\nGreeter main actor 第三个Actor产生了Greeter和GreeterBot，并启动他们的交互，创建Actor以及spawn做了什么将在下面讨论。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 package $package$; import akka.actor.typed.ActorRef; import akka.actor.typed.Behavior; import akka.actor.typed.javadsl.*; public class GreeterMain extends AbstractBehavior\u003cGreeterMain.SayHello\u003e { public static class SayHello { public final String name; public SayHello(String name) { this.name = name; } } private final ActorRef\u003cGreeter.Greet\u003e greeter; public static Behavior\u003cSayHello\u003e create() { return Behaviors.setup(GreeterMain::new); } private GreeterMain(ActorContext\u003cSayHello\u003e context) { super(context); //#create-actors greeter = context.spawn(Greeter.create(), \"greeter\"); //#create-actors } @Override public Receive\u003cSayHello\u003e createReceive() { return newReceiveBuilder().onMessage(SayHello.class, this::onSayHello).build(); } private Behavior\u003cSayHello\u003e onSayHello(SayHello command) { //#create-actors ActorRef\u003cGreeter.Greeted\u003e replyTo = getContext().spawn(GreeterBot.create(3), command.name); greeter.tell(new Greeter.Greet(command.name, replyTo)); //#create-actors return this; } } 创建 Actor 到目前为止，我们已经研究了 Actor 的定义和他们的消息。现在，让我们更深入地了解位置透明（location transparency）的好处，看看如何创建 Actor 实例。\n位置透明的好处 在 Akka 中，不能使用new关键字创建 Actor 的实例。相反，你应该使用工厂方法创建 Actor 实例。工厂不返回 Actor 实例，而是返回指向 Actor 实例的引用akka.actor.ActorRef。在分布式系统中，这种间接创建实例的方法增加了很多好处和灵活性。\n在 Akka 中位置无关紧要。位置透明性意味着，无论是在正在运行 Actor 的进程内，还是运行在远程计算机上，ActorRef都可以保持相同语义。如果需要，运行时可以通过更改 Actor 的位置或整个应用程序拓扑来优化系统。这就启用了故障管理的“让它崩溃（let it crash）”模型，在该模型中，系统可以通过销毁有问题的 Actor 和重新启动健康的 Actor 来自我修复。\nAkka ActorSystem ActorSystem是Akka的初始接入点。通常每个应用使用一个AcotrSystem来创建。ActorSystem有一个名称和一个守护Actor。应用的启动通常在守护Actor中完成。\n当前这个ActorSystem的守护Actor是GreeterMain。\n1 final ActorSystem\u003cGreeterMain.SayHello\u003e greeterMain = ActorSystem.create(GreeterMain.create(), \"helloakka\"); 它使用Behaviors.setup来启动应用\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 package $package$; import akka.actor.typed.ActorRef; import akka.actor.typed.Behavior; import akka.actor.typed.javadsl.*; public class GreeterMain extends AbstractBehavior\u003cGreeterMain.SayHello\u003e { public static class SayHello { public final String name; public SayHello(String name) { this.name = name; } } private final ActorRef\u003cGreeter.Greet\u003e greeter; public static Behavior\u003cSayHello\u003e create() { return Behaviors.setup(GreeterMain::new); } private GreeterMain(ActorContext\u003cSayHello\u003e context) { super(context); //#create-actors greeter = context.spawn(Greeter.create(), \"greeter\"); //#create-actors } @Override public Receive\u003cSayHello\u003e createReceive() { return newReceiveBuilder().onMessage(SayHello.class, this::onSayHello).build(); } private Behavior\u003cSayHello\u003e onSayHello(SayHello command) { //#create-actors ActorRef\u003cGreeter.Greeted\u003e replyTo = getContext().spawn(GreeterBot.create(3), command.name); greeter.tell(new Greeter.Greet(command.name, replyTo)); //#create-actors return this; } } 新建子actors 其他actor的创建在ActorContext上使用spawn方法。GreeterMain在启动时使用这种方式创建一个Greeter，并且每收到一个SayHello消息创建一个新的GreeterBot。\n1 2 3 4 greeter = context.spawn(Greeter.create(), \"greeter\"); ActorRef\u003cGreeter.Greeted\u003e replyTo = getContext().spawn(GreeterBot.create(3), command.name); greeter.tell(new Greeter.Greet(command.name, replyTo)); 异步通信 Actor 是被动的和消息驱动的。Actor 在收到消息前什么都不做。Actor 使用异步消息进行通信。这样可以确保发送者不会一直等待接收者处理他们的消息。相反，发件人将邮件放在收件人的邮箱之后，就可以自由地进行其他工作。Actor 的邮箱本质上是一个具有排序语义的消息队列。从同一个 Actor 发送的多条消息的顺序被保留，但可以与另一个 Actor 发送的消息交错。\n你可能想知道 Actor 在不处理消息的时候在做什么，比如，做什么实际的工作？实际上，它处于挂起状态，在这种状态下，它不消耗除内存之外的任何资源。同样，这也展示了 Actor 的轻量级和高效性。\n给 Actor 发生消息 要将消息放入 Actor 的邮箱，我们需要使用ActorRef的tell方法。例如，Hello World的主函数main向Greeter Actor 发送如下消息：\n1 greeterMain.tell(new GreeterMain.SayHello(\"Charles\")); Greeter Actor 也回复确认消息：\n1 command.replyTo.tell(new Greeted(command.whom, getContext().getSelf())); 我们已经研究了如何创建 Actor 和发送消息。现在，让我们来回顾一下Main类的全部内容。\nMain class Hello World中的AkkaQuickstart对象创建了带有守护者的ActorSystem，守护者是顶层的负责启动应用的actor。守护者通常使用包含初始启动的Behaviors.setup进行定义。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package $package$; import akka.actor.typed.ActorSystem; import java.io.IOException; public class AkkaQuickstart { public static void main(String[] args) { //#actor-system final ActorSystem\u003cGreeterMain.SayHello\u003e greeterMain = ActorSystem.create(GreeterMain.create(), \"helloakka\"); //#actor-system //#main-send-messages greeterMain.tell(new GreeterMain.SayHello(\"Charles\")); //#main-send-messages try { System.out.println(\"\u003e\u003e\u003e Press ENTER to exit \u003c\u003c\u003c\"); System.in.read(); } catch (IOException ignored) { } finally { greeterMain.terminate(); } } } 完整代码 下面是创建示例应用程序的三个类Greeter，GreeterBot，GreeterMain和AkkaQuickstart的完整源代码：\nGreater.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 package $package$; import akka.actor.typed.ActorRef; import akka.actor.typed.Behavior; import akka.actor.typed.javadsl.*; import java.util.Objects; // #greeter public class Greeter extends AbstractBehavior\u003cGreeter.Greet\u003e { public static final class Greet { public final String whom; public final ActorRef\u003cGreeted\u003e replyTo; public Greet(String whom, ActorRef\u003cGreeted\u003e replyTo) { this.whom = whom; this.replyTo = replyTo; } } public static final class Greeted { public final String whom; public final ActorRef\u003cGreet\u003e from; public Greeted(String whom, ActorRef\u003cGreet\u003e from) { this.whom = whom; this.from = from; } // #greeter @Override public boolean equals(Object o) { if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; Greeted greeted = (Greeted) o; return Objects.equals(whom, greeted.whom) \u0026\u0026 Objects.equals(from, greeted.from); } @Override public int hashCode() { return Objects.hash(whom, from); } @Override public String toString() { return \"Greeted{\" + \"whom='\" + whom + '\\'' + \", from=\" + from + '}'; } // #greeter } public static Behavior\u003cGreet\u003e create() { return Behaviors.setup(Greeter::new); } private Greeter(ActorContext\u003cGreet\u003e context) { super(context); } @Override public Receive\u003cGreet\u003e createReceive() { return newReceiveBuilder().onMessage(Greet.class, this::onGreet).build(); } private Behavior\u003cGreet\u003e onGreet(Greet command) { getContext().getLog().info(\"Hello {}!\", command.whom); //#greeter-send-message command.replyTo.tell(new Greeted(command.whom, getContext().getSelf())); //#greeter-send-message return this; } } // #greeter GreeterBot.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 package $package$; import akka.actor.typed.Behavior; import akka.actor.typed.javadsl.*; public class GreeterBot extends AbstractBehavior\u003cGreeter.Greeted\u003e { public static Behavior\u003cGreeter.Greeted\u003e create(int max) { return Behaviors.setup(context -\u003e new GreeterBot(context, max)); } private final int max; private int greetingCounter; private GreeterBot(ActorContext\u003cGreeter.Greeted\u003e context, int max) { super(context); this.max = max; } @Override public Receive\u003cGreeter.Greeted\u003e createReceive() { return newReceiveBuilder().onMessage(Greeter.Greeted.class, this::onGreeted).build(); } private Behavior\u003cGreeter.Greeted\u003e onGreeted(Greeter.Greeted message) { greetingCounter++; getContext().getLog().info(\"Greeting {} for {}\", greetingCounter, message.whom); if (greetingCounter == max) { return Behaviors.stopped(); } else { message.from.tell(new Greeter.Greet(message.whom, getContext().getSelf())); return this; } } } GreeterMain.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 package $package$; import akka.actor.typed.ActorRef; import akka.actor.typed.Behavior; import akka.actor.typed.javadsl.*; public class GreeterMain extends AbstractBehavior\u003cGreeterMain.SayHello\u003e { public static class SayHello { public final String name; public SayHello(String name) { this.name = name; } } private final ActorRef\u003cGreeter.Greet\u003e greeter; public static Behavior\u003cSayHello\u003e create() { return Behaviors.setup(GreeterMain::new); } private GreeterMain(ActorContext\u003cSayHello\u003e context) { super(context); //#create-actors greeter = context.spawn(Greeter.create(), \"greeter\"); //#create-actors } @Override public Receive\u003cSayHello\u003e createReceive() { return newReceiveBuilder().onMessage(SayHello.class, this::onSayHello).build(); } private Behavior\u003cSayHello\u003e onSayHello(SayHello command) { //#create-actors ActorRef\u003cGreeter.Greeted\u003e replyTo = getContext().spawn(GreeterBot.create(3), command.name); greeter.tell(new Greeter.Greet(command.name, replyTo)); //#create-actors return this; } } AkkaQuickstart.java 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package $package$; import akka.actor.typed.ActorSystem; import java.io.IOException; public class AkkaQuickstart { public static void main(String[] args) { //#actor-system final ActorSystem\u003cGreeterMain.SayHello\u003e greeterMain = ActorSystem.create(GreeterMain.create(), \"helloakka\"); //#actor-system //#main-send-messages greeterMain.tell(new GreeterMain.SayHello(\"Charles\")); //#main-send-messages try { System.out.println(\"\u003e\u003e\u003e Press ENTER to exit \u003c\u003c\u003c\"); System.in.read(); } catch (IOException ignored) { } finally { greeterMain.terminate(); } } } 作为另一个最佳实践，我们应该提供一些单元测试。\n测试 Actor Hello World示例中的测试展示了 JUnit 框架的使用。虽然测试的覆盖范围不完整，但它简单地展示了测试 Actor 代码是多么的容易，并提供了一些基本概念。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package $package$; import akka.actor.testkit.typed.javadsl.TestKitJunitResource; import akka.actor.testkit.typed.javadsl.TestProbe; import akka.actor.typed.ActorRef; import org.junit.ClassRule; import org.junit.Test; //#definition public class AkkaQuickstartTest { @ClassRule public static final TestKitJunitResource testKit = new TestKitJunitResource(); //#definition //#test @Test public void testGreeterActorSendingOfGreeting() { TestProbe\u003cGreeter.Greeted\u003e testProbe = testKit.createTestProbe(); ActorRef\u003cGreeter.Greet\u003e underTest = testKit.spawn(Greeter.create(), \"greeter\"); underTest.tell(new Greeter.Greet(\"Charles\", testProbe.getRef())); testProbe.expectMessage(new Greeter.Greeted(\"Charles\", underTest)); } //#test } 测试类定义 1 2 3 4 public class AkkaQuickstartTest { @ClassRule public static final TestKitJunitResource testKit = new TestKitJunitResource(); 使用TestKitJunitResource JUnit规则包含对JUnit的支持。自动创建并清理ActorTestKit。通过完整文档查看如何直接使用testkit\n测试方法 这个测试使用TestProbe 来检查并确认是否得到期望的行为，源码片段如下：\n1 2 3 4 5 6 7 @Test public void testGreeterActorSendingOfGreeting() { TestProbe\u003cGreeter.Greeted\u003e testProbe = testKit.createTestProbe(); ActorRef\u003cGreeter.Greet\u003e underTest = testKit.spawn(Greeter.create(), \"greeter\"); underTest.tell(new Greeter.Greet(\"Charles\", testProbe.getRef())); testProbe.expectMessage(new Greeter.Greeted(\"Charles\", underTest)); } 一旦我们有了TestProbe 的引用，我们将它传递给Greeter作为Greet消息的一部分。然后确认Greeter响应问候发生。\n完整测试程序 这里是完整的测试代码：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 package $package$; import akka.actor.testkit.typed.javadsl.TestKitJunitResource; import akka.actor.testkit.typed.javadsl.TestProbe; import akka.actor.typed.ActorRef; import org.junit.ClassRule; import org.junit.Test; //#definition public class AkkaQuickstartTest { @ClassRule public static final TestKitJunitResource testKit = new TestKitJunitResource(); //#definition //#test @Test public void testGreeterActorSendingOfGreeting() { TestProbe\u003cGreeter.Greeted\u003e testProbe = testKit.createTestProbe(); ActorRef\u003cGreeter.Greet\u003e underTest = testKit.spawn(Greeter.create(), \"greeter\"); underTest.tell(new Greeter.Greet(\"Charles\", testProbe.getRef())); testProbe.expectMessage(new Greeter.Greeted(\"Charles\", underTest)); } //#test } 示例代码只涉及了ActorTestKit功能的一小部分，在「这里」可以找到更完整的概述。\n运行应用程序 你可以通过命令行或者 IDE 来运行Hello World应用程序。在本指南的最后一个主题，我们描述了如何在 IntelliJ IDEA 中运行该示例。但是，在我们再次运行应用程序之前，让我们先快速的查看构建文件。\nMaven POM 文件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 4.0.0 hello-akka-java app 1.0 $akka_version$ com.typesafe.akka akka-actor-typed_2.13 \\${akka.version} ch.qos.logback logback-classic 1.2.3 com.typesafe.akka akka-actor-testkit-typed_2.13 \\${akka.version} test junit junit 4.13.1 test org.apache.maven.plugins maven-compiler-plugin 3.5.1 1.8 1.8 org.codehaus.mojo exec-maven-plugin 1.6.0 java -classpath ",
  "wordCount" : "2647",
  "inLanguage": "zh",
  "datePublished": "2023-10-30T09:16:13+08:00",
  "dateModified": "2023-10-30T09:16:13+08:00",
  "author":{
    "@type": "Person",
    "name": "WFUing"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://WFUing.github.io/post/tech/architecture/iot/akka-java/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Waiting For You",
    "logo": {
      "@type": "ImageObject",
      "url": "https://WFUing.github.io/img/logo.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<header class="header"><nav class="nav">
    <div class="logo">
        <a style="color: rgb(218, 218, 219);" href="https://WFUing.github.io/" accesskey="h" title="Waiting For You (Alt + H)">Waiting For You</a>
        <div class="logo-switches">
            <button id="theme-toggle" accesskey="t" title="(Alt + T)" style="color: rgb(218, 218, 219);">
                <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </button>
        </div>
    </div>
    <ul id="menu">
        <li>
            <a href="https://WFUing.github.io/search" title="SEARCH (Alt &#43; /)" accesskey=/>
                <span style="color: rgb(218, 218, 219);">SEARCH</span>
            </a>
        </li>
        <li>
            <a href="https://WFUing.github.io/" title="HOME">
                <span style="color: rgb(218, 218, 219);">HOME</span>
            </a>
        </li>
        <li>
            <a href="https://WFUing.github.io/post" title="BLOGS">
                <span style="color: rgb(218, 218, 219);">BLOGS</span>
            </a>
        </li>
        <li>
            <a href="https://WFUing.github.io/archives" title="ARCHIVE">
                <span style="color: rgb(218, 218, 219);">ARCHIVE</span>
            </a>
        </li>
        <li>
            <a href="https://WFUing.github.io/tags" title="TAGS">
                <span style="color: rgb(218, 218, 219);">TAGS</span>
            </a>
        </li>
    </ul>
</nav>
</header>


<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://WFUing.github.io/">主页</a>&nbsp;»&nbsp;<a href="https://WFUing.github.io/post/">Posts</a>&nbsp;»&nbsp;<a href="https://WFUing.github.io/post/tech/">Technology</a>&nbsp;»&nbsp;<a href="https://WFUing.github.io/post/tech/architecture/">Architecture</a>&nbsp;»&nbsp;<a href="https://WFUing.github.io/post/tech/architecture/iot/">Internet of Things</a></div>
    <h1 class="post-title">
      快速入门 Akka Java 指南
    </h1>
    <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-10-30
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>2647字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>13分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>WFUing
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://WFUing.github.io/tags/akka/" style="color: var(--secondary)!important;">akka</a>
            </span>
        </span>
    </span>
</span>
        &nbsp;|&nbsp;标签: &nbsp;
        <ul class="post-tags-meta">
            <a href="https://WFUing.github.io/tags/akka/">akka</a>
        </ul>

        
        
        
        
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_page_pv">
            &nbsp;| 访问: <span id="busuanzi_value_page_pv"></span>
        </span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e4%b8%8b%e8%bd%bd%e7%a4%ba%e4%be%8b" aria-label="下载示例">下载示例</a></li>
                    <li>
                        <a href="#%e8%bf%90%e8%a1%8c%e7%a4%ba%e4%be%8b" aria-label="运行示例">运行示例</a></li>
                    <li>
                        <a href="#hello-world-%e9%83%bd%e5%81%9a%e4%ba%86%e4%bb%80%e4%b9%88" aria-label="Hello World 都做了什么？">Hello World 都做了什么？</a></li>
                    <li>
                        <a href="#%e4%bd%bf%e7%94%a8-actor-%e6%a8%a1%e5%9e%8b%e7%9a%84%e5%a5%bd%e5%a4%84" aria-label="使用 Actor 模型的好处">使用 Actor 模型的好处</a></li>
                    <li>
                        <a href="#%e5%ae%9a%e4%b9%89-actor-%e5%92%8c%e6%b6%88%e6%81%af" aria-label="定义 Actor 和消息">定义 Actor 和消息</a><ul>
                            
                    <li>
                        <a href="#greeter-actor" aria-label="Greeter Actor">Greeter Actor</a></li>
                    <li>
                        <a href="#greeter-bot-actor" aria-label="Greeter bot actor">Greeter bot actor</a></li>
                    <li>
                        <a href="#greeter-main-actor" aria-label="Greeter main actor">Greeter main actor</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%88%9b%e5%bb%ba-actor" aria-label="创建 Actor">创建 Actor</a><ul>
                            
                    <li>
                        <a href="#%e4%bd%8d%e7%bd%ae%e9%80%8f%e6%98%8e%e7%9a%84%e5%a5%bd%e5%a4%84" aria-label="位置透明的好处">位置透明的好处</a></li>
                    <li>
                        <a href="#akka-actorsystem" aria-label="Akka ActorSystem">Akka ActorSystem</a></li>
                    <li>
                        <a href="#%e6%96%b0%e5%bb%ba%e5%ad%90actors" aria-label="新建子actors">新建子actors</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%bc%82%e6%ad%a5%e9%80%9a%e4%bf%a1" aria-label="异步通信">异步通信</a><ul>
                            
                    <li>
                        <a href="#%e7%bb%99-actor-%e5%8f%91%e7%94%9f%e6%b6%88%e6%81%af" aria-label="给 Actor 发生消息">给 Actor 发生消息</a></li></ul>
                    </li>
                    <li>
                        <a href="#main-class" aria-label="Main class">Main class</a></li>
                    <li>
                        <a href="#%e5%ae%8c%e6%95%b4%e4%bb%a3%e7%a0%81" aria-label="完整代码">完整代码</a><ul>
                            
                    <li>
                        <a href="#greaterjava" aria-label="Greater.java">Greater.java</a></li>
                    <li>
                        <a href="#greeterbotjava" aria-label="GreeterBot.java">GreeterBot.java</a></li>
                    <li>
                        <a href="#greetermainjava" aria-label="GreeterMain.java">GreeterMain.java</a></li>
                    <li>
                        <a href="#akkaquickstartjava" aria-label="AkkaQuickstart.java">AkkaQuickstart.java</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%b5%8b%e8%af%95-actor" aria-label="测试 Actor">测试 Actor</a><ul>
                            
                    <li>
                        <a href="#%e6%b5%8b%e8%af%95%e7%b1%bb%e5%ae%9a%e4%b9%89" aria-label="测试类定义">测试类定义</a></li>
                    <li>
                        <a href="#%e6%b5%8b%e8%af%95%e6%96%b9%e6%b3%95" aria-label="测试方法">测试方法</a></li>
                    <li>
                        <a href="#%e5%ae%8c%e6%95%b4%e6%b5%8b%e8%af%95%e7%a8%8b%e5%ba%8f" aria-label="完整测试程序">完整测试程序</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e8%bf%90%e8%a1%8c%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f" aria-label="运行应用程序">运行应用程序</a><ul>
                            
                    <li>
                        <a href="#%e8%bf%90%e8%a1%8c%e9%a1%b9%e7%9b%ae" aria-label="运行项目">运行项目</a></li>
                    <li>
                        <a href="#%e4%b8%8b%e4%b8%80%e6%ad%a5" aria-label="下一步">下一步</a></li></ul>
                    </li>
                    <li>
                        <a href="#intellij-idea" aria-label="IntelliJ IDEA">IntelliJ IDEA</a><ul>
                            
                    <li>
                        <a href="#%e8%ae%be%e7%bd%ae%e9%a1%b9%e7%9b%ae" aria-label="设置项目">设置项目</a></li>
                    <li>
                        <a href="#%e6%a3%80%e6%9f%a5%e9%a1%b9%e7%9b%ae%e4%bb%a3%e7%a0%81" aria-label="检查项目代码">检查项目代码</a></li>
                    <li>
                        <a href="#%e6%b5%8b%e8%af%95%e5%92%8c%e8%bf%90%e8%a1%8c" aria-label="测试和运行">测试和运行</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><p>Akka 是一个用于在 JVM 上构建高并发、分布式和可容错的事件驱动应用程序的运行时工具包。Akka 既可以用于 Java，也可以用于 Scala。本指南通过描述 Java 版本的<code>Hello World</code>示例来介绍 Akka。</p>
<p>Actors 是 Akka 的执行单元。Actor 模型是一种抽象，它让编写正确的并发、并行和分布式系统更加容易。<code>Hello World</code>示例说明了 Akka 的基础知识。在 30 分钟内，你应该能够下载并运行示例，并使用本指南了解示例是如何构造的。这会让你初步了解 Akka 的魅力，希望这能够让你拥有深入了解 Akka 的兴趣！</p>
<p>在体验过这个示例之后，想深入了解 Akka，阅读「<a href="https://doc.akka.io/docs/akka/2.5/guide/introduction.html?language=java">Getting Started Guide</a>」是一个很好的选择。</p>
<h2 id="下载示例">下载示例<a hidden class="anchor" aria-hidden="true" href="#下载示例">#</a></h2>
<p>Java 版本的<code>Hello World</code>示例是一个包含 Maven 和 Gradle 构建文件的压缩项目。你可以在 Linux、MacOS 或 Windows 上运行它。唯一的先决条件是安装 Java 8 和 Maven 或 Gradle。</p>
<p>下载和解压示例：</p>
<ul>
<li>在「<a href="https://developer.lightbend.com/start/?group=akka&amp;project=akka-quickstart-java">Lightbend Tech Hub</a>」上通过点击<code>CREATE A PROJECT FOR ME</code>下载压缩文件。</li>
<li>将 ZIP 文件解压缩到方便的位置：
<ul>
<li>在 Linux 和 OSX 系统上，打开终端并使用命令<code>unzip akka-quickstart-java.zip</code>。</li>
<li>在 Windows 上，使用文件资源管理器等工具提取项目。</li>
</ul>
</li>
</ul>
<h2 id="运行示例">运行示例<a hidden class="anchor" aria-hidden="true" href="#运行示例">#</a></h2>
<p>确保你已经安装了构建工具，然后打开终端窗口，并从项目目录中键入以下命令以运行<code>Hello World</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//  Maven
</span></span><span class="line"><span class="cl">$ mvn compile exec:exec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Grade
</span></span><span class="line"><span class="cl">$ gradle run
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出应该如下所示（一直向右滚动以查看 Actor 输出）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// Maven
</span></span><span class="line"><span class="cl">Scanning for projects...
</span></span><span class="line"><span class="cl">[INFO]
</span></span><span class="line"><span class="cl">[INFO] ------------------------&lt; hello-akka-java:app &gt;-------------------------
</span></span><span class="line"><span class="cl">[INFO] Building app 1.0
</span></span><span class="line"><span class="cl">[INFO] --------------------------------[ jar ]---------------------------------
</span></span><span class="line"><span class="cl">[INFO]
</span></span><span class="line"><span class="cl">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ app ---
</span></span><span class="line"><span class="cl">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
</span></span><span class="line"><span class="cl">[INFO]
</span></span><span class="line"><span class="cl">[INFO] --- exec-maven-plugin:1.6.0:exec (default-cli) @ app ---
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,248] [INFO] [akka.event.slf4j.Slf4jLogger] [helloakka-akka.actor.default-dispatcher-3] [] -
</span></span><span class="line"><span class="cl">Slf4jLogger started
</span></span><span class="line"><span class="cl">SLF4J: A number (1) of logging calls during the initialization phase have been intercepted and are
</span></span><span class="line"><span class="cl">SLF4J: now being replayed. These are subject to the filtering rules of the underlying logging system.
</span></span><span class="line"><span class="cl">SLF4J: See also http://www.slf4j.org/codes.html#replay
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Press ENTER to exit &lt;&lt;&lt;
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,288] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,290] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 1 for Charles
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 2 for Charles
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 3 for Charles
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Grade
</span></span><span class="line"><span class="cl">:run 
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,399] [INFO] [akka.event.slf4j.Slf4jLogger] [helloakka-akka.actor.default-dispatcher-3] [] -
</span></span><span class="line"><span class="cl">Slf4jLogger started
</span></span><span class="line"><span class="cl">SLF4J: A number (1) of logging calls during the initialization phase have been intercepted and are
</span></span><span class="line"><span class="cl">SLF4J: now being replayed. These are subject to the filtering rules of the underlying logging system.
</span></span><span class="line"><span class="cl">SLF4J: See also http://www.slf4j.org/codes.html#replay
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Press ENTER to exit &lt;&lt;&lt;
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,437] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,439] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 1 for Charles
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 2 for Charles
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 3 for Charles
</span></span><span class="line"><span class="cl">&lt;=========----&gt; 75% EXECUTING [27s]
</span></span><span class="line"><span class="cl">&gt; :run
</span></span></code></pre></td></tr></table>
</div>
</div><p>恭喜你，你刚刚运行了你的第一个 Akka 应用程序。</p>
<h2 id="hello-world-都做了什么">Hello World 都做了什么？<a hidden class="anchor" aria-hidden="true" href="#hello-world-都做了什么">#</a></h2>
<p>示例包含了三个Actor：</p>
<ul>
<li>Greeter： 接收命令来<code>Greet</code>其他人，并使用<code>Greeted</code>来确认收到了消息。</li>
<li>GreeterBot：接收到从其他Greeter回复的问候，并发送多个额外的问候消息，并收集回复信息直到达到指定的数量。</li>
<li>GreeterMain：引导一切的守护Actor</li>
</ul>
<h2 id="使用-actor-模型的好处">使用 Actor 模型的好处<a hidden class="anchor" aria-hidden="true" href="#使用-actor-模型的好处">#</a></h2>
<p>Akka 的以下特性使你能够以直观的方式解决困难的并发性和可伸缩性挑战：</p>
<ul>
<li>事件驱动模型：<code>Event-driven model</code>，Actor 通过响应消息来执行工作。Actor 之间的通信是异步的，允许 Actor 发送消息并继续自己的工作，而不是阻塞等待响应。</li>
<li>强隔离原则：<code>Strong isolation principles</code>，与 Java 中的常规对象不同，Actor 在调用的方法方面，没有一个公共 API。相反，它的公共 API 是通过 Actor 处理的消息来定义的。这可以防止 Actor 之间共享状态；观察另一个 Actor 状态的唯一方法是向其发送请求状态的消息。</li>
<li>位置透明：<code>Location transparency</code>，系统通过工厂方法构造 Actor 并返回对实例的引用。因为位置无关紧要，所以 Actor 实例可以启动、停止、移动和重新启动，以向上和向下扩展以及从意外故障中恢复。</li>
<li>轻量级：<code>Lightweight</code>，每个实例只消耗几百个字节，这实际上允许数百万并发 Actor 存在于一个应用程序中。</li>
</ul>
<p>让我们看看在<code>Hello World</code>示例中使用 Actor 和消息一起工作的一些最佳实践。</p>
<h2 id="定义-actor-和消息">定义 Actor 和消息<a hidden class="anchor" aria-hidden="true" href="#定义-actor-和消息">#</a></h2>
<p>每个Actor定义它可以接收的消息类型<code>T</code>。类(classes)和对象(objects)由于不可变并支持模式匹配，可以当做非常特别的消息类型。我们在Actor中会用到这些特性接收匹配的消息。</p>
<p><code>Hello World</code>的 Actor 使用三种不同的消息：</p>
<ul>
<li><code>Greet</code>：向<code>Greeter</code>执行问候的指令；</li>
<li><code>Greeted</code>：<code>Greeter</code>用来确认问候发生时回复的消息；</li>
<li><code>SayHello</code>：<code>GreeterMain</code>开始执行问候进程的指令；</li>
</ul>
<p>在定义 Actor 及其消息时，请记住以下建议：</p>
<ul>
<li>因为消息是 Actor 的公共 API，所以<strong>定义具有良好名称、丰富语义和特定于域的含义的消息是一个很好的实践</strong>，即使它们只是包装你的数据类型，这将使基于 Actor 的系统更容易使用、理解和调试。</li>
<li><strong>消息应该是不可变的</strong>，因为它们在不同的线程之间共享。</li>
<li>将 Actor 的关联消息作为静态类放在 Actor 的类中是一个很好的实践，这使得理解 Actor 期望和处理的消息类型更加容易。</li>
<li>通过静态工厂方法获得Actor的初始行为是一个很好的实践</li>
</ul>
<p>让我们来看看<code>Greeter</code>，<code>GreeterBot</code>和<code>GreeterMain</code>的实现是如何证明上述的这些实践建议的。</p>
<p>让我们看看 Actor 如何实现<code>Greeter</code>和<code>Printer</code>来演示这些最佳实践。</p>
<h3 id="greeter-actor">Greeter Actor<a hidden class="anchor" aria-hidden="true" href="#greeter-actor">#</a></h3>
<p>下面的代码段来自于<code>Greeter.java</code>，其实现了<code>Greeter Actor</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Greeter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractBehavior</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Greet</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">whom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">replyTo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Greet</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">whom</span><span class="p">,</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">replyTo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">whom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">whom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">replyTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replyTo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Greeted</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">whom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">from</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Greeted</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">whom</span><span class="p">,</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">from</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">whom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">whom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">setup</span><span class="p">(</span><span class="n">Greeter</span><span class="p">::</span><span class="k">new</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="nf">Greeter</span><span class="p">(</span><span class="n">ActorContext</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Receive</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createReceive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">newReceiveBuilder</span><span class="p">().</span><span class="na">onMessage</span><span class="p">(</span><span class="n">Greet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">onGreet</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">onGreet</span><span class="p">(</span><span class="n">Greet</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">getContext</span><span class="p">().</span><span class="na">getLog</span><span class="p">().</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;Hello {}!&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">whom</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">command</span><span class="p">.</span><span class="na">replyTo</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeted</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">whom</span><span class="p">,</span><span class="w"> </span><span class="n">getContext</span><span class="p">().</span><span class="na">getSelf</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>上面这个代码片段定义了两种消息类型，一种被Actor用来问候其他人，另外一种被Actor用来确认问候已经完成。<code>Greet</code>类型不仅包含了被问候人的信息，还持有了<code>ActorRef</code>，是由消息发送者提供的以便于<code>Greeter</code>Actor可以发回确认信息。</p>
<p>Actor的行为被定义为<code>Greeter</code>继承自<code>AbstractBehavior</code>，带有<code>newReceiveBuilder</code>的工厂行为。处理下一条信息然后可能导致与处理当前这条信息的行为不同。只要当前实例是可变的就可以通过修改当前实例来更新状态。在当前这个例子中，我们不需要更新任何状态，所以我们直接返回<code>this</code>而不包含任何字段更新，这也意味着，处理下一条消息的行为与当前相同。</p>
<p>被当前行为处理的消息类型被声明为类<code>Greet</code>。通常，一个<code>actor</code>处理超过一种具体的消息类型，这样会有一个所有消息类型可以实现的公共的接口。</p>
<p>在最后一行我们能看到<code>Greeter</code>Actor使用<code>tell</code>方法发送消息到另外一个Actor。这是一个不会阻塞调用者线程的异步操作。</p>
<p>因为<code>replyTo</code>地址通过类型<code>ActorRef&lt;Greeted&gt;</code>进行声明，编译器仅允许我们发送这种类型的消息，使用其他消息类型会导致编译错误。</p>
<p>这个Actor可以接收的消息类型和回复的消息类型定义了我们所说的<code>协议</code>。当前用例是一个简单的<code>请求-回复</code>协议，但Actor可以定义任意我们需要的复杂协议。协议与其行为被恰当的包装在了一个范围——<code>Greeter</code>类</p>
<h3 id="greeter-bot-actor">Greeter bot actor<a hidden class="anchor" aria-hidden="true" href="#greeter-bot-actor">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.Behavior</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.javadsl.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GreeterBot</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractBehavior</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">setup</span><span class="p">(</span><span class="n">context</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GreeterBot</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">greetingCounter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">GreeterBot</span><span class="p">(</span><span class="n">ActorContext</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Receive</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createReceive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newReceiveBuilder</span><span class="p">().</span><span class="na">onMessage</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">onGreeted</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">onGreeted</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">greetingCounter</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">getContext</span><span class="p">().</span><span class="na">getLog</span><span class="p">().</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;Greeting {} for {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">greetingCounter</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">whom</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">greetingCounter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">stopped</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">message</span><span class="p">.</span><span class="na">from</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">whom</span><span class="p">,</span><span class="w"> </span><span class="n">getContext</span><span class="p">().</span><span class="na">getSelf</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注意这个Actor如何使用实例变量管理计数器。不需要诸如<code>synchronized</code>或<code>AtomicInteger</code>这样的并发保护，因为一个Actor实例一次只处理一条消息。</p>
<h3 id="greeter-main-actor">Greeter main actor<a hidden class="anchor" aria-hidden="true" href="#greeter-main-actor">#</a></h3>
<p>第三个Actor产生了<code>Greeter</code>和<code>GreeterBot</code>，并启动他们的交互，创建Actor以及<code>spawn</code>做了什么将在下面讨论。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.ActorRef</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.Behavior</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.javadsl.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GreeterMain</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractBehavior</span><span class="o">&lt;</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SayHello</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">SayHello</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">greeter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">setup</span><span class="p">(</span><span class="n">GreeterMain</span><span class="p">::</span><span class="k">new</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">GreeterMain</span><span class="p">(</span><span class="n">ActorContext</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">greeter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">spawn</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;greeter&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Receive</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createReceive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newReceiveBuilder</span><span class="p">().</span><span class="na">onMessage</span><span class="p">(</span><span class="n">SayHello</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">onSayHello</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">onSayHello</span><span class="p">(</span><span class="n">SayHello</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">replyTo</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">getContext</span><span class="p">().</span><span class="na">spawn</span><span class="p">(</span><span class="n">GreeterBot</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">3</span><span class="p">),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">greeter</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">replyTo</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="创建-actor">创建 Actor<a hidden class="anchor" aria-hidden="true" href="#创建-actor">#</a></h2>
<p>到目前为止，我们已经研究了 Actor 的定义和他们的消息。现在，让我们更深入地了解位置透明（<code>location transparency</code>）的好处，看看如何创建 Actor 实例。</p>
<h3 id="位置透明的好处">位置透明的好处<a hidden class="anchor" aria-hidden="true" href="#位置透明的好处">#</a></h3>
<p>在 Akka 中，不能使用<code>new</code>关键字创建 Actor 的实例。相反，你应该使用工厂方法创建 Actor 实例。工厂不返回 Actor 实例，而是返回指向 Actor 实例的引用<code>akka.actor.ActorRef</code>。在分布式系统中，这种间接创建实例的方法增加了很多好处和灵活性。</p>
<p>在 Akka 中位置无关紧要。位置透明性意味着，无论是在正在运行 Actor 的进程内，还是运行在远程计算机上，<code>ActorRef</code>都可以保持相同语义。如果需要，运行时可以通过更改 Actor 的位置或整个应用程序拓扑来优化系统。这就启用了故障管理的“让它崩溃（<code>let it crash</code>）”模型，在该模型中，系统可以通过销毁有问题的 Actor 和重新启动健康的 Actor 来自我修复。</p>
<h3 id="akka-actorsystem">Akka ActorSystem<a hidden class="anchor" aria-hidden="true" href="#akka-actorsystem">#</a></h3>
<p><code>ActorSystem</code>是Akka的初始接入点。通常每个应用使用一个<code>AcotrSystem</code>来创建。<code>ActorSystem</code>有一个名称和一个守护Actor。应用的启动通常在守护Actor中完成。</p>
<p>当前这个<code>ActorSystem</code>的守护Actor是<code>GreeterMain</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">final</span><span class="w"> </span><span class="n">ActorSystem</span><span class="o">&lt;</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="n">greeterMain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActorSystem</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;helloakka&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>它使用<code>Behaviors.setup</code>来启动应用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.ActorRef</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.Behavior</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.javadsl.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GreeterMain</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractBehavior</span><span class="o">&lt;</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SayHello</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">SayHello</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">greeter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">setup</span><span class="p">(</span><span class="n">GreeterMain</span><span class="p">::</span><span class="k">new</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">GreeterMain</span><span class="p">(</span><span class="n">ActorContext</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">greeter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">spawn</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;greeter&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Receive</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createReceive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newReceiveBuilder</span><span class="p">().</span><span class="na">onMessage</span><span class="p">(</span><span class="n">SayHello</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">onSayHello</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">onSayHello</span><span class="p">(</span><span class="n">SayHello</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">replyTo</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">getContext</span><span class="p">().</span><span class="na">spawn</span><span class="p">(</span><span class="n">GreeterBot</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">3</span><span class="p">),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">greeter</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">replyTo</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="新建子actors">新建子actors<a hidden class="anchor" aria-hidden="true" href="#新建子actors">#</a></h3>
<p>其他actor的创建在<code>ActorContext</code>上使用<code>spawn</code>方法。<code>GreeterMain</code>在启动时使用这种方式创建一个<code>Greeter</code>，并且每收到一个<code>SayHello</code>消息创建一个新的<code>GreeterBot</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">greeter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">spawn</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;greeter&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">replyTo</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">getContext</span><span class="p">().</span><span class="na">spawn</span><span class="p">(</span><span class="n">GreeterBot</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">3</span><span class="p">),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">greeter</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">replyTo</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="异步通信">异步通信<a hidden class="anchor" aria-hidden="true" href="#异步通信">#</a></h2>
<p>Actor 是被动的和消息驱动的。Actor 在收到消息前什么都不做。Actor 使用异步消息进行通信。这样可以确保发送者不会一直等待接收者处理他们的消息。相反，发件人将邮件放在收件人的邮箱之后，就可以自由地进行其他工作。Actor 的邮箱本质上是一个具有排序语义的消息队列。从同一个 Actor 发送的多条消息的顺序被保留，但可以与另一个 Actor 发送的消息交错。</p>
<p>你可能想知道 Actor 在不处理消息的时候在做什么，比如，做什么实际的工作？实际上，它处于挂起状态，在这种状态下，它不消耗除内存之外的任何资源。同样，这也展示了 Actor 的轻量级和高效性。</p>
<h3 id="给-actor-发生消息">给 Actor 发生消息<a hidden class="anchor" aria-hidden="true" href="#给-actor-发生消息">#</a></h3>
<p>要将消息放入 Actor 的邮箱，我们需要使用<code>ActorRef</code>的<code>tell</code>方法。例如，<code>Hello World</code>的主函数<code>main</code>向<code>Greeter</code> Actor 发送如下消息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">greeterMain</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>Greeter</code> Actor  也回复确认消息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">command</span><span class="p">.</span><span class="na">replyTo</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeted</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">whom</span><span class="p">,</span><span class="w"> </span><span class="n">getContext</span><span class="p">().</span><span class="na">getSelf</span><span class="p">()));</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>我们已经研究了如何创建 Actor 和发送消息。现在，让我们来回顾一下<code>Main</code>类的全部内容。</p>
<h2 id="main-class">Main class<a hidden class="anchor" aria-hidden="true" href="#main-class">#</a></h2>
<p><code>Hello World</code>中的<code>AkkaQuickstart</code>对象创建了带有守护者的<code>ActorSystem</code>，守护者是顶层的负责启动应用的actor。守护者通常使用包含初始启动的<code>Behaviors.setup</code>进行定义。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.ActorSystem</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AkkaQuickstart</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#actor-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorSystem</span><span class="o">&lt;</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="n">greeterMain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActorSystem</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;helloakka&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#actor-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#main-send-messages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">greeterMain</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#main-send-messages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;&gt;&gt;&gt; Press ENTER to exit &lt;&lt;&lt;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">.</span><span class="na">read</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ignored</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">greeterMain</span><span class="p">.</span><span class="na">terminate</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="完整代码">完整代码<a hidden class="anchor" aria-hidden="true" href="#完整代码">#</a></h2>
<p>下面是创建示例应用程序的三个类<code>Greeter</code>，<code>GreeterBot</code>，<code>GreeterMain</code>和<code>AkkaQuickstart</code>的完整源代码：</p>
<h3 id="greaterjava">Greater.java<a hidden class="anchor" aria-hidden="true" href="#greaterjava">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.ActorRef</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.Behavior</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.javadsl.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Objects</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// #greeter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Greeter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractBehavior</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Greet</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">whom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">replyTo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Greet</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">whom</span><span class="p">,</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">replyTo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">whom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">whom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">replyTo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replyTo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Greeted</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">whom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">from</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Greeted</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">whom</span><span class="p">,</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">from</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">whom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">whom</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// #greeter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">getClass</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="na">getClass</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">Greeted</span><span class="w"> </span><span class="n">greeted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Greeted</span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">whom</span><span class="p">,</span><span class="w"> </span><span class="n">greeted</span><span class="p">.</span><span class="na">whom</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">greeted</span><span class="p">.</span><span class="na">from</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">hash</span><span class="p">(</span><span class="n">whom</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;Greeted{&#34;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="s">&#34;whom=&#39;&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">whom</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="s">&#34;, from=&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="sc">&#39;}&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// #greeter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">setup</span><span class="p">(</span><span class="n">Greeter</span><span class="p">::</span><span class="k">new</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="nf">Greeter</span><span class="p">(</span><span class="n">ActorContext</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Receive</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createReceive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">newReceiveBuilder</span><span class="p">().</span><span class="na">onMessage</span><span class="p">(</span><span class="n">Greet</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">onGreet</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">onGreet</span><span class="p">(</span><span class="n">Greet</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">getContext</span><span class="p">().</span><span class="na">getLog</span><span class="p">().</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;Hello {}!&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">whom</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#greeter-send-message</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">command</span><span class="p">.</span><span class="na">replyTo</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeted</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">whom</span><span class="p">,</span><span class="w"> </span><span class="n">getContext</span><span class="p">().</span><span class="na">getSelf</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#greeter-send-message</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// #greeter</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="greeterbotjava">GreeterBot.java<a hidden class="anchor" aria-hidden="true" href="#greeterbotjava">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.Behavior</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.javadsl.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GreeterBot</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractBehavior</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">setup</span><span class="p">(</span><span class="n">context</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GreeterBot</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">greetingCounter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">GreeterBot</span><span class="p">(</span><span class="n">ActorContext</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Receive</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createReceive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newReceiveBuilder</span><span class="p">().</span><span class="na">onMessage</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">onGreeted</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">onGreeted</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">greetingCounter</span><span class="o">++</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">getContext</span><span class="p">().</span><span class="na">getLog</span><span class="p">().</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;Greeting {} for {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">greetingCounter</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">whom</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">greetingCounter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">stopped</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">message</span><span class="p">.</span><span class="na">from</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">whom</span><span class="p">,</span><span class="w"> </span><span class="n">getContext</span><span class="p">().</span><span class="na">getSelf</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="greetermainjava">GreeterMain.java<a hidden class="anchor" aria-hidden="true" href="#greetermainjava">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.ActorRef</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.Behavior</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.javadsl.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GreeterMain</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractBehavior</span><span class="o">&lt;</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SayHello</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">SayHello</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">greeter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Behaviors</span><span class="p">.</span><span class="na">setup</span><span class="p">(</span><span class="n">GreeterMain</span><span class="p">::</span><span class="k">new</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">GreeterMain</span><span class="p">(</span><span class="n">ActorContext</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">greeter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">spawn</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;greeter&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Receive</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createReceive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newReceiveBuilder</span><span class="p">().</span><span class="na">onMessage</span><span class="p">(</span><span class="n">SayHello</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">::</span><span class="n">onSayHello</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Behavior</span><span class="o">&lt;</span><span class="n">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">onSayHello</span><span class="p">(</span><span class="n">SayHello</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">replyTo</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">getContext</span><span class="p">().</span><span class="na">spawn</span><span class="p">(</span><span class="n">GreeterBot</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">3</span><span class="p">),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">name</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">greeter</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">name</span><span class="p">,</span><span class="w"> </span><span class="n">replyTo</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//#create-actors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="akkaquickstartjava">AkkaQuickstart.java<a hidden class="anchor" aria-hidden="true" href="#akkaquickstartjava">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.ActorSystem</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AkkaQuickstart</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#actor-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">ActorSystem</span><span class="o">&lt;</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="o">&gt;</span><span class="w"> </span><span class="n">greeterMain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActorSystem</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;helloakka&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#actor-system</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#main-send-messages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">greeterMain</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GreeterMain</span><span class="p">.</span><span class="na">SayHello</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#main-send-messages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;&gt;&gt;&gt; Press ENTER to exit &lt;&lt;&lt;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">.</span><span class="na">read</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ignored</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">greeterMain</span><span class="p">.</span><span class="na">terminate</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>作为另一个最佳实践，我们应该提供一些单元测试。</p>
<h2 id="测试-actor">测试 Actor<a hidden class="anchor" aria-hidden="true" href="#测试-actor">#</a></h2>
<p><code>Hello World</code>示例中的测试展示了 JUnit 框架的使用。虽然测试的覆盖范围不完整，但它简单地展示了测试 Actor 代码是多么的容易，并提供了一些基本概念。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.testkit.typed.javadsl.TestKitJunitResource</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.testkit.typed.javadsl.TestProbe</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.ActorRef</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.ClassRule</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//#definition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AkkaQuickstartTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ClassRule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">TestKitJunitResource</span><span class="w"> </span><span class="n">testKit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TestKitJunitResource</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//#definition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testGreeterActorSendingOfGreeting</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TestProbe</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">testProbe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testKit</span><span class="p">.</span><span class="na">createTestProbe</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">underTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testKit</span><span class="p">.</span><span class="na">spawn</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;greeter&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">underTest</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">testProbe</span><span class="p">.</span><span class="na">getRef</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">testProbe</span><span class="p">.</span><span class="na">expectMessage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">underTest</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="测试类定义">测试类定义<a hidden class="anchor" aria-hidden="true" href="#测试类定义">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AkkaQuickstartTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ClassRule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">TestKitJunitResource</span><span class="w"> </span><span class="n">testKit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TestKitJunitResource</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>使用<code>TestKitJunitResource</code> JUnit规则包含对JUnit的支持。自动创建并清理<code>ActorTestKit</code>。通过<a href="https://doc.akka.io/docs/akka/2.6/typed/testing-async.html">完整文档</a>查看如何直接使用<code>testkit</code></p>
<h3 id="测试方法">测试方法<a hidden class="anchor" aria-hidden="true" href="#测试方法">#</a></h3>
<p>这个测试使用<code>TestProbe </code>来检查并确认是否得到期望的行为，源码片段如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testGreeterActorSendingOfGreeting</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">TestProbe</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">testProbe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testKit</span><span class="p">.</span><span class="na">createTestProbe</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">underTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testKit</span><span class="p">.</span><span class="na">spawn</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;greeter&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">underTest</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">testProbe</span><span class="p">.</span><span class="na">getRef</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">testProbe</span><span class="p">.</span><span class="na">expectMessage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">underTest</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>一旦我们有了<code>TestProbe </code>的引用，我们将它传递给<code>Greeter</code>作为<code>Greet</code>消息的一部分。然后确认<code>Greeter</code>响应问候发生。</p>
<h3 id="完整测试程序">完整测试程序<a hidden class="anchor" aria-hidden="true" href="#完整测试程序">#</a></h3>
<p>这里是完整的测试代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="err">$</span><span class="nn">package</span><span class="n">$</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.testkit.typed.javadsl.TestKitJunitResource</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.testkit.typed.javadsl.TestProbe</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">akka.actor.typed.ActorRef</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.ClassRule</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//#definition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AkkaQuickstartTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@ClassRule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">TestKitJunitResource</span><span class="w"> </span><span class="n">testKit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TestKitJunitResource</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//#definition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testGreeterActorSendingOfGreeting</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TestProbe</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="o">&gt;</span><span class="w"> </span><span class="n">testProbe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testKit</span><span class="p">.</span><span class="na">createTestProbe</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ActorRef</span><span class="o">&lt;</span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">underTest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testKit</span><span class="p">.</span><span class="na">spawn</span><span class="p">(</span><span class="n">Greeter</span><span class="p">.</span><span class="na">create</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;greeter&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">underTest</span><span class="p">.</span><span class="na">tell</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greet</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">testProbe</span><span class="p">.</span><span class="na">getRef</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">testProbe</span><span class="p">.</span><span class="na">expectMessage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Greeter</span><span class="p">.</span><span class="na">Greeted</span><span class="p">(</span><span class="s">&#34;Charles&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">underTest</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//#test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>示例代码只涉及了<code>ActorTestKit</code>功能的一小部分，在「<a href="https://doc.akka.io/docs/akka/current/testing.html?language=java">这里</a>」可以找到更完整的概述。</p>
<h2 id="运行应用程序">运行应用程序<a hidden class="anchor" aria-hidden="true" href="#运行应用程序">#</a></h2>
<p>你可以通过命令行或者 IDE 来运行<code>Hello World</code>应用程序。在本指南的最后一个主题，我们描述了如何在 <a href="https://developer.lightbend.com/guides/akka-quickstart-java/intellij-idea.html">IntelliJ IDEA</a> 中运行该示例。但是，在我们再次运行应用程序之前，让我们先快速的查看构建文件。</p>
<ul>
<li>Maven POM 文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- #build-sample --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;project&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>hello-akka-java<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>app<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;akka.version&gt;</span>$akka_version$<span class="nt">&lt;/akka.version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.typesafe.akka<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>akka-actor-typed_2.13<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>\${akka.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.typesafe.akka<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>akka-actor-testkit-typed_2.13<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>\${akka.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>4.13.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>3.5.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>exec-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>1.6.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;executable&gt;</span>java<span class="nt">&lt;/executable&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;arguments&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;argument&gt;</span>-classpath<span class="nt">&lt;/argument&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;classpath</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;argument&gt;</span>$package$.AkkaQuickstart<span class="nt">&lt;/argument&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/arguments&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/build&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Grade 构建文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apply plugin: &#39;java&#39;
</span></span><span class="line"><span class="cl">apply plugin: &#39;idea&#39;
</span></span><span class="line"><span class="cl">apply plugin: &#39;application&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">repositories {
</span></span><span class="line"><span class="cl">    mavenCentral()
</span></span><span class="line"><span class="cl">    mavenLocal()
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dependencies {
</span></span><span class="line"><span class="cl">  implementation &#39;com.typesafe.akka:akka-actor-typed_2.13:$akka_version$&#39;
</span></span><span class="line"><span class="cl">  implementation &#39;ch.qos.logback:logback-classic:1.2.3&#39;
</span></span><span class="line"><span class="cl">  testImplementation &#39;com.typesafe.akka:akka-actor-testkit-typed_2.13:$akka_version$&#39;
</span></span><span class="line"><span class="cl">  testImplementation &#39;junit:junit:4.13.1&#39;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mainClassName = &#34;$package$.AkkaQuickstart&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">run {
</span></span><span class="line"><span class="cl">  standardInput = System.in
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：有些依赖有后缀<code>_2.13</code>，这个后缀是编译依赖的scala版本。所有依赖必须使用相同的scala版本编译。所以你不能在单个项目中使用<code>akka-actors_2.13</code>和<code>akka-testkit_2.12</code>，因为它们有不同的scala版本。</p>
<h3 id="运行项目">运行项目<a hidden class="anchor" aria-hidden="true" href="#运行项目">#</a></h3>
<p>和前面一样，从控制台运行应用程序：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//  Maven
</span></span><span class="line"><span class="cl">$ mvn compile exec:exec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Grade
</span></span><span class="line"><span class="cl">$ gradle run
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出应该如下所示（一直向右滚动以查看 Actor 输出）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// Maven
</span></span><span class="line"><span class="cl">Scanning for projects...
</span></span><span class="line"><span class="cl">[INFO]
</span></span><span class="line"><span class="cl">[INFO] ------------------------&lt; hello-akka-java:app &gt;-------------------------
</span></span><span class="line"><span class="cl">[INFO] Building app 1.0
</span></span><span class="line"><span class="cl">[INFO] --------------------------------[ jar ]---------------------------------
</span></span><span class="line"><span class="cl">[INFO]
</span></span><span class="line"><span class="cl">[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ app ---
</span></span><span class="line"><span class="cl">[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
</span></span><span class="line"><span class="cl">[INFO]
</span></span><span class="line"><span class="cl">[INFO] --- exec-maven-plugin:1.6.0:exec (default-cli) @ app ---
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,248] [INFO] [akka.event.slf4j.Slf4jLogger] [helloakka-akka.actor.default-dispatcher-3] [] -
</span></span><span class="line"><span class="cl">Slf4jLogger started
</span></span><span class="line"><span class="cl">SLF4J: A number (1) of logging calls during the initialization phase have been intercepted and are
</span></span><span class="line"><span class="cl">SLF4J: now being replayed. These are subject to the filtering rules of the underlying logging system.
</span></span><span class="line"><span class="cl">SLF4J: See also http://www.slf4j.org/codes.html#replay
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Press ENTER to exit &lt;&lt;&lt;
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,288] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,290] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 1 for Charles
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 2 for Charles
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:20:30,291] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 3 for Charles
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Grade
</span></span><span class="line"><span class="cl">:run 
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,399] [INFO] [akka.event.slf4j.Slf4jLogger] [helloakka-akka.actor.default-dispatcher-3] [] -
</span></span><span class="line"><span class="cl">Slf4jLogger started
</span></span><span class="line"><span class="cl">SLF4J: A number (1) of logging calls during the initialization phase have been intercepted and are
</span></span><span class="line"><span class="cl">SLF4J: now being replayed. These are subject to the filtering rules of the underlying logging system.
</span></span><span class="line"><span class="cl">SLF4J: See also http://www.slf4j.org/codes.html#replay
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Press ENTER to exit &lt;&lt;&lt;
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,437] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,439] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 1 for Charles
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 2 for Charles
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.Greeter] [helloakka-akka.actor.default-dispatcher-6]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/greeter] - Hello Charles!
</span></span><span class="line"><span class="cl">[2019-10-12 09:47:16,440] [INFO] [com.lightbend.akka.sample.GreeterBot] [helloakka-akka.actor.default-dispatcher-3]
</span></span><span class="line"><span class="cl">[akka://helloakka/user/Charles] - Greeting 3 for Charles
</span></span><span class="line"><span class="cl">&lt;=========----&gt; 75% EXECUTING [27s]
</span></span><span class="line"><span class="cl">&gt; :run
</span></span></code></pre></td></tr></table>
</div>
</div><p>还记得我们实现 Greeter Actor 使用 Akka 的 Logger 吗？这就是为什么我们记录东西时会有很多额外的信息。例如，日志输出包含诸如何时和从哪个 Actor 记录日志之类的信息。</p>
<p>请注意应用程序一直执行，直到你按下回车键或使用其他方式中断。</p>
<p>为了执行单元测试，我们输入<code>test</code>命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//  Maven
</span></span><span class="line"><span class="cl">$ mvn test
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Grade
</span></span><span class="line"><span class="cl">$ gradle test
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="下一步">下一步<a hidden class="anchor" aria-hidden="true" href="#下一步">#</a></h3>
<p>如果你使用 IntelliJ，请尝试将示例项目与 <a href="https://developer.lightbend.com/guides/akka-quickstart-java/intellij-idea.html">IntelliJ IDEA</a> 集成。</p>
<p>想要继续了解更多有关 Akka 和 Actor Systems 的信息，请参阅「<a href="http://doc.akka.io/docs/akka/current/java/guide/introduction.html">Getting Started Guide</a>」，欢迎你加入我们！</p>
<h2 id="intellij-idea">IntelliJ IDEA<a hidden class="anchor" aria-hidden="true" href="#intellij-idea">#</a></h2>
<p>JetBrains 的 IntelliJ 是 Java/Scala 社区中领先的 IDE 之一，它对 Akka 有着极好的支持。本节将指导你完成示例项目的设置、测试和运行。</p>
<h3 id="设置项目">设置项目<a hidden class="anchor" aria-hidden="true" href="#设置项目">#</a></h3>
<p>设置项目很简单。打开 IntelliJ 并选择<code>File -&gt; Open...</code>并指向你安装示例项目的目录。</p>
<h3 id="检查项目代码">检查项目代码<a hidden class="anchor" aria-hidden="true" href="#检查项目代码">#</a></h3>
<p>如果我们打开文件<code>src/main/java/com/lightbend/akka/sample/HelloAkka.java</code>，我们将看到许多行以<code>//# ...</code>开头，作为文档的注释。为了从源代码中去掉这些行，我们可以在 IntelliJ 中使用出色的查找/替换功能。选择<code>Edit -&gt; Find -&gt; Replace in Path...</code>，选中<code>Regex</code>框并添加<code>[//#].*</code>正则表达式，然后单击查找窗口中的<code>Replace in Find Window...</code>。选择想要替换的内容，并对所有文件重复此操作。</p>
<h3 id="测试和运行">测试和运行<a hidden class="anchor" aria-hidden="true" href="#测试和运行">#</a></h3>
<p>对于测试，我们只需右键单击文件<code>src/test/java/com/lightbend/akka/sample/HelloAkkaTest.java</code>，然后选择<code>Run 'HelloAkkaTest'</code>。</p>
<p>类似地运行应用程序，我们右击文件<code>src/main/java/com/lightbend/akka/sample/HelloAkka.java</code>，并选择<code>Run 'HelloAkka.main()'</code>。</p>
<p>有关更多详细信息，请参阅「<a href="#%E8%BF%90%E8%A1%8C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">运行应用程序</a>」部分。</p>
<p>想要进一步了解 IntelliJ IDEA，可以参阅「<a href="https://github.com/guobinhit/intellij-idea-tutorial">史上最简单的 IntelliJ IDEA 教程</a>」系列文章。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://WFUing.github.io/tags/akka/">akka</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://WFUing.github.io/post/tech/network/http-process/">
    <span class="title">« 上一页</span>
    <br>
    <span>一次完整的HTTP请求过程</span>
  </a>
  <a class="next" href="https://WFUing.github.io/post/tech/architecture/iot/concept/">
    <span class="title">下一页 »</span>
    <br>
    <span>术语与概念</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 快速入门 Akka Java 指南 on twitter"
        href="https://twitter.com/intent/tweet/?text=%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8%20Akka%20Java%20%e6%8c%87%e5%8d%97&amp;url=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2farchitecture%2fiot%2fakka-java%2f&amp;hashtags=akka">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 快速入门 Akka Java 指南 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2farchitecture%2fiot%2fakka-java%2f&amp;title=%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8%20Akka%20Java%20%e6%8c%87%e5%8d%97&amp;summary=%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8%20Akka%20Java%20%e6%8c%87%e5%8d%97&amp;source=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2farchitecture%2fiot%2fakka-java%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 快速入门 Akka Java 指南 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2farchitecture%2fiot%2fakka-java%2f&title=%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8%20Akka%20Java%20%e6%8c%87%e5%8d%97">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 快速入门 Akka Java 指南 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2farchitecture%2fiot%2fakka-java%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 快速入门 Akka Java 指南 on whatsapp"
        href="https://api.whatsapp.com/send?text=%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8%20Akka%20Java%20%e6%8c%87%e5%8d%97%20-%20https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2farchitecture%2fiot%2fakka-java%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 快速入门 Akka Java 指南 on telegram"
        href="https://telegram.me/share/url?text=%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8%20Akka%20Java%20%e6%8c%87%e5%8d%97&amp;url=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2farchitecture%2fiot%2fakka-java%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 快速入门 Akka Java 指南 on ycombinator"
        href="https://news.ycombinator.com/submitlink?t=%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8%20Akka%20Java%20%e6%8c%87%e5%8d%97&u=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2farchitecture%2fiot%2fakka-java%2f">
        <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
            <path
                d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
        </svg>
    </a>
</div>

  </footer>
<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">💬评论</span>
        <hr />
    </div>
    <div id="tcomment"></div>
    <script src="https://cdn.staticfile.org/twikoo/1.4.11/twikoo.all.min.js"></script>
    <script>
        twikoo.init({
            envId: "https://twikoo-api-three-gamma.vercel.app/",  
            el: "#tcomment",
            lang: 'zh-CN',
            region: 'ap-guangzhou',  
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        });
    </script>
</div>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://WFUing.github.io/">Waiting For You</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
