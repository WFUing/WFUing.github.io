<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>meta-programming | Waiting For You</title>
<meta name="keywords" content="metaprogramming, language">
<meta name="description" content="å…ƒç¼–ç¨‹æ˜¯ç¼–å†™å¯åœ¨å…¶ä»–ç¨‹åºä¸Šè¿è¡Œçš„è®¡ç®—æœºç¨‹åºçš„æŠ€æœ¯ã€‚è¯¸å¦‚ç¼–è¯‘å™¨å’Œç¨‹åºåˆ†æå™¨ä¹‹ç±»çš„ç³»ç»Ÿå¯ä»¥è¢«è§†ä¸ºå…ƒç¨‹åºï¼Œå› ä¸ºå®ƒä»¬å°†å…¶ä»–ç¨‹åºä½œä¸ºè¾“å…¥ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºçš„å…ƒç¼–ç¨‹å½¢å¼ç‰¹åˆ«å…³æ³¨ç”Ÿæˆè¦ä½œä¸ºç¨‹åºä¸€éƒ¨åˆ†åŒ…å«çš„ä»£ç ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¤ä¸ºæ˜¯åˆçº§ç¼–è¯‘å™¨ã€‚
Macros and Code Generation macro æ˜¯å°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºæŸç§æ›¿æ¢è¾“å‡ºåºåˆ—çš„è§„åˆ™ã€‚è¿™ä¸ªç¿»è¯‘è¿‡ç¨‹ç§°ä¸º macro expansionï¼Œä¸€äº›è¯­è¨€æä¾›å®ä½œä¸ºå…¶è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å®è®¾æ–½å¯ä»¥è¢«å®ç°ä¸º preprocessing stepï¼Œå…¶ä¸­å®æ‰©å±•å‘ç”Ÿåœ¨ lexical and syntactic analysis ä¹‹å‰ï¼Œæˆ–è€…å®ƒå¯ä»¥è¢«åˆå¹¶ä¸º syntax analysis æˆ– a later translation stepã€‚
ä½¿ç”¨æœ€å¹¿æ³›çš„ macro systems ä¹‹ä¸€æ˜¯ C é¢„å¤„ç†å™¨ï¼ˆCPPï¼‰ï¼Œå®ƒä½œä¸ºå¤„ç†ç¨‹åºçš„ç¬¬ä¸€æ­¥è¢«åŒ…å«åœ¨ C å’Œ C&#43;&#43; ä¸­ã€‚é¢„å¤„ç†å™¨æŒ‡ä»¤ä»¥æ•£åˆ—ç¬¦å·å¼€å¤´ï¼ŒåŒ…æ‹¬ #includeã€#defineã€#if ç­‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªç±»ä¼¼å‡½æ•°çš„ macro æ¥äº¤æ¢ä¸¤ä¸ªé¡¹ç›®ï¼š
1 #define SWAP(a, b) { auto tmp = b; b = a; a = tmp; } ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨å®ï¼š
1 2 3 4 5 6 7 8 9 int main() { int x = 3; int y = 4; SWAP(x, y); cout &lt;&lt; x &lt;&lt; &#34; &#34; &lt;&lt; y &lt;&lt; endl; } // output 4 3 é€šè¿‡å‘ g&#43;&#43; ä¼ é€’ -E æ ‡å¿—ï¼Œå¯ä»¥è·å¾—å®æ‰©å±•çš„ç»“æœï¼š">
<meta name="author" content="WFUing">
<link rel="canonical" href="https://WFUing.github.io/post/tech/language/metaprogramming/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.4826a65311a560dd509e51c68a8ba0b686724e899e3dd2073a0aabed6d1af607.css" integrity="sha256-SCamUxGlYN1QnlHGiougtoZyTomePdIHOgqr7W0a9gc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://WFUing.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://WFUing.github.io/img/logo.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://WFUing.github.io/img/logo.gif">
<link rel="apple-touch-icon" href="https://WFUing.github.io/logo.gif">
<link rel="mask-icon" href="https://WFUing.github.io/logo.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            },
            "HTML-CSS": {
                availableFonts: ["Arial", "TeX"],
                preferredFont: "TeX",
                webFont: "TeX"
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>

<meta property="og:title" content="meta-programming" />
<meta property="og:description" content="å…ƒç¼–ç¨‹æ˜¯ç¼–å†™å¯åœ¨å…¶ä»–ç¨‹åºä¸Šè¿è¡Œçš„è®¡ç®—æœºç¨‹åºçš„æŠ€æœ¯ã€‚è¯¸å¦‚ç¼–è¯‘å™¨å’Œç¨‹åºåˆ†æå™¨ä¹‹ç±»çš„ç³»ç»Ÿå¯ä»¥è¢«è§†ä¸ºå…ƒç¨‹åºï¼Œå› ä¸ºå®ƒä»¬å°†å…¶ä»–ç¨‹åºä½œä¸ºè¾“å…¥ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºçš„å…ƒç¼–ç¨‹å½¢å¼ç‰¹åˆ«å…³æ³¨ç”Ÿæˆè¦ä½œä¸ºç¨‹åºä¸€éƒ¨åˆ†åŒ…å«çš„ä»£ç ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¤ä¸ºæ˜¯åˆçº§ç¼–è¯‘å™¨ã€‚
Macros and Code Generation macro æ˜¯å°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºæŸç§æ›¿æ¢è¾“å‡ºåºåˆ—çš„è§„åˆ™ã€‚è¿™ä¸ªç¿»è¯‘è¿‡ç¨‹ç§°ä¸º macro expansionï¼Œä¸€äº›è¯­è¨€æä¾›å®ä½œä¸ºå…¶è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å®è®¾æ–½å¯ä»¥è¢«å®ç°ä¸º preprocessing stepï¼Œå…¶ä¸­å®æ‰©å±•å‘ç”Ÿåœ¨ lexical and syntactic analysis ä¹‹å‰ï¼Œæˆ–è€…å®ƒå¯ä»¥è¢«åˆå¹¶ä¸º syntax analysis æˆ– a later translation stepã€‚
ä½¿ç”¨æœ€å¹¿æ³›çš„ macro systems ä¹‹ä¸€æ˜¯ C é¢„å¤„ç†å™¨ï¼ˆCPPï¼‰ï¼Œå®ƒä½œä¸ºå¤„ç†ç¨‹åºçš„ç¬¬ä¸€æ­¥è¢«åŒ…å«åœ¨ C å’Œ C&#43;&#43; ä¸­ã€‚é¢„å¤„ç†å™¨æŒ‡ä»¤ä»¥æ•£åˆ—ç¬¦å·å¼€å¤´ï¼ŒåŒ…æ‹¬ #includeã€#defineã€#if ç­‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªç±»ä¼¼å‡½æ•°çš„ macro æ¥äº¤æ¢ä¸¤ä¸ªé¡¹ç›®ï¼š
1 #define SWAP(a, b) { auto tmp = b; b = a; a = tmp; } ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨å®ï¼š
1 2 3 4 5 6 7 8 9 int main() { int x = 3; int y = 4; SWAP(x, y); cout &lt;&lt; x &lt;&lt; &#34; &#34; &lt;&lt; y &lt;&lt; endl; } // output 4 3 é€šè¿‡å‘ g&#43;&#43; ä¼ é€’ -E æ ‡å¿—ï¼Œå¯ä»¥è·å¾—å®æ‰©å±•çš„ç»“æœï¼š" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://WFUing.github.io/post/tech/language/metaprogramming/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-10-16T15:29:44+08:00" />
<meta property="article:modified_time" content="2023-10-16T15:29:44+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="meta-programming"/>
<meta name="twitter:description" content="å…ƒç¼–ç¨‹æ˜¯ç¼–å†™å¯åœ¨å…¶ä»–ç¨‹åºä¸Šè¿è¡Œçš„è®¡ç®—æœºç¨‹åºçš„æŠ€æœ¯ã€‚è¯¸å¦‚ç¼–è¯‘å™¨å’Œç¨‹åºåˆ†æå™¨ä¹‹ç±»çš„ç³»ç»Ÿå¯ä»¥è¢«è§†ä¸ºå…ƒç¨‹åºï¼Œå› ä¸ºå®ƒä»¬å°†å…¶ä»–ç¨‹åºä½œä¸ºè¾“å…¥ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºçš„å…ƒç¼–ç¨‹å½¢å¼ç‰¹åˆ«å…³æ³¨ç”Ÿæˆè¦ä½œä¸ºç¨‹åºä¸€éƒ¨åˆ†åŒ…å«çš„ä»£ç ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¤ä¸ºæ˜¯åˆçº§ç¼–è¯‘å™¨ã€‚
Macros and Code Generation macro æ˜¯å°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºæŸç§æ›¿æ¢è¾“å‡ºåºåˆ—çš„è§„åˆ™ã€‚è¿™ä¸ªç¿»è¯‘è¿‡ç¨‹ç§°ä¸º macro expansionï¼Œä¸€äº›è¯­è¨€æä¾›å®ä½œä¸ºå…¶è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å®è®¾æ–½å¯ä»¥è¢«å®ç°ä¸º preprocessing stepï¼Œå…¶ä¸­å®æ‰©å±•å‘ç”Ÿåœ¨ lexical and syntactic analysis ä¹‹å‰ï¼Œæˆ–è€…å®ƒå¯ä»¥è¢«åˆå¹¶ä¸º syntax analysis æˆ– a later translation stepã€‚
ä½¿ç”¨æœ€å¹¿æ³›çš„ macro systems ä¹‹ä¸€æ˜¯ C é¢„å¤„ç†å™¨ï¼ˆCPPï¼‰ï¼Œå®ƒä½œä¸ºå¤„ç†ç¨‹åºçš„ç¬¬ä¸€æ­¥è¢«åŒ…å«åœ¨ C å’Œ C&#43;&#43; ä¸­ã€‚é¢„å¤„ç†å™¨æŒ‡ä»¤ä»¥æ•£åˆ—ç¬¦å·å¼€å¤´ï¼ŒåŒ…æ‹¬ #includeã€#defineã€#if ç­‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªç±»ä¼¼å‡½æ•°çš„ macro æ¥äº¤æ¢ä¸¤ä¸ªé¡¹ç›®ï¼š
1 #define SWAP(a, b) { auto tmp = b; b = a; a = tmp; } ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨å®ï¼š
1 2 3 4 5 6 7 8 9 int main() { int x = 3; int y = 4; SWAP(x, y); cout &lt;&lt; x &lt;&lt; &#34; &#34; &lt;&lt; y &lt;&lt; endl; } // output 4 3 é€šè¿‡å‘ g&#43;&#43; ä¼ é€’ -E æ ‡å¿—ï¼Œå¯ä»¥è·å¾—å®æ‰©å±•çš„ç»“æœï¼š"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://WFUing.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Technology",
      "item": "https://WFUing.github.io/post/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Language",
      "item": "https://WFUing.github.io/post/tech/language/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "meta-programming",
      "item": "https://WFUing.github.io/post/tech/language/metaprogramming/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "meta-programming",
  "name": "meta-programming",
  "description": "å…ƒç¼–ç¨‹æ˜¯ç¼–å†™å¯åœ¨å…¶ä»–ç¨‹åºä¸Šè¿è¡Œçš„è®¡ç®—æœºç¨‹åºçš„æŠ€æœ¯ã€‚è¯¸å¦‚ç¼–è¯‘å™¨å’Œç¨‹åºåˆ†æå™¨ä¹‹ç±»çš„ç³»ç»Ÿå¯ä»¥è¢«è§†ä¸ºå…ƒç¨‹åºï¼Œå› ä¸ºå®ƒä»¬å°†å…¶ä»–ç¨‹åºä½œä¸ºè¾“å…¥ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºçš„å…ƒç¼–ç¨‹å½¢å¼ç‰¹åˆ«å…³æ³¨ç”Ÿæˆè¦ä½œä¸ºç¨‹åºä¸€éƒ¨åˆ†åŒ…å«çš„ä»£ç ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¤ä¸ºæ˜¯åˆçº§ç¼–è¯‘å™¨ã€‚\nMacros and Code Generation macro æ˜¯å°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºæŸç§æ›¿æ¢è¾“å‡ºåºåˆ—çš„è§„åˆ™ã€‚è¿™ä¸ªç¿»è¯‘è¿‡ç¨‹ç§°ä¸º macro expansionï¼Œä¸€äº›è¯­è¨€æä¾›å®ä½œä¸ºå…¶è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å®è®¾æ–½å¯ä»¥è¢«å®ç°ä¸º preprocessing stepï¼Œå…¶ä¸­å®æ‰©å±•å‘ç”Ÿåœ¨ lexical and syntactic analysis ä¹‹å‰ï¼Œæˆ–è€…å®ƒå¯ä»¥è¢«åˆå¹¶ä¸º syntax analysis æˆ– a later translation stepã€‚\nä½¿ç”¨æœ€å¹¿æ³›çš„ macro systems ä¹‹ä¸€æ˜¯ C é¢„å¤„ç†å™¨ï¼ˆCPPï¼‰ï¼Œå®ƒä½œä¸ºå¤„ç†ç¨‹åºçš„ç¬¬ä¸€æ­¥è¢«åŒ…å«åœ¨ C å’Œ C++ ä¸­ã€‚é¢„å¤„ç†å™¨æŒ‡ä»¤ä»¥æ•£åˆ—ç¬¦å·å¼€å¤´ï¼ŒåŒ…æ‹¬ #includeã€#defineã€#if ç­‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªç±»ä¼¼å‡½æ•°çš„ macro æ¥äº¤æ¢ä¸¤ä¸ªé¡¹ç›®ï¼š\n1 #define SWAP(a, b) { auto tmp = b; b = a; a = tmp; } ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨å®ï¼š\n1 2 3 4 5 6 7 8 9 int main() { int x = 3; int y = 4; SWAP(x, y); cout \u0026lt;\u0026lt; x \u0026lt;\u0026lt; \u0026#34; \u0026#34; \u0026lt;\u0026lt; y \u0026lt;\u0026lt; endl; } // output 4 3 é€šè¿‡å‘ g++ ä¼ é€’ -E æ ‡å¿—ï¼Œå¯ä»¥è·å¾—å®æ‰©å±•çš„ç»“æœï¼š",
  "keywords": [
    "metaprogramming", "language"
  ],
  "articleBody": "å…ƒç¼–ç¨‹æ˜¯ç¼–å†™å¯åœ¨å…¶ä»–ç¨‹åºä¸Šè¿è¡Œçš„è®¡ç®—æœºç¨‹åºçš„æŠ€æœ¯ã€‚è¯¸å¦‚ç¼–è¯‘å™¨å’Œç¨‹åºåˆ†æå™¨ä¹‹ç±»çš„ç³»ç»Ÿå¯ä»¥è¢«è§†ä¸ºå…ƒç¨‹åºï¼Œå› ä¸ºå®ƒä»¬å°†å…¶ä»–ç¨‹åºä½œä¸ºè¾“å…¥ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºçš„å…ƒç¼–ç¨‹å½¢å¼ç‰¹åˆ«å…³æ³¨ç”Ÿæˆè¦ä½œä¸ºç¨‹åºä¸€éƒ¨åˆ†åŒ…å«çš„ä»£ç ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¤ä¸ºæ˜¯åˆçº§ç¼–è¯‘å™¨ã€‚\nMacros and Code Generation macro æ˜¯å°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºæŸç§æ›¿æ¢è¾“å‡ºåºåˆ—çš„è§„åˆ™ã€‚è¿™ä¸ªç¿»è¯‘è¿‡ç¨‹ç§°ä¸º macro expansionï¼Œä¸€äº›è¯­è¨€æä¾›å®ä½œä¸ºå…¶è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å®è®¾æ–½å¯ä»¥è¢«å®ç°ä¸º preprocessing stepï¼Œå…¶ä¸­å®æ‰©å±•å‘ç”Ÿåœ¨ lexical and syntactic analysis ä¹‹å‰ï¼Œæˆ–è€…å®ƒå¯ä»¥è¢«åˆå¹¶ä¸º syntax analysis æˆ– a later translation stepã€‚\nä½¿ç”¨æœ€å¹¿æ³›çš„ macro systems ä¹‹ä¸€æ˜¯ C é¢„å¤„ç†å™¨ï¼ˆCPPï¼‰ï¼Œå®ƒä½œä¸ºå¤„ç†ç¨‹åºçš„ç¬¬ä¸€æ­¥è¢«åŒ…å«åœ¨ C å’Œ C++ ä¸­ã€‚é¢„å¤„ç†å™¨æŒ‡ä»¤ä»¥æ•£åˆ—ç¬¦å·å¼€å¤´ï¼ŒåŒ…æ‹¬ #includeã€#defineã€#if ç­‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªç±»ä¼¼å‡½æ•°çš„ macro æ¥äº¤æ¢ä¸¤ä¸ªé¡¹ç›®ï¼š\n1 #define SWAP(a, b) { auto tmp = b; b = a; a = tmp; } ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨å®ï¼š\n1 2 3 4 5 6 7 8 9 int main() { int x = 3; int y = 4; SWAP(x, y); cout \u003c\u003c x \u003c\u003c \" \" \u003c\u003c y \u003c\u003c endl; } // output 4 3 é€šè¿‡å‘ g++ ä¼ é€’ -E æ ‡å¿—ï¼Œå¯ä»¥è·å¾—å®æ‰©å±•çš„ç»“æœï¼š\n1 $ g++ -E ä¸è¿‡ï¼Œå¦‚æœä½¿ç”¨ #includes æŒ‡ä»¤ï¼Œç»“æœå¯èƒ½ä¼šéå¸¸æ··ä¹±ï¼Œå› ä¸ºè¯¥æŒ‡ä»¤ä¼šä»ç»™å®šæ–‡ä»¶ä¸­è°ƒå…¥ä»£ç ã€‚\nCPP macros perform text æ›¿æ¢ï¼Œå› æ­¤ä¸Šè¿°ä»£ç ç­‰åŒäºï¼š\n1 2 3 4 5 6 int main() { int x = 3; int y = 4; { auto tmp = y; y = x; x = tmp; }; cout \u003c\u003c x \u003c\u003c \" \" \u003c\u003c y \u003c\u003c endl; } ä½¿ç”¨ SWAP å®åçš„åˆ†å·ä»ç„¶ä¿ç•™ï¼Œè¡¨ç¤ºç©ºè¯­å¥ã€‚ä¸è¿‡ï¼Œåœ¨éœ€è¦ä½¿ç”¨å•ä¸€è¯­å¥çš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ä¸€ä¸ªæ²¡æœ‰è¢« block æ‹¬ä½çš„æ¡ä»¶åˆ†æ”¯ï¼Œè¿™å°±ä¼šé€ æˆé—®é¢˜ï¼š\n1 2 3 4 if (x \u003c y) SWAP(x, y); else cout \u003c\u003c \"no swap\" \u003c\u003c endl; é¿å…è¿™ä¸€é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•æ˜¯å°† macro çš„æ‰©å±•ä»£ç æ”¾åœ¨ do/while ä¸­ï¼š\n1 2 3 4 5 #define SWAP(a, b) do { \\ auto tmp = b; \\ b = a; \\ a = tmp; \\ } while (false) åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨ä¸€è¡Œçš„æœ«å°¾æ·»åŠ äº†ä¸€ä¸ª \\ï¼Œè¡¨ç¤ºä¸‹ä¸€è¡Œåº”è¢«è§†ä¸ºä¸Šä¸€è¡Œçš„ç»§ç»­ã€‚do/while å¾ªç¯åœ¨è¯­æ³•ä¸Šä»¥åˆ†å·ç»“æŸï¼Œå› æ­¤ SWAP(x, y); ä¸­çš„åˆ†å·åœ¨è¯­æ³•ä¸Šæ˜¯ do/while å¾ªç¯çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæ‰©å±•ä»£ç çš„è¯­æ³•æ˜¯æ­£ç¡®çš„ï¼š\n1 2 3 4 if (x \u003c y) do { auto tmp = b; b = a; a = tmp; } while (false); else cout \u003c\u003c \"no swap\" \u003c\u003c endl; è™½ç„¶ textual replacement å¾ˆæœ‰ç”¨ï¼Œä½†å®ƒä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå› ä¸ºè™½ç„¶å®åœ¨è¯­æ³•ä¸Šç±»ä¼¼å‡½æ•°ï¼Œä½†å®ƒä»¬çš„è¡Œä¸ºå´ä¸åƒå‡½æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä»¬ä¸æŠŠå‚æ•°ä½œä¸ºè‡ªå·±çš„å®ä½“ï¼Œä¹Ÿä¸å¼•å…¥ç‹¬ç«‹çš„ä½œç”¨åŸŸã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 int main() { int x = 3; int y = 4; int z = 5; SWAP(x \u003c y ? x : y, z); cout \u003c\u003c x \u003c\u003c \" \" \u003c\u003c y \u003c\u003c \" \" \u003c\u003c z \u003c\u003c endl; } // output 3 4 3 ä½¿ç”¨ g++ -Eï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¢„å¤„ç†åçš„ä»£ç ã€‚åªçœ‹ main() çš„è¾“å‡ºï¼Œæˆ‘ä»¬ä¼šå‘ç°\n1 2 3 4 5 6 7 8 9 10 11 int main() { int x = 3; int y = 4; int z = 5; do { auto tmp = z; z = x \u003c y ? x : y; x \u003c y ? x : y = tmp; } while (false); cout \u003c\u003c x \u003c\u003c \" \" \u003c\u003c y \u003c\u003c \" \" \u003c\u003c z \u003c\u003c endl; } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ äº†æ¢è¡Œç¬¦å’Œç©ºæ ¼ï¼Œä»¥ä½¿è¾“å‡ºæ›´æ˜“è¯»ï¼›è€Œé¢„å¤„ç†å™¨æœ¬èº«ä¼šå°†å®è¾“å‡ºæ”¾åœ¨ä¸€è¡Œä¸­ã€‚ç½ªé­ç¥¸é¦–æ˜¯æœ€åç”Ÿæˆçš„è¯­å¥ï¼š\n1 x \u003c y ? x : y = tmp; åœ¨ C++ ä¸­ï¼Œæ¡ä»¶è¿ç®—ç¬¦ ? : å’Œèµ‹å€¼è¿ç®—ç¬¦ = å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”ä»å³å‘å·¦å…³è”ï¼Œå› æ­¤è¿™ç­‰åŒäº\n1 x \u003c y ? x : (y = tmp); ç”±äº x \u003c yï¼Œè¿™é‡Œæ²¡æœ‰èµ‹å€¼ã€‚å› æ­¤ï¼Œx çš„å€¼ä¿æŒä¸å˜ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡ä½¿ç”¨ macro argument æ—¶åŠ ä¸Šæ‹¬å·æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\n1 2 3 4 5 #define SWAP(a, b) do { \\ auto tmp = (b); \\ (b) = (a); \\ (a) = tmp; \\ } while (false) Ranking the Operator Precedence in C++ ç°åœ¨ä¼šäº§ç”Ÿé¢„æœŸçš„ç»“æœï¼Œå› ä¸ºæ‹¬å·æ˜ç¡®åœ°å°†è¿™äº›æ“ä½œè”ç³»èµ·æ¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 int main() { int x = 3; int y = 4; int z = 5; do { auto tmp = (z); (z) = (x \u003c y ? x : y); (x \u003c y ? x : y) = tmp; } while (false); cout \u003c\u003c x \u003c\u003c \" \" \u003c\u003c y \u003c\u003c \" \" \u003c\u003c z \u003c\u003c endl; } ç„¶è€Œï¼Œç¬¬äºŒä¸ªé—®é¢˜å¹¶ä¸é‚£ä¹ˆå®¹æ˜“è§£å†³ã€‚è€ƒè™‘ä¸€ä¸‹å½“æˆ‘ä»¬å°† SWAP å®åº”ç”¨äºåä¸º tmp çš„å˜é‡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š\n1 2 3 4 5 6 7 8 9 int main() { int x = 3; int tmp = 4; SWAP(tmp, x); cout \u003c\u003c x \u003c\u003c \" \" \u003c\u003c tmp \u003c\u003c endl; } // output 3 4 æ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼å†æ¬¡ä½¿ç”¨ g++ -E æ£€æŸ¥è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ˆæ¨¡æ•°é—´éš”ï¼‰\n1 2 3 4 5 6 7 8 9 10 int main() { int x = 3; int tmp = 4; do { auto tmp = (x); (x) = (tmp); (tmp) = tmp; } while (false); cout \u003c\u003c x \u003c\u003c \" \" \u003c\u003c tmp \u003c\u003c endl; } ç”±äº SWAP ä½¿ç”¨çš„ä¸´æ—¶å˜é‡ä¸å‚æ•°åŒåï¼Œå› æ­¤ä¸´æ—¶å˜é‡ä¼šæ•è·ç”Ÿæˆä»£ç ä¸­å‡ºç°çš„å‚æ•°ã€‚è¿™æ˜¯å› ä¸ºå®åªæ˜¯æ‰§è¡Œæ–‡æœ¬æ›¿æ¢ï¼Œå¹¶ä¸èƒ½ç¡®ä¿åç§°è¢«è§£æåˆ°é€‚å½“çš„ä½œç”¨åŸŸã€‚å› æ­¤ï¼Œå®å®é™…ä¸Šå¹¶ä¸ä½¿ç”¨æŒ‰åç§°è°ƒç”¨ï¼Œè€ŒæŒ‰åç§°è°ƒç”¨å¯ç¡®ä¿å‚æ•°ä¸­çš„åç§°è§£æåˆ°é€‚å½“çš„ä½œç”¨åŸŸã€‚å¯¹æ–‡æœ¬æ›¿æ¢çš„ä¾èµ–ä½¿ CPP æˆä¸ºä¸€ä¸ªä¸å«ç”Ÿçš„å®ç³»ç»Ÿã€‚å…¶ä»–ç³»ç»Ÿï¼ˆå¦‚ Scheme çš„ç³»ç»Ÿï¼‰æ˜¯å«ç”Ÿçš„ï¼Œå®ƒä»¬ä¸ºå®å¼•å…¥çš„åç§°åˆ›å»ºäº†å•ç‹¬çš„ä½œç”¨åŸŸï¼Œå¹¶ç¡®ä¿å‚æ•°ä¸ä¼šè¢«æ•è·ã€‚\nScheme Macros ä½œä¸º R5RS Scheme è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå®ç³»ç»Ÿæ˜¯å«ç”Ÿçš„ã€‚å®ç”± define-syntaxã€let-syntax æˆ– letrec-syntax ä¸­çš„ä¸€ç§å½¢å¼å¼•å…¥ï¼Œå¹¶å°†ç»™å®šçš„åç§°ä¸å®ç»‘å®šã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ let ä½œä¸ºå®çš„å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 (define-syntax let (syntax-rules () ((let ((name val) ...) body1 body2 ... ) ((lambda (name ...) body1 body2 ... ) val ... ) ) ) ) syntax-rules æŒ‡å®šäº†å®è½¬æ¢çš„è§„åˆ™ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è§„åˆ™æ¨¡å¼ä¸è¾“å…¥ä¹‹é—´å¿…é¡»åŒ¹é…çš„å­—é¢å½¢å¼åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œcond å½¢å¼ä¸­çš„ else æ ‡è¯†ç¬¦ã€‚ä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å­—é¢æ„ä¹‰ã€‚syntax-rules çš„å…¶ä½™å‚æ•°æŒ‡å®šäº†è½¬æ¢ã€‚è½¬æ¢çš„ç¬¬ä¸€é¡¹æ˜¯è¾“å…¥æ¨¡å¼ï¼Œç¬¬äºŒé¡¹æ˜¯è¾“å‡ºæ¨¡å¼ã€‚...çš„ä½œç”¨ç±»ä¼¼äºå…‹è±å› æ˜Ÿï¼Œå°†å‰ä¸€é¡¹ä¸è¾“å…¥ä¸­å‡ºç°çš„é›¶æ¬¡æˆ–å¤šæ¬¡ç›¸åŒ¹é…ã€‚è¾“å…¥æ¨¡å¼ä¸­å‡ºç°ä½†ä¸åœ¨å­—é¢é‡åˆ—è¡¨ä¸­çš„åç§°ï¼Œé™¤äº†ä½œä¸ºå®åç§°çš„ç¬¬ä¸€é¡¹ï¼Œéƒ½æ˜¯ä¸è¾“å…¥å…ƒç´ ç›¸åŒ¹é…çš„å«ç”Ÿå˜é‡ã€‚è¿™äº›å˜é‡å¯ä»¥åœ¨è¾“å‡ºæ¨¡å¼ä¸­å¼•ç”¨ï¼Œä»¥æŒ‡å®šå¦‚ä½•æ„é€ è¾“å‡ºã€‚\nåœ¨å…¨å±€ç¯å¢ƒä¸­è¯„ä¼°ä¸Šè¿°è¡¨è¾¾å¼æ—¶ï¼Œä¼šå°† let åç§°ä¸ä¸€ä¸ªè½¬æ¢ä¸º lambda çš„å®ç»‘å®šã€‚\nå®ä¸»ä½“å¼•å…¥çš„æ ‡è¯†ç¬¦ä¿è¯é¿å…ä¸å…¶ä»–æ ‡è¯†ç¬¦å†²çªï¼Œè§£é‡Šå™¨é€šå¸¸ä¼šé‡å‘½åæ ‡è¯†ç¬¦ä»¥é¿å…å†²çªã€‚ä¸‹é¢æ˜¯ swap å®çš„å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 (define-syntax swap (syntax-rules () ((swap a b) (let ((tmp b)) (set! b a) (set! a tmp) ) ) ) ) è¿™å°±å°† swap çš„ä½¿ç”¨è½¬åŒ–ä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé€šè¿‡ä¸´æ—¶å˜é‡ tmp äº¤æ¢ä¸¤ä¸ªå‚æ•°ã€‚å› æ­¤\n1 2 3 4 5 6 7 \u003e (define x 3) \u003e (define y 4) \u003e (swap x y) \u003e x 4 \u003e y 3 ä¸è¿‡ï¼Œä¸ CPP å®ä¸åŒçš„æ˜¯ï¼Œswap å®å¼•å…¥çš„ tmp ä¸å…¶ä»–ä»»ä½• tmp éƒ½æ˜¯ä¸åŒçš„ï¼š\n1 2 3 4 5 6 \u003e (define tmp 5) \u003e (swap x tmp) \u003e x 5 \u003e tmp 4 å› ä¸ºå®åœ¨ Scheme ä¸­æ˜¯å«ç”Ÿçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå¾—åˆ°é¢„æœŸçš„è¡Œä¸ºã€‚\nä¸ºäº†æ”¯æŒå®ï¼ŒScheme è§£é‡Šå™¨çš„è¯„ä¼°è¿‡ç¨‹ä¼šåƒå¾€å¸¸ä¸€æ ·è¯„ä¼°åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ã€‚å¦‚æœè¯„ä¼°ç»“æœæ˜¯ä¸€ä¸ªå®ï¼Œé‚£ä¹ˆè§£é‡Šå™¨å°†å¯¹åˆ—è¡¨çš„å…¶ä½™éƒ¨åˆ†æ‰§è¡Œå®æ‰©å±•ï¼Œè€Œä¸ä¼šé¦–å…ˆè¯„ä¼°å‚æ•°ã€‚æ‰©å±•å¼•å…¥çš„ä»»ä½•åç§°éƒ½ä¸å…¶ä»–åç§°ç½®äºä¸åŒçš„ä½œç”¨åŸŸã€‚æ‰©å±•åï¼Œè§£é‡Šå™¨ä¼šå¯¹æ‰©å±•ç»“æœé‡å¤æ±‚å€¼è¿‡ç¨‹ï¼Œå› æ­¤ï¼Œå¦‚æœæœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ª let è¡¨è¾¾å¼ (å¦‚ä¸Šæ–‡ swap ä¸­çš„è¡¨è¾¾å¼)ï¼Œå°±ä¼šå¯¹è¯¥è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ã€‚\nä¸€ä¸ªå®å®šä¹‰å¯ä»¥æŒ‡å®šå¤šä¸ªæ¨¡å¼è§„åˆ™ã€‚å†åŠ ä¸Šæ‰©å±•çš„ç»“æœä¼šè¢«æ±‚å€¼ï¼Œè¿™ä½¿å¾—å®å®šä¹‰å¯ä»¥é€’å½’ï¼Œå¦‚ä¸‹é¢çš„ let* å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 (define-syntax let* (syntax-rules () ((let* () body1 body2 ... ) (let () body1 body2 ... ) ) ((let* ((name1 val1) (name2 val2) ...) body1 body2 ... ) (let ((name1 val1)) (let* ((name2 val2) ...) body1 body2 ... ) ) ) ) ) å½“ let* æ²¡æœ‰ç»‘å®šæ—¶ï¼Œæœ‰ä¸€ç§åŸºæœ¬æ¨¡å¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒç›´æ¥è½¬åŒ–ä¸ºä¸€ä¸ª letã€‚å½“è‡³å°‘æœ‰ä¸€ä¸ªç»‘å®šæ—¶ï¼Œä¹Ÿæœ‰ä¸€ä¸ªé€’å½’æ¨¡å¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œlet* ä¼šè½¬åŒ–ä¸ºä¸€ä¸ªåµŒå¥—åœ¨ let ä¸­çš„æ›´ç®€å•çš„ let*ã€‚å®å®šä¹‰ä¸­çš„çœç•¥å· (...) ç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ Kleene æ˜Ÿå· (*)ï¼Œè¡¨ç¤ºå‰ä¸€é¡¹å¯ä»¥åŒ¹é…é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚å› æ­¤ï¼Œå…·æœ‰å•ä¸€ç»‘å®šçš„ let* ä¸ä¸Šè¿°ç¬¬äºŒæ¡æ¨¡å¼è§„åˆ™ç›¸åŒ¹é…ï¼Œå…¶ä¸­ (name2 val2) åŒ¹é…æ¬¡æ•°ä¸ºé›¶ã€‚\nCPP Macros æˆ‘ä»¬å†æ¥çœ‹çœ‹ CPP å®ã€‚å°½ç®¡å®ä¸å«ç”Ÿï¼Œä½†åœ¨æ¶‰åŠå…ƒç¼–ç¨‹çš„ä»»åŠ¡ä¸­å´éå¸¸æœ‰ç”¨ã€‚\nCPP å…è®¸æˆ‘ä»¬ä½¿ç”¨ #define æ¥å®šä¹‰ä¸¤ç§ç±»å‹çš„ macroï¼Œå³ object-like macro å’Œ function-like macroã€‚object-like macro æ˜¯ä¸€ç§ç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼Œç”¨ä¸€ä¸ªæ–‡æœ¬åºåˆ—æ›¿æ¢å¦ä¸€ä¸ªæ–‡æœ¬åºåˆ—ã€‚åœ¨å†å²ä¸Šï¼Œå®šä¹‰å¸¸é‡æ˜¯ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•ï¼š\n1 2 3 4 5 6 #define PI 3.1415926535 int main() { cout \u003c\u003c \"pi = \" \u003c\u003c PI \u003c\u003c endl; cout \u003c\u003c \"tau = \" \u003c\u003c PI * 2 \u003c\u003c endl; } åœ¨ C++ ä¸­ï¼Œæ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨ const æˆ– constexpr å®šä¹‰å¸¸é‡ã€‚\nfunction-like macro æ¥å—å‚æ•° (å¦‚ä¸Šæ–‡çš„ SWAP)ï¼Œå¹¶èƒ½å°†å‚æ•°æ–‡æœ¬æ›¿æ¢åˆ°æ›¿æ¢æ–‡æœ¬ä¸­çš„ç‰¹å®šä½ç½®ã€‚\nä½¿ç”¨ function-like macro çš„ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­æ˜¯å¯¹éµå¾ªç›¸åŒæ¨¡å¼çš„å¤šæ®µä»£ç è¿›è¡ŒæŠ½è±¡å®šä¹‰ã€‚è¯·çœ‹è¡¨ç¤ºå¤æ•°çš„ç±»å‹å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 struct Complex { double real; double imag; }; ostream \u0026operator\u003c\u003c(ostream \u0026os, Complex c) { return os \u003c\u003c \"(\" \u003c\u003c c.real \u003c\u003c \"+\" \u003c\u003c c.imag \u003c\u003c \"i)\"; } å‡è®¾é™¤äº†ä¸Šè¿°é‡è½½çš„æµæ’å…¥æ“ä½œç¬¦ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›æ”¯æŒç®—æœ¯è¿ç®— +ã€- å’Œ *ã€‚è¿™äº›è¿ç®—çš„åŸºæœ¬å½¢å¼ç›¸åŒï¼š\n1 2 3 Complex operator \u003cop\u003e(Complex a, Complex b) { return Complex{ \u003cexpression for real\u003e, \u003cexpression for imag\u003e }; } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† uniform initialization syntax æ¥åˆå§‹åŒ–ä¸€ä¸ªå«æœ‰å…¶æˆå‘˜å€¼çš„ Complexã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª function-like macro æ¥æŠ½è±¡è¿™ä¸ªç»“æ„ï¼š\n1 2 3 4 #define COMPLEX_OP(op, real_part, imag_part) \\ Complex operator op(Complex a, Complex b) { \\ return Complex{ real_part, imag_part }; \\ } è¯¥ macro çš„å‚æ•°åŒ…æ‹¬è¿ç®—ç¬¦ã€è®¡ç®—å®éƒ¨çš„è¡¨è¾¾å¼å’Œè®¡ç®—è™šéƒ¨çš„è¡¨è¾¾å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å®æ¥å®šä¹‰è¿ç®—ï¼š\n1 2 3 4 COMPLEX_OP(+, a.real+b.real, a.imag+b.imag); COMPLEX_OP(-, a.real-b.real, a.imag-b.imag); COMPLEX_OP(*, a.real*b.real - a.imag*b.imag, a.imag*b.real + a.real*b.imag); ä¸æˆ‘ä»¬æœ€åˆçš„ SWAP å®ç°ä¸€æ ·ï¼Œå°¾éƒ¨çš„åˆ†å·æ˜¯å¤šä½™çš„ï¼Œä½†å´æé«˜äº†å¯è¯»æ€§ä»¥åŠä¸è¯­æ³•é«˜äº®ç¨‹åºçš„äº¤äº’æ€§ã€‚ä½¿ç”¨ g++ -E åœ¨é¢„å¤„ç†å™¨ä¸­è¿è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼ˆä¿®æ”¹é—´è·ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 Complex operator +(Complex a, Complex b) { return Complex{ a.real+b.real, a.imag+b.imag }; }; Complex operator -(Complex a, Complex b) { return Complex{ a.real-b.real, a.imag-b.imag }; }; Complex operator *(Complex a, Complex b) { return Complex{ a.real*b.real - a.imag*b.imag, a.imag*b.real + a.real*b.imag }; }; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ Complex å’Œ double ä¹‹é—´çš„è¿ç®—ã€‚æˆ‘ä»¬å†æ¬¡å‘ç°ï¼Œè¿™ç§æ“ä½œå…·æœ‰ç‰¹å®šçš„æ¨¡å¼ï¼š\n1 2 3 Complex operator \u003cop\u003e(\u003ctype1\u003e a, \u003ctype2\u003e b) { return \u003cexpr1\u003e \u003cop\u003e \u003cexpr2\u003e; } è¿™é‡Œï¼Œ æ˜¯è½¬æ¢ä¸º Complex è¡¨ç¤ºçš„ç›¸åº”å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®å¯¹å…¶è¿›è¡ŒæŠ½è±¡ï¼š\n1 2 3 4 #define REAL_OP(op, typeA, typeB, argA, argB) \\ Complex operator op(typeA a, typeB b) { \\ return argA op argB; \\ } æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªå®ï¼Œå°† double è½¬æ¢ä¸º Complexï¼š\n1 2 #define CONVERT(a) \\ (Complex{ a, 0 }) è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ“ä½œè¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼š\n1 2 3 4 5 6 REAL_OP(+, Complex, double, a, CONVERT(b)); REAL_OP(+, double, Complex, CONVERT(a), b); REAL_OP(-, Complex, double, a, CONVERT(b)); REAL_OP(-, double, Complex, CONVERT(a), b); REAL_OP(*, Complex, double, a, CONVERT(b)); REAL_OP(*, double, Complex, CONVERT(a), b); é€šè¿‡é¢„å¤„ç†å™¨è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°\n1 2 3 4 5 6 Complex operator +(Complex a, double b) { return a + (Complex{ b, 0 }); }; Complex operator +(double a, Complex b) { return (Complex{ a, 0 }) + b; }; Complex operator -(Complex a, double b) { return a - (Complex{ b, 0 }); }; Complex operator -(double a, Complex b) { return (Complex{ a, 0 }) - b; }; Complex operator *(Complex a, double b) { return a * (Complex{ b, 0 }); }; Complex operator *(double a, Complex b) { return (Complex{ a, 0 }) * b; }; ç°åœ¨æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨å¤æ•°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 int main() { Complex c1{ 3, 4 }; Complex c2{ -1, 2 }; double d = 0.5; cout \u003c\u003c c1 + c2 \u003c\u003c endl; cout \u003c\u003c c1 - c2 \u003c\u003c endl; cout \u003c\u003c c1 * c2 \u003c\u003c endl; cout \u003c\u003c c1 + d \u003c\u003c endl; cout \u003c\u003c c1 - d \u003c\u003c endl; cout \u003c\u003c c1 * d \u003c\u003c endl; cout \u003c\u003c d + c1 \u003c\u003c endl; cout \u003c\u003c d - c1 \u003c\u003c endl; cout \u003c\u003c d * c1 \u003c\u003c endl; } 1 2 3 4 5 6 7 8 9 (2+6i) (4+2i) (-11+2i) (3.5+4i) (2.5+4i) (1.5+2i) (3.5+4i) (-2.5+-4i) (1.5+2i) Stringification and Concatenation åœ¨ä½¿ç”¨å®æ—¶ï¼Œå°†å®å‚æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–å°†å…¶ä¸å…¶ä»–æ ‡è®°è¿æ¥èµ·æ¥å¯èƒ½å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªäº¤äº’å¼åº”ç”¨ç¨‹åºï¼Œè¯»å–ç”¨æˆ·çš„è¾“å…¥å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å¯¹äºå¤æ•°ï¼Œç›®æ ‡å‡½æ•°å¯èƒ½å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 Complex Complex_conjugate(Complex c) { return Complex{ c.real, -c.imag }; } string Complex_polar(Complex c) { return \"(\" + to_string(sqrt(pow(c.real, 2) + pow(c.imag, 2))) + \",\" + to_string(atan(c.imag / c.real)) + \")\"; } åº”ç”¨ç¨‹åºä¼šå°†ç”¨æˆ·è¾“å…¥ä¸ä»£è¡¨æ“ä½œçš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œè°ƒç”¨ç›¸åº”çš„å‡½æ•°ï¼Œå¹¶æ‰“å°å‡ºç»“æœã€‚è¿™å°±æ˜¯å¸¸è§çš„æ¨¡å¼ï¼š\n1 2 if (\u003cinput\u003e == \"\") cout \u003c\u003c Complex_\u003caction\u003e(\u003cvalue\u003e) \u003c\u003c endl; åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ—¢éœ€è¦åŠ¨ä½œçš„å­—ç¬¦ä¸²è¡¨ç¤ºæ³•ï¼Œä¹Ÿéœ€è¦å°† Complex_ æ ‡è®°ä¸åŠ¨ä½œæ ‡è®°æœ¬èº«è¿æ¥èµ·æ¥çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºè¿™ç§æ¨¡å¼å®šä¹‰å¦‚ä¸‹å®ï¼š\n1 2 3 #define ACTION(str, name, arg) \\ if (str == #name) \\ cout \u003c\u003c Complex_ ## name(arg) \u003c\u003c endl æ ‡è®°å‰çš„ ## æ˜¯å­—ç¬¦ä¸²åŒ–è¿ç®—ç¬¦ï¼Œå°†æ ‡è®°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚Complex_ å’Œ name ä¹‹é—´çš„ ## æ˜¯æ ‡è®°ç²˜è´´æ“ä½œç¬¦ï¼Œç”¨äºè¿æ¥ä¸¤è¾¹çš„æ ‡è®°ã€‚\nè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™å¦‚ä¸‹åº”ç”¨ä»£ç ï¼š\n1 2 3 4 5 6 Complex c1 { 3, 4 }; string s; while (cin \u003e\u003e s) { ACTION(s, conjugate, c1); ACTION(s, polar, c1); } é€šè¿‡é¢„å¤„ç†å™¨è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°æƒ³è¦çš„ç»“æœï¼š\n1 2 3 4 5 6 Complex c1 { 3, 4 }; string s; while (cin \u003e\u003e s) { if (s == \"conjugate\") cout \u003c\u003c Complex_conjugate(c1) \u003c\u003c endl; if (s == \"polar\") cout \u003c\u003c Complex_polar(c1) \u003c\u003c endl; } The Macro Namespace ä½¿ç”¨ CPP å®çš„ä¸€ä¸ªç¼ºé™·æ˜¯ï¼Œå®ƒä»¬ä¸åŒ…å«åœ¨ä»»ä½•ç‰¹å®šçš„å‘½åç©ºé—´ä¸­ã€‚äº‹å®ä¸Šï¼Œåªè¦å®šä¹‰äº†å®ï¼Œå®ƒå°±èƒ½æ›¿æ¢ä»»ä½•ç¬¦åˆæ¡ä»¶çš„æ ‡è¯†ç¬¦ï¼Œæ— è®ºè¯¥æ ‡è¯†ç¬¦ä½äºä½•å¤„ã€‚å› æ­¤ï¼Œå®šä¹‰ä¸€ä¸ªå®å°±ç›¸å½“äºè®©ä¸€ä¸ªç‰¹å®šçš„æ ‡è¯†ç¬¦å……å½“ä¿ç•™å…³é”®å­—ï¼Œç¨‹åºå‘˜æ— æ³•ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¸¸é‡é€šå¸¸æœ€å¥½å®šä¹‰ä¸ºå˜é‡ï¼Œé™å®šä¸º const æˆ– constexprï¼Œè€Œä¸æ˜¯ç±»ä¼¼å¯¹è±¡çš„å®çš„åŸå› ä¹‹ä¸€ã€‚\nä¸ºé¿å…æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ï¼Œä½¿ç”¨äº†å‡ ç§çº¦å®šã€‚\nç¬¬ä¸€ç§æ˜¯åœ¨æ‰€æœ‰å®çš„å‰ç¼€åŠ ä¸Šå®šä¹‰å®çš„åº“æ‰€ç‰¹æœ‰çš„å­—ç¬¦ï¼Œä»¥é¿å…ä¸å…¶ä»–åº“å‘ç”Ÿå†²çªã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„å¤æ•°å®å¯ä»¥ç”¨ COMPLEX_ ä½œä¸ºå‰ç¼€ï¼Œä»¥é¿å…ä¸å…¶ä»–å®æˆ–æ ‡è¯†ç¬¦å†²çªã€‚ ç¬¬äºŒç§ç­–ç•¥æ˜¯åœ¨ä¸å†éœ€è¦å®æ—¶ï¼Œä½¿ç”¨ #undef é¢„å¤„ç†å™¨æŒ‡ä»¤å–æ¶ˆå¯¹å®çš„å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œåœ¨åº“ä»£ç çš„æœ«å°¾ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰å¦‚ä¸‹ä»£ç ï¼š 1 2 3 4 #undef COMPLEX_OP #undef REAL_OP #undef CONVERT #undef ACTION è¿™æ ·ï¼Œæ ‡è¯†ç¬¦å°±å¯ä»¥åœ¨ä»¥åçš„ä»£ç ä¸­ç”¨äºå…¶ä»–ç›®çš„ã€‚\nCode Generation è™½ç„¶ macros å…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸€ç§è¯­è¨€æä¾›çš„å®è®¾æ–½ç”Ÿæˆä»£ç ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§è®¾æ–½æ— æ³•ä½¿ç”¨æˆ–ä¸è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„ç›®çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨å¤–éƒ¨ç¨‹åºä¸­ç”¨åŒä¸€ç§è¯­è¨€æˆ–å¦ä¸€ç§è¯­è¨€ç¼–å†™ä»£ç ç”Ÿæˆå™¨å¯èƒ½ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚è¿™ç§æŠ€æœ¯ä¹Ÿç§°ä¸º automatic programmingã€‚\nä¾‹å¦‚ï¼ŒR5RS Scheme è§„èŒƒè¦æ±‚å®ç°æä¾› car å’Œ cdr çš„ç»„åˆï¼Œæœ€æ·±å¯è¾¾å››å±‚ã€‚ä¾‹å¦‚ï¼Œ(caar x) åº”ç­‰åŒäº (car (car x))ï¼Œ(caddar x) åº”ç­‰åŒäº (car (cdr (cdr (car x))))ã€‚é™¤äº† car å’Œ cdr æœ¬èº«å¤–ï¼Œè¿˜éœ€è¦æä¾› 28 ç§ç»„åˆï¼Œæ‰‹å·¥ç¼–å†™æ—¢ç¹çåˆå®¹æ˜“å‡ºé”™ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸‹é¢çš„ Python è„šæœ¬æ¥ç”Ÿæˆä¸€ä¸ª Scheme åº“æ–‡ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 import itertools def cadrify(seq): if len(seq): return '(c{0}r {1})'.format(seq[0], cadrify(seq[1:])) return 'x' def defun(seq): return '(define (c{0}r x) {1})'.format(''.join(seq), cadrify(seq)) for i in range(2, 5): for seq in itertools.product(('a', 'd'), repeat=i): print(defun(seq)) cadrify() å‡½æ•°æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªåºåˆ—ï¼Œå¦‚ ('a','d','a')ï¼Œå¹¶ä½¿ç”¨ç¬¬ä¸€ä¸ªé¡¹ç›®å’Œåºåˆ—å…¶ä½™éƒ¨åˆ†çš„é€’å½’ç»“æœæ„é€ ä¸€ä¸ªè°ƒç”¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œåè€…æ˜¯ (cdr (car x))ï¼Œå› æ­¤ç»“æœæ˜¯ (car (cdr (car x)))ã€‚åŸºæœ¬æƒ…å†µæ˜¯åºåˆ—ä¸ºç©ºï¼Œåªäº§ç”Ÿ xã€‚\ndefun() å‡½æ•°æ¥æ”¶ä¸€ä¸ªåºåˆ—ï¼Œå¹¶ç”¨å®ƒä¸ºç›¸åº”çš„ç»„åˆæ„å»ºå®šä¹‰ã€‚å®ƒè°ƒç”¨ cadrify() æ„å»ºæ­£æ–‡ã€‚å¯¹äºåºåˆ— ('a','d','a')ï¼Œç»“æœæ˜¯\n1 (define (cadar x) (car (cdr (car x)))) æœ€åï¼Œå¾ªç¯ç»“æŸæ—¶ä¼šäº§ç”Ÿæ¯ä¸ªé•¿åº¦çš„ a å’Œ d çš„æ‰€æœ‰ç»„åˆã€‚å®ƒä½¿ç”¨å‡½æ•°åº“ä¸­çš„ itertools.product() å‡½æ•°æ¥è·å¾—ä¸€ä¸ªåºåˆ—ï¼Œè¯¥åºåˆ—æ˜¯å…ƒç»„ ('a','d') çš„ç¬¬ i æ¬¡å¹‚ã€‚å¯¹äºæ¯ä¸ªç»„åˆï¼Œå®ƒéƒ½ä¼šè°ƒç”¨ defun() ç”Ÿæˆè¯¥ç»„åˆçš„å‡½æ•°ã€‚\n1 2 3 4 5 6 7 8 9 (define (caar x) (car (car x))) (define (cadr x) (car (cdr x))) (define (cdar x) (cdr (car x))) (define (cddr x) (cdr (cdr x))) (define (caaar x) (car (car (car x)))) (define (caadr x) (car (car (cdr x)))) ... (define (cdddar x) (cdr (cdr (cdr (car x))))) (define (cddddr x) (cdr (cdr (cdr (cdr x))))) æˆ‘ä»¬å¯ä»¥å°†ç”Ÿæˆçš„ä»£ç æ”¾å…¥æ ‡å‡†åº“ä¸­ï¼Œç”± Scheme è§£é‡Šå™¨åŠ è½½ã€‚\nTemplate Metaprogramming Template metaprogramming æ˜¯ä¸€ç§åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆæºä»£ç çš„æŠ€æœ¯ï¼Œç„¶åå°†æºä»£ç ä¸ç¨‹åºçš„å…¶ä»–ä»£ç ä¸€èµ·ç¼–è¯‘ã€‚å®ƒé€šå¸¸æ˜¯æŒ‡åˆ©ç”¨è¯­è¨€çš„æ¨¡æ¿å®ä¾‹åŒ–è§„åˆ™è¿›è¡Œç¼–è¯‘æ—¶æ‰§è¡Œçš„ä¸€ç§å½¢å¼ã€‚Template metaprogramming åœ¨ C++ ä¸­æœ€ä¸ºå¸¸è§ï¼Œä½†ä¹Ÿæœ‰å°‘æ•°å…¶ä»–è¯­è¨€å¯ä»¥ä½¿ç”¨ã€‚\nC++ ä¸­æ¨¡æ¿å…ƒç¼–ç¨‹çš„å…³é”®æ˜¯ template specializationï¼Œå®ƒå…è®¸ç¼–å†™ä¸“é—¨çš„å®šä¹‰æ¥å®ä¾‹åŒ–å¸¦æœ‰ç‰¹å®šå‚æ•°çš„æ¨¡æ¿ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªåŒ…å«é™æ€å€¼åŸŸçš„ç±»æ¨¡æ¿ï¼Œå¦‚æœæ¨¡æ¿å‚æ•°ä¸º intï¼Œè¯¥å€¼åŸŸä¸º trueï¼Œå¦åˆ™ä¸º falseã€‚æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ç¼–å†™é€šç”¨æ¨¡æ¿ï¼š\n1 2 3 4 template \u003cclass T\u003e struct is_int { static const bool value = false; }; ç°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰å½“å‚æ•°ä¸º int æ—¶è¯¥æ¨¡æ¿çš„ç‰¹æ®ŠåŒ–ï¼š\n1 2 3 4 template \u003c\u003e struct is_int\u003cint\u003e { static const bool value = true; }; ç‰¹åŒ–ä¸­çš„æ¨¡æ¿å‚æ•°åˆ—è¡¨åŒ…å«éç‰¹åŒ–å‚æ•°ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œæ‰€ä»¥æ˜¯ç©ºçš„ã€‚ç„¶åï¼Œåœ¨æ¨¡æ¿åç§°ä¹‹åï¼Œæˆ‘ä»¬æä¾›äº†å®ä¾‹åŒ–çš„å…¨éƒ¨å‚æ•°é›†ï¼Œåœ¨æœ¬ä¾‹ä¸­åªæœ‰ intã€‚ç„¶åï¼Œæˆ‘ä»¬æä¾›å®ä¾‹åŒ–çš„å…¶ä½™å®šä¹‰ã€‚\nç°åœ¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿æ—¶ï¼Œå¦‚æœæ¨¡æ¿å‚æ•°ä¸ç‰¹åŒ–å…¼å®¹ï¼Œç¼–è¯‘å™¨å°±ä¼šä½¿ç”¨ç‰¹åŒ–ï¼Œå¦åˆ™å°±ä¼šä½¿ç”¨é€šç”¨æ¨¡æ¿ï¼š\n1 2 3 4 5 cout \u003c\u003c is_int\u003cdouble\u003e::value \u003c\u003c endl; cout \u003c\u003c is_int\u003cint\u003e::value \u003c\u003c endl; // output 0 1 æ¨¡æ¿ç‰¹åŒ–ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™ä»¥æ¨¡æ¿å‚æ•°ä¸ºæ¡ä»¶çš„ä»£ç ã€‚ä¸é€’å½’å®ä¾‹åŒ–ç›¸ç»“åˆï¼Œè¿™ä½¿å¾—æ¨¡æ¿å®ä¾‹åŒ–å…·æœ‰å›¾çµå®Œå¤‡æ€§ã€‚æ¨¡æ¿ä¸å¯¹å¯å˜å˜é‡è¿›è¡Œç¼–ç ï¼Œå› æ­¤æ¨¡æ¿å…ƒç¼–ç¨‹å®é™…ä¸Šæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§å½¢å¼ã€‚\nPairs ä¸¾ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬å®šä¹‰å¯åœ¨ç¼–è¯‘æ—¶æ“ä½œçš„ pairs å’Œ listsã€‚è¿™äº›ç»“æ„ä¸­å­˜å‚¨çš„å…ƒç´ å°†æ˜¯ä»»æ„ç±»å‹ã€‚\nåœ¨å¼€å§‹å®šä¹‰ pairs ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªæŠ¥å‘Šæœºåˆ¶ï¼Œä»¥ä¾¿åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç»“æœã€‚æˆ‘ä»¬å°†åœ¨ç¼–è¯‘å™¨ç”Ÿæˆçš„é”™è¯¯ä¿¡æ¯ä¸­åŒ…å«ç›¸å…³ä¿¡æ¯ï¼š\n1 2 3 4 template \u003cclass A, int I\u003e struct report { static_assert(I \u003c 0, \"report\"); }; ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª integer æ¨¡æ¿å‚æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»å‹å¯¹æ•°å­—è¿›è¡Œç¼–ç ã€‚åœ¨å®ä¾‹åŒ– report æ¨¡æ¿æ—¶ï¼Œå¦‚æœæ¨¡æ¿å‚æ•° I ä¸ºéè´Ÿï¼Œstatic_assert ä¼šå¼•å‘é”™è¯¯ã€‚è¯·çœ‹ä¸‹é¢çš„å†…å®¹ï¼š\n1 report\u003cint, 5\u003e foo; ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ŒæŒ‡å‡ºæ˜¯å“ªä¸ªå®ä¾‹å¯¼è‡´ static_assert å¤±è´¥ã€‚åœ¨ Clang ä¸­ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„é”™è¯¯ï¼š\n1 2 3 4 5 6 pair.cpp:64:3: error: static_assert failed \"report\" static_assert(I \u003c 0, \"report\"); ^ ~~~~~ pair.cpp:67:16: note: in instantiation of template class 'report' requested here report foo; ä½¿ç”¨ GCCï¼Œé”™è¯¯å¦‚ä¸‹ï¼š\n1 2 3 4 5 pair.cpp: In instantiation of 'struct report': pair.cpp:67:16: required from here main.cpp:64:3: error: static assertion failed: report static_assert(I \u003c 0, \"report\"); ^ ä¸¤ä¸ªç¼–è¯‘å™¨éƒ½æŠ¥å‘Šäº†ç›¸å…³ä¿¡æ¯ï¼Œå³æŠ¥å‘Šæ¨¡æ¿çš„å‚æ•°æ˜¯ int å’Œ 5ã€‚\nè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ pair æ¨¡æ¿å¦‚ä¸‹ï¼š\n1 2 3 4 5 template \u003cclass First, class Second\u003e struct pair { using car = First; using cdr = Second; }; åœ¨ template ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ç±»å‹åˆ«å car å’Œ cdrï¼Œç”¨äºæŒ‡ä»£é…å¯¹çš„ç¬¬ä¸€é¡¹å’Œç¬¬äºŒé¡¹ã€‚å› æ­¤ï¼Œpair::car æ˜¯ int çš„åˆ«åï¼Œè€Œ pair::cdr æ˜¯ double çš„åˆ«åã€‚\næˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ç±»å‹åˆ«åï¼Œä»¥ä¾¿ä»æ•°æ®å¯¹ä¸­æå–ç¬¬ä¸€é¡¹å’Œç¬¬äºŒé¡¹ï¼š\n1 2 3 4 template \u003cclass Pair\u003e using car_t = typename Pair::car; template \u003cclass Pair\u003e using cdr_t = typename Pair::cdr; åœ¨ Pair::car å’Œ Pair::cdr ä¹‹å‰éœ€è¦ä½¿ç”¨ typename å…³é”®å­—ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åµŒå¥—ç±»å‹ï¼Œå…¶å¤–å±‚ç±»å‹ä¾èµ–äºæ¨¡æ¿å‚æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒC++ æ— æ³•ç¡®å®šæˆ‘ä»¬å‘½åçš„æ˜¯ä¸€ä¸ªç±»å‹è€Œä¸æ˜¯ä¸€ä¸ªå€¼ï¼Œå› æ­¤ typename å…³é”®å­—æ˜ç¡®è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç±»å‹ã€‚ä½¿ç”¨ä¸Šè¿°åˆ«åï¼Œcar_t",
  "wordCount" : "2392",
  "inLanguage": "zh",
  "datePublished": "2023-10-16T15:29:44+08:00",
  "dateModified": "2023-10-16T15:29:44+08:00",
  "author":{
    "@type": "Person",
    "name": "WFUing"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://WFUing.github.io/post/tech/language/metaprogramming/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Waiting For You",
    "logo": {
      "@type": "ImageObject",
      "url": "https://WFUing.github.io/img/logo.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://WFUing.github.io/" accesskey="h" title="Waiting For You (Alt + H)">Waiting For You</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://WFUing.github.io/search" title="ğŸ” (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/" title="HOME">
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/post" title="BLOGS">
                    <span>BLOGS</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/archives" title="ARCHIVE">
                    <span>ARCHIVE</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/tags" title="TAGS">
                    <span>TAGS</span>
                </a>
            </li>
            <li>
                <a href="https://WFUing.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://WFUing.github.io/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://WFUing.github.io/post/">Posts</a>&nbsp;Â»&nbsp;<a href="https://WFUing.github.io/post/tech/">Technology</a>&nbsp;Â»&nbsp;<a href="https://WFUing.github.io/post/tech/language/">Language</a></div>
    <h1 class="post-title">
      meta-programming
    </h1>
    <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-10-16
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>2392å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>12åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>WFUing
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://WFUing.github.io/tags/metaprogramming/" style="color: var(--secondary)!important;">metaprogramming</a>
                &nbsp;<a href="https://WFUing.github.io/tags/language/" style="color: var(--secondary)!important;">language</a>
            </span>
        </span>
    </span>
</span>
        &nbsp;|&nbsp;æ ‡ç­¾: &nbsp;
        <ul class="post-tags-meta">
            <a href="https://WFUing.github.io/tags/metaprogramming/">metaprogramming</a>
            <a href="https://WFUing.github.io/tags/language/">ã€language</a>
        </ul>

        
        
        
        
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_page_pv">
            &nbsp;| è®¿é—®: <span id="busuanzi_value_page_pv"></span>
        </span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#macros-and-code-generation" aria-label="Macros and Code Generation">Macros and Code Generation</a><ul>
                            
                    <li>
                        <a href="#scheme-macros" aria-label="Scheme Macros">Scheme Macros</a></li>
                    <li>
                        <a href="#cpp-macros" aria-label="CPP Macros">CPP Macros</a><ul>
                            
                    <li>
                        <a href="#stringification-and-concatenation" aria-label="Stringification and Concatenation">Stringification and Concatenation</a></li>
                    <li>
                        <a href="#the-macro-namespace" aria-label="The Macro Namespace">The Macro Namespace</a></li></ul>
                    </li>
                    <li>
                        <a href="#code-generation" aria-label="Code Generation">Code Generation</a></li></ul>
                    </li>
                    <li>
                        <a href="#template-metaprogramming" aria-label="Template Metaprogramming">Template Metaprogramming</a><ul>
                            <ul>
                            
                    <li>
                        <a href="#pairs" aria-label="Pairs">Pairs</a></li></ul>
                        </ul>
                    </li>
                    <li>
                        <a href="#resources" aria-label="RESOURCES">RESOURCES</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><p>å…ƒç¼–ç¨‹æ˜¯ç¼–å†™å¯åœ¨å…¶ä»–ç¨‹åºä¸Šè¿è¡Œçš„è®¡ç®—æœºç¨‹åºçš„æŠ€æœ¯ã€‚è¯¸å¦‚ç¼–è¯‘å™¨å’Œç¨‹åºåˆ†æå™¨ä¹‹ç±»çš„ç³»ç»Ÿå¯ä»¥è¢«è§†ä¸ºå…ƒç¨‹åºï¼Œå› ä¸ºå®ƒä»¬å°†å…¶ä»–ç¨‹åºä½œä¸ºè¾“å…¥ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºçš„å…ƒç¼–ç¨‹å½¢å¼ç‰¹åˆ«å…³æ³¨ç”Ÿæˆè¦ä½œä¸ºç¨‹åºä¸€éƒ¨åˆ†åŒ…å«çš„ä»£ç ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¤ä¸ºæ˜¯åˆçº§ç¼–è¯‘å™¨ã€‚</p>
<h2 id="macros-and-code-generation">Macros and Code Generation<a hidden class="anchor" aria-hidden="true" href="#macros-and-code-generation">#</a></h2>
<p>macro æ˜¯å°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºæŸç§æ›¿æ¢è¾“å‡ºåºåˆ—çš„è§„åˆ™ã€‚è¿™ä¸ªç¿»è¯‘è¿‡ç¨‹ç§°ä¸º macro expansionï¼Œä¸€äº›è¯­è¨€æä¾›å®ä½œä¸ºå…¶è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å®è®¾æ–½å¯ä»¥è¢«å®ç°ä¸º preprocessing stepï¼Œå…¶ä¸­å®æ‰©å±•å‘ç”Ÿåœ¨ lexical and syntactic analysis ä¹‹å‰ï¼Œæˆ–è€…å®ƒå¯ä»¥è¢«åˆå¹¶ä¸º syntax analysis æˆ– a later translation stepã€‚</p>
<p>ä½¿ç”¨æœ€å¹¿æ³›çš„ macro systems ä¹‹ä¸€æ˜¯ C é¢„å¤„ç†å™¨ï¼ˆCPPï¼‰ï¼Œå®ƒä½œä¸ºå¤„ç†ç¨‹åºçš„ç¬¬ä¸€æ­¥è¢«åŒ…å«åœ¨ C å’Œ C++ ä¸­ã€‚é¢„å¤„ç†å™¨æŒ‡ä»¤ä»¥æ•£åˆ—ç¬¦å·å¼€å¤´ï¼ŒåŒ…æ‹¬ <code>#include</code>ã€<code>#define</code>ã€<code>#if</code> ç­‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªç±»ä¼¼å‡½æ•°çš„ macro æ¥äº¤æ¢ä¸¤ä¸ªé¡¹ç›®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#define SWAP(a, b) { auto tmp = b; b = a; a = tmp; }
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨å®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">SWAP</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// output
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">4</span> <span class="mi">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡å‘ <code>g++</code> ä¼ é€’ <code>-E</code> æ ‡å¿—ï¼Œå¯ä»¥è·å¾—å®æ‰©å±•çš„ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ g++ -E &lt;source&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸è¿‡ï¼Œå¦‚æœä½¿ç”¨ <code>#includes</code> æŒ‡ä»¤ï¼Œç»“æœå¯èƒ½ä¼šéå¸¸æ··ä¹±ï¼Œå› ä¸ºè¯¥æŒ‡ä»¤ä¼šä»ç»™å®šæ–‡ä»¶ä¸­è°ƒå…¥ä»£ç ã€‚</p>
<p>CPP macros perform text æ›¿æ¢ï¼Œå› æ­¤ä¸Šè¿°ä»£ç ç­‰åŒäºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span> <span class="k">auto</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ SWAP å®åçš„åˆ†å·ä»ç„¶ä¿ç•™ï¼Œè¡¨ç¤ºç©ºè¯­å¥ã€‚ä¸è¿‡ï¼Œåœ¨éœ€è¦ä½¿ç”¨å•ä¸€è¯­å¥çš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ä¸€ä¸ªæ²¡æœ‰è¢« block æ‹¬ä½çš„æ¡ä»¶åˆ†æ”¯ï¼Œè¿™å°±ä¼šé€ æˆé—®é¢˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">SWAP</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;no swap&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¿å…è¿™ä¸€é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•æ˜¯å°† macro çš„æ‰©å±•ä»£ç æ”¾åœ¨ do/while ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define SWAP(a, b) do {                         \
</span></span></span><span class="line"><span class="cl"><span class="cp">    auto tmp = b;                               \
</span></span></span><span class="line"><span class="cl"><span class="cp">    b = a;                                      \
</span></span></span><span class="line"><span class="cl"><span class="cp">    a = tmp;                                    \
</span></span></span><span class="line"><span class="cl"><span class="cp">  } while (false)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨ä¸€è¡Œçš„æœ«å°¾æ·»åŠ äº†ä¸€ä¸ª <code>\</code>ï¼Œè¡¨ç¤ºä¸‹ä¸€è¡Œåº”è¢«è§†ä¸ºä¸Šä¸€è¡Œçš„ç»§ç»­ã€‚do/while å¾ªç¯åœ¨è¯­æ³•ä¸Šä»¥åˆ†å·ç»“æŸï¼Œå› æ­¤ <code>SWAP(x, y);</code> ä¸­çš„åˆ†å·åœ¨è¯­æ³•ä¸Šæ˜¯ do/while å¾ªç¯çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæ‰©å±•ä»£ç çš„è¯­æ³•æ˜¯æ­£ç¡®çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span> <span class="p">{</span> <span class="k">auto</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;no swap&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶ textual replacement å¾ˆæœ‰ç”¨ï¼Œä½†å®ƒä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå› ä¸ºè™½ç„¶å®åœ¨è¯­æ³•ä¸Šç±»ä¼¼å‡½æ•°ï¼Œä½†å®ƒä»¬çš„è¡Œä¸ºå´ä¸åƒå‡½æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä»¬ä¸æŠŠå‚æ•°ä½œä¸ºè‡ªå·±çš„å®ä½“ï¼Œä¹Ÿä¸å¼•å…¥ç‹¬ç«‹çš„ä½œç”¨åŸŸã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">SWAP</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">?</span> <span class="nl">x</span> <span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">z</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// output
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">3</span> <span class="mi">4</span> <span class="mi">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ <code>g++ -E</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¢„å¤„ç†åçš„ä»£ç ã€‚åªçœ‹ <code>main()</code> çš„è¾“å‡ºï¼Œæˆ‘ä»¬ä¼šå‘ç°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">?</span> <span class="nl">x</span> <span class="p">:</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">?</span> <span class="nl">x</span> <span class="p">:</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">z</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ äº†æ¢è¡Œç¬¦å’Œç©ºæ ¼ï¼Œä»¥ä½¿è¾“å‡ºæ›´æ˜“è¯»ï¼›è€Œé¢„å¤„ç†å™¨æœ¬èº«ä¼šå°†å®è¾“å‡ºæ”¾åœ¨ä¸€è¡Œä¸­ã€‚ç½ªé­ç¥¸é¦–æ˜¯æœ€åç”Ÿæˆçš„è¯­å¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">?</span> <span class="nl">x</span> <span class="p">:</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ C++ ä¸­ï¼Œæ¡ä»¶è¿ç®—ç¬¦ <code>? :</code> å’Œèµ‹å€¼è¿ç®—ç¬¦ <code>=</code> å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”ä»å³å‘å·¦å…³è”ï¼Œå› æ­¤è¿™ç­‰åŒäº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">?</span> <span class="nl">x</span> <span class="p">:</span> <span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äº <code>x &lt; yï¼Œ</code>è¿™é‡Œæ²¡æœ‰èµ‹å€¼ã€‚å› æ­¤ï¼Œ<code>x</code> çš„å€¼ä¿æŒä¸å˜ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡ä½¿ç”¨ macro argument æ—¶åŠ ä¸Šæ‹¬å·æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define SWAP(a, b) do {                         \
</span></span></span><span class="line"><span class="cl"><span class="cp">    auto tmp = (b);                             \
</span></span></span><span class="line"><span class="cl"><span class="cp">    (b) = (a);                                  \
</span></span></span><span class="line"><span class="cl"><span class="cp">    (a) = tmp;                                  \
</span></span></span><span class="line"><span class="cl"><span class="cp">  } while (false)
</span></span></span></code></pre></td></tr></table>
</div>
</div><center><figure>
    <img loading="lazy" src="./c&#43;&#43;associativity.png" width="60%"/> <figcaption>
            Ranking the Operator Precedence in C&#43;&#43;
        </figcaption>
</figure>
</center>
<p>ç°åœ¨ä¼šäº§ç”Ÿé¢„æœŸçš„ç»“æœï¼Œå› ä¸ºæ‹¬å·æ˜ç¡®åœ°å°†è¿™äº›æ“ä½œè”ç³»èµ·æ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">?</span> <span class="nl">x</span> <span class="p">:</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">?</span> <span class="nl">x</span> <span class="p">:</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">z</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œï¼Œç¬¬äºŒä¸ªé—®é¢˜å¹¶ä¸é‚£ä¹ˆå®¹æ˜“è§£å†³ã€‚è€ƒè™‘ä¸€ä¸‹å½“æˆ‘ä»¬å°† SWAP å®åº”ç”¨äºåä¸º tmp çš„å˜é‡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">SWAP</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// output
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">3</span> <span class="mi">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼å†æ¬¡ä½¿ç”¨ <code>g++ -E</code> æ£€æŸ¥è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ˆæ¨¡æ•°é—´éš”ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äº SWAP ä½¿ç”¨çš„ä¸´æ—¶å˜é‡ä¸å‚æ•°åŒåï¼Œå› æ­¤ä¸´æ—¶å˜é‡ä¼šæ•è·ç”Ÿæˆä»£ç ä¸­å‡ºç°çš„å‚æ•°ã€‚è¿™æ˜¯å› ä¸ºå®åªæ˜¯æ‰§è¡Œæ–‡æœ¬æ›¿æ¢ï¼Œå¹¶ä¸èƒ½ç¡®ä¿åç§°è¢«è§£æåˆ°é€‚å½“çš„ä½œç”¨åŸŸã€‚å› æ­¤ï¼Œå®å®é™…ä¸Šå¹¶ä¸ä½¿ç”¨æŒ‰åç§°è°ƒç”¨ï¼Œè€ŒæŒ‰åç§°è°ƒç”¨å¯ç¡®ä¿å‚æ•°ä¸­çš„åç§°è§£æåˆ°é€‚å½“çš„ä½œç”¨åŸŸã€‚å¯¹æ–‡æœ¬æ›¿æ¢çš„ä¾èµ–ä½¿ CPP æˆä¸ºä¸€ä¸ªä¸å«ç”Ÿçš„å®ç³»ç»Ÿã€‚å…¶ä»–ç³»ç»Ÿï¼ˆå¦‚ Scheme çš„ç³»ç»Ÿï¼‰æ˜¯å«ç”Ÿçš„ï¼Œå®ƒä»¬ä¸ºå®å¼•å…¥çš„åç§°åˆ›å»ºäº†å•ç‹¬çš„ä½œç”¨åŸŸï¼Œå¹¶ç¡®ä¿å‚æ•°ä¸ä¼šè¢«æ•è·ã€‚</p>
<h3 id="scheme-macros">Scheme Macros<a hidden class="anchor" aria-hidden="true" href="#scheme-macros">#</a></h3>
<p>ä½œä¸º R5RS Scheme è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå®ç³»ç»Ÿæ˜¯å«ç”Ÿçš„ã€‚å®ç”± define-syntaxã€let-syntax æˆ– letrec-syntax ä¸­çš„ä¸€ç§å½¢å¼å¼•å…¥ï¼Œå¹¶å°†ç»™å®šçš„åç§°ä¸å®ç»‘å®šã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ let ä½œä¸ºå®çš„å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(define-syntax let
</span></span><span class="line"><span class="cl">  (syntax-rules ()
</span></span><span class="line"><span class="cl">    ((let ((name val) ...)
</span></span><span class="line"><span class="cl">       body1 body2 ...
</span></span><span class="line"><span class="cl">     )
</span></span><span class="line"><span class="cl">     ((lambda (name ...)
</span></span><span class="line"><span class="cl">        body1 body2 ...
</span></span><span class="line"><span class="cl">      )
</span></span><span class="line"><span class="cl">      val ...
</span></span><span class="line"><span class="cl">     )
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">  )
</span></span><span class="line"><span class="cl">)
</span></span></code></pre></td></tr></table>
</div>
</div><p>syntax-rules æŒ‡å®šäº†å®è½¬æ¢çš„è§„åˆ™ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è§„åˆ™æ¨¡å¼ä¸è¾“å…¥ä¹‹é—´å¿…é¡»åŒ¹é…çš„å­—é¢å½¢å¼åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œcond å½¢å¼ä¸­çš„ else æ ‡è¯†ç¬¦ã€‚ä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å­—é¢æ„ä¹‰ã€‚syntax-rules çš„å…¶ä½™å‚æ•°æŒ‡å®šäº†è½¬æ¢ã€‚è½¬æ¢çš„ç¬¬ä¸€é¡¹æ˜¯è¾“å…¥æ¨¡å¼ï¼Œç¬¬äºŒé¡¹æ˜¯è¾“å‡ºæ¨¡å¼ã€‚<code>...</code>çš„ä½œç”¨ç±»ä¼¼äºå…‹è±å› æ˜Ÿï¼Œå°†å‰ä¸€é¡¹ä¸è¾“å…¥ä¸­å‡ºç°çš„é›¶æ¬¡æˆ–å¤šæ¬¡ç›¸åŒ¹é…ã€‚è¾“å…¥æ¨¡å¼ä¸­å‡ºç°ä½†ä¸åœ¨å­—é¢é‡åˆ—è¡¨ä¸­çš„åç§°ï¼Œé™¤äº†ä½œä¸ºå®åç§°çš„ç¬¬ä¸€é¡¹ï¼Œéƒ½æ˜¯ä¸è¾“å…¥å…ƒç´ ç›¸åŒ¹é…çš„å«ç”Ÿå˜é‡ã€‚è¿™äº›å˜é‡å¯ä»¥åœ¨è¾“å‡ºæ¨¡å¼ä¸­å¼•ç”¨ï¼Œä»¥æŒ‡å®šå¦‚ä½•æ„é€ è¾“å‡ºã€‚</p>
<p>åœ¨å…¨å±€ç¯å¢ƒä¸­è¯„ä¼°ä¸Šè¿°è¡¨è¾¾å¼æ—¶ï¼Œä¼šå°† let åç§°ä¸ä¸€ä¸ªè½¬æ¢ä¸º lambda çš„å®ç»‘å®šã€‚</p>
<p>å®ä¸»ä½“å¼•å…¥çš„æ ‡è¯†ç¬¦ä¿è¯é¿å…ä¸å…¶ä»–æ ‡è¯†ç¬¦å†²çªï¼Œè§£é‡Šå™¨é€šå¸¸ä¼šé‡å‘½åæ ‡è¯†ç¬¦ä»¥é¿å…å†²çªã€‚ä¸‹é¢æ˜¯ swap å®çš„å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(define-syntax swap
</span></span><span class="line"><span class="cl">  (syntax-rules ()
</span></span><span class="line"><span class="cl">    ((swap a b)
</span></span><span class="line"><span class="cl">     (let ((tmp b))
</span></span><span class="line"><span class="cl">       (set! b a)
</span></span><span class="line"><span class="cl">       (set! a tmp)
</span></span><span class="line"><span class="cl">     )
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">  )
</span></span><span class="line"><span class="cl">)
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™å°±å°† swap çš„ä½¿ç”¨è½¬åŒ–ä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé€šè¿‡ä¸´æ—¶å˜é‡ tmp äº¤æ¢ä¸¤ä¸ªå‚æ•°ã€‚å› æ­¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; <span class="o">(</span>define x 3<span class="o">)</span>
</span></span><span class="line"><span class="cl">&gt; <span class="o">(</span>define y 4<span class="o">)</span>
</span></span><span class="line"><span class="cl">&gt; <span class="o">(</span>swap x y<span class="o">)</span>
</span></span><span class="line"><span class="cl">&gt; x
</span></span><span class="line"><span class="cl"><span class="m">4</span>
</span></span><span class="line"><span class="cl">&gt; y
</span></span><span class="line"><span class="cl"><span class="m">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸è¿‡ï¼Œä¸ CPP å®ä¸åŒçš„æ˜¯ï¼Œswap å®å¼•å…¥çš„ tmp ä¸å…¶ä»–ä»»ä½• tmp éƒ½æ˜¯ä¸åŒçš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; <span class="o">(</span>define tmp 5<span class="o">)</span>
</span></span><span class="line"><span class="cl">&gt; <span class="o">(</span>swap x tmp<span class="o">)</span>
</span></span><span class="line"><span class="cl">&gt; x
</span></span><span class="line"><span class="cl"><span class="m">5</span>
</span></span><span class="line"><span class="cl">&gt; tmp
</span></span><span class="line"><span class="cl"><span class="m">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºå®åœ¨ Scheme ä¸­æ˜¯å«ç”Ÿçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå¾—åˆ°é¢„æœŸçš„è¡Œä¸ºã€‚</p>
<p>ä¸ºäº†æ”¯æŒå®ï¼ŒScheme è§£é‡Šå™¨çš„è¯„ä¼°è¿‡ç¨‹ä¼šåƒå¾€å¸¸ä¸€æ ·è¯„ä¼°åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ã€‚å¦‚æœè¯„ä¼°ç»“æœæ˜¯ä¸€ä¸ªå®ï¼Œé‚£ä¹ˆè§£é‡Šå™¨å°†å¯¹åˆ—è¡¨çš„å…¶ä½™éƒ¨åˆ†æ‰§è¡Œå®æ‰©å±•ï¼Œè€Œä¸ä¼šé¦–å…ˆè¯„ä¼°å‚æ•°ã€‚æ‰©å±•å¼•å…¥çš„ä»»ä½•åç§°éƒ½ä¸å…¶ä»–åç§°ç½®äºä¸åŒçš„ä½œç”¨åŸŸã€‚æ‰©å±•åï¼Œè§£é‡Šå™¨ä¼šå¯¹æ‰©å±•ç»“æœé‡å¤æ±‚å€¼è¿‡ç¨‹ï¼Œå› æ­¤ï¼Œå¦‚æœæœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ª <code>let</code> è¡¨è¾¾å¼ (å¦‚ä¸Šæ–‡ <code>swap</code> ä¸­çš„è¡¨è¾¾å¼)ï¼Œå°±ä¼šå¯¹è¯¥è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ã€‚</p>
<p>ä¸€ä¸ªå®å®šä¹‰å¯ä»¥æŒ‡å®šå¤šä¸ªæ¨¡å¼è§„åˆ™ã€‚å†åŠ ä¸Šæ‰©å±•çš„ç»“æœä¼šè¢«æ±‚å€¼ï¼Œè¿™ä½¿å¾—å®å®šä¹‰å¯ä»¥é€’å½’ï¼Œå¦‚ä¸‹é¢çš„ <code>let*</code> å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(define-syntax let*
</span></span><span class="line"><span class="cl">  (syntax-rules ()
</span></span><span class="line"><span class="cl">    ((let* ()
</span></span><span class="line"><span class="cl">       body1 body2 ...
</span></span><span class="line"><span class="cl">     )
</span></span><span class="line"><span class="cl">     (let ()
</span></span><span class="line"><span class="cl">       body1 body2 ...
</span></span><span class="line"><span class="cl">     )
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">    ((let* ((name1 val1) (name2 val2) ...)
</span></span><span class="line"><span class="cl">       body1 body2 ...
</span></span><span class="line"><span class="cl">     )
</span></span><span class="line"><span class="cl">     (let ((name1 val1))
</span></span><span class="line"><span class="cl">       (let* ((name2 val2) ...)
</span></span><span class="line"><span class="cl">         body1 body2 ...
</span></span><span class="line"><span class="cl">       )
</span></span><span class="line"><span class="cl">     )
</span></span><span class="line"><span class="cl">    )
</span></span><span class="line"><span class="cl">  )
</span></span><span class="line"><span class="cl">)
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ <code>let*</code> æ²¡æœ‰ç»‘å®šæ—¶ï¼Œæœ‰ä¸€ç§åŸºæœ¬æ¨¡å¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒç›´æ¥è½¬åŒ–ä¸ºä¸€ä¸ª <code>let</code>ã€‚å½“è‡³å°‘æœ‰ä¸€ä¸ªç»‘å®šæ—¶ï¼Œä¹Ÿæœ‰ä¸€ä¸ªé€’å½’æ¨¡å¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>let*</code> ä¼šè½¬åŒ–ä¸ºä¸€ä¸ªåµŒå¥—åœ¨ <code>let</code> ä¸­çš„æ›´ç®€å•çš„ <code>let*</code>ã€‚å®å®šä¹‰ä¸­çš„çœç•¥å· (<code>...</code>) ç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ Kleene æ˜Ÿå· (<code>*</code>)ï¼Œè¡¨ç¤ºå‰ä¸€é¡¹å¯ä»¥åŒ¹é…é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚å› æ­¤ï¼Œå…·æœ‰å•ä¸€ç»‘å®šçš„ <code>let*</code> ä¸ä¸Šè¿°ç¬¬äºŒæ¡æ¨¡å¼è§„åˆ™ç›¸åŒ¹é…ï¼Œå…¶ä¸­ (<code>name2 val2</code>) åŒ¹é…æ¬¡æ•°ä¸ºé›¶ã€‚</p>
<h3 id="cpp-macros">CPP Macros<a hidden class="anchor" aria-hidden="true" href="#cpp-macros">#</a></h3>
<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ CPP å®ã€‚å°½ç®¡å®ä¸å«ç”Ÿï¼Œä½†åœ¨æ¶‰åŠå…ƒç¼–ç¨‹çš„ä»»åŠ¡ä¸­å´éå¸¸æœ‰ç”¨ã€‚</p>
<p>CPP å…è®¸æˆ‘ä»¬ä½¿ç”¨ <code>#define</code> æ¥å®šä¹‰ä¸¤ç§ç±»å‹çš„ macroï¼Œå³ <code>object-like macro</code> å’Œ <code>function-like macro</code>ã€‚<code>object-like macro</code> æ˜¯ä¸€ç§ç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼Œç”¨ä¸€ä¸ªæ–‡æœ¬åºåˆ—æ›¿æ¢å¦ä¸€ä¸ªæ–‡æœ¬åºåˆ—ã€‚åœ¨å†å²ä¸Šï¼Œå®šä¹‰å¸¸é‡æ˜¯ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define PI 3.1415926535
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;pi = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">PI</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;tau = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">PI</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ C++ ä¸­ï¼Œæ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨ const æˆ– constexpr å®šä¹‰å¸¸é‡ã€‚</p>
<p><code>function-like macro</code> æ¥å—å‚æ•° (å¦‚ä¸Šæ–‡çš„ <code>SWAP</code>)ï¼Œå¹¶èƒ½å°†å‚æ•°æ–‡æœ¬æ›¿æ¢åˆ°æ›¿æ¢æ–‡æœ¬ä¸­çš„ç‰¹å®šä½ç½®ã€‚</p>
<p>ä½¿ç”¨ <code>function-like macro</code> çš„ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­æ˜¯å¯¹éµå¾ªç›¸åŒæ¨¡å¼çš„å¤šæ®µä»£ç è¿›è¡ŒæŠ½è±¡å®šä¹‰ã€‚è¯·çœ‹è¡¨ç¤ºå¤æ•°çš„ç±»å‹å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">Complex</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">real</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">imag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="n">Complex</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;(&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">.</span><span class="n">real</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;+&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">.</span><span class="n">imag</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;i)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡è®¾é™¤äº†ä¸Šè¿°é‡è½½çš„æµæ’å…¥æ“ä½œç¬¦ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›æ”¯æŒç®—æœ¯è¿ç®— <code>+</code>ã€<code>-</code> å’Œ <code>*</code>ã€‚è¿™äº›è¿ç®—çš„åŸºæœ¬å½¢å¼ç›¸åŒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">&lt;</span><span class="n">op</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Complex</span> <span class="n">a</span><span class="p">,</span> <span class="n">Complex</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">Complex</span><span class="p">{</span> <span class="o">&lt;</span><span class="n">expression</span> <span class="k">for</span> <span class="n">real</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">expression</span> <span class="k">for</span> <span class="n">imag</span><span class="o">&gt;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>uniform initialization syntax</code> æ¥åˆå§‹åŒ–ä¸€ä¸ªå«æœ‰å…¶æˆå‘˜å€¼çš„ <code>Complex</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª <code>function-like macro</code> æ¥æŠ½è±¡è¿™ä¸ªç»“æ„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define COMPLEX_OP(op, real_part, imag_part)    \
</span></span></span><span class="line"><span class="cl"><span class="cp">  Complex operator op(Complex a, Complex b) {   \
</span></span></span><span class="line"><span class="cl"><span class="cp">    return Complex{ real_part, imag_part };     \
</span></span></span><span class="line"><span class="cl"><span class="cp">  }
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥ <code>macro</code> çš„å‚æ•°åŒ…æ‹¬è¿ç®—ç¬¦ã€è®¡ç®—å®éƒ¨çš„è¡¨è¾¾å¼å’Œè®¡ç®—è™šéƒ¨çš„è¡¨è¾¾å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å®æ¥å®šä¹‰è¿ç®—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">COMPLEX_OP</span><span class="p">(</span><span class="o">+</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">real</span><span class="o">+</span><span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">imag</span><span class="o">+</span><span class="n">b</span><span class="p">.</span><span class="n">imag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">COMPLEX_OP</span><span class="p">(</span><span class="o">-</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">real</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">imag</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">imag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">COMPLEX_OP</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">real</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">real</span> <span class="o">-</span> <span class="n">a</span><span class="p">.</span><span class="n">imag</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">imag</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="n">a</span><span class="p">.</span><span class="n">imag</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">real</span> <span class="o">+</span> <span class="n">a</span><span class="p">.</span><span class="n">real</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">imag</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸æˆ‘ä»¬æœ€åˆçš„ <code>SWAP</code> å®ç°ä¸€æ ·ï¼Œå°¾éƒ¨çš„åˆ†å·æ˜¯å¤šä½™çš„ï¼Œä½†å´æé«˜äº†å¯è¯»æ€§ä»¥åŠä¸è¯­æ³•é«˜äº®ç¨‹åºçš„äº¤äº’æ€§ã€‚ä½¿ç”¨ <code>g++ -E</code> åœ¨é¢„å¤„ç†å™¨ä¸­è¿è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼ˆä¿®æ”¹é—´è·ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">+</span><span class="p">(</span><span class="n">Complex</span> <span class="n">a</span><span class="p">,</span> <span class="n">Complex</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">Complex</span><span class="p">{</span> <span class="n">a</span><span class="p">.</span><span class="n">real</span><span class="o">+</span><span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">imag</span><span class="o">+</span><span class="n">b</span><span class="p">.</span><span class="n">imag</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">-</span><span class="p">(</span><span class="n">Complex</span> <span class="n">a</span><span class="p">,</span> <span class="n">Complex</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">Complex</span><span class="p">{</span> <span class="n">a</span><span class="p">.</span><span class="n">real</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">imag</span><span class="o">-</span><span class="n">b</span><span class="p">.</span><span class="n">imag</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">*</span><span class="p">(</span><span class="n">Complex</span> <span class="n">a</span><span class="p">,</span> <span class="n">Complex</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">Complex</span><span class="p">{</span> <span class="n">a</span><span class="p">.</span><span class="n">real</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">real</span> <span class="o">-</span> <span class="n">a</span><span class="p">.</span><span class="n">imag</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">imag</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="n">a</span><span class="p">.</span><span class="n">imag</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">real</span> <span class="o">+</span> <span class="n">a</span><span class="p">.</span><span class="n">real</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">imag</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ <code>Complex</code> å’Œ <code>double</code> ä¹‹é—´çš„è¿ç®—ã€‚æˆ‘ä»¬å†æ¬¡å‘ç°ï¼Œè¿™ç§æ“ä½œå…·æœ‰ç‰¹å®šçš„æ¨¡å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">&lt;</span><span class="n">op</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">type1</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">type2</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="o">&lt;</span><span class="n">expr1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">op</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">expr2</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œï¼Œ<code>&lt;exprN&gt;</code> æ˜¯è½¬æ¢ä¸º <code>Complex</code> è¡¨ç¤ºçš„ç›¸åº”å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®å¯¹å…¶è¿›è¡ŒæŠ½è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define REAL_OP(op, typeA, typeB, argA, argB)   \
</span></span></span><span class="line"><span class="cl"><span class="cp">  Complex operator op(typeA a, typeB b) {       \
</span></span></span><span class="line"><span class="cl"><span class="cp">    return argA op argB;                        \
</span></span></span><span class="line"><span class="cl"><span class="cp">  }
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªå®ï¼Œå°† <code>double</code> è½¬æ¢ä¸º <code>Complex</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define CONVERT(a)                              \
</span></span></span><span class="line"><span class="cl"><span class="cp">  (Complex{ a, 0 })
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ“ä½œè¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">REAL_OP</span><span class="p">(</span><span class="o">+</span><span class="p">,</span> <span class="n">Complex</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="nf">CONVERT</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nf">REAL_OP</span><span class="p">(</span><span class="o">+</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Complex</span><span class="p">,</span> <span class="nf">CONVERT</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">REAL_OP</span><span class="p">(</span><span class="o">-</span><span class="p">,</span> <span class="n">Complex</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="nf">CONVERT</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nf">REAL_OP</span><span class="p">(</span><span class="o">-</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Complex</span><span class="p">,</span> <span class="nf">CONVERT</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">REAL_OP</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">Complex</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="nf">CONVERT</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nf">REAL_OP</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Complex</span><span class="p">,</span> <span class="nf">CONVERT</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡é¢„å¤„ç†å™¨è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">+</span><span class="p">(</span><span class="n">Complex</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">Complex</span><span class="p">{</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span> <span class="p">});</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">+</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">Complex</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">Complex</span><span class="p">{</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span> <span class="p">})</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">-</span><span class="p">(</span><span class="n">Complex</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="p">(</span><span class="n">Complex</span><span class="p">{</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span> <span class="p">});</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">-</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">Complex</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">Complex</span><span class="p">{</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span> <span class="p">})</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">*</span><span class="p">(</span><span class="n">Complex</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">Complex</span><span class="p">{</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span> <span class="p">});</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">operator</span> <span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="n">Complex</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">Complex</span><span class="p">{</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span> <span class="p">})</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span> <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ä½¿ç”¨å¤æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Complex</span> <span class="n">c1</span><span class="p">{</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="n">Complex</span> <span class="n">c2</span><span class="p">{</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">c2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">d</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">d</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>2+6i<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>4+2i<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>-11+2i<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>3.5+4i<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>2.5+4i<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>1.5+2i<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>3.5+4i<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>-2.5+-4i<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>1.5+2i<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="stringification-and-concatenation">Stringification and Concatenation<a hidden class="anchor" aria-hidden="true" href="#stringification-and-concatenation">#</a></h4>
<p>åœ¨ä½¿ç”¨å®æ—¶ï¼Œå°†å®å‚æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–å°†å…¶ä¸å…¶ä»–æ ‡è®°è¿æ¥èµ·æ¥å¯èƒ½å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªäº¤äº’å¼åº”ç”¨ç¨‹åºï¼Œè¯»å–ç”¨æˆ·çš„è¾“å…¥å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å¯¹äºå¤æ•°ï¼Œç›®æ ‡å‡½æ•°å¯èƒ½å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Complex</span> <span class="nf">Complex_conjugate</span><span class="p">(</span><span class="n">Complex</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">Complex</span><span class="p">{</span> <span class="n">c</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">.</span><span class="n">imag</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="nf">Complex_polar</span><span class="p">(</span><span class="n">Complex</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="s">&#34;(&#34;</span> <span class="o">+</span> <span class="nf">to_string</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">pow</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">imag</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;,&#34;</span> <span class="o">+</span> <span class="nf">to_string</span><span class="p">(</span><span class="nf">atan</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">imag</span> <span class="o">/</span> <span class="n">c</span><span class="p">.</span><span class="n">real</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åº”ç”¨ç¨‹åºä¼šå°†ç”¨æˆ·è¾“å…¥ä¸ä»£è¡¨æ“ä½œçš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œè°ƒç”¨ç›¸åº”çš„å‡½æ•°ï¼Œå¹¶æ‰“å°å‡ºç»“æœã€‚è¿™å°±æ˜¯å¸¸è§çš„æ¨¡å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">input</span><span class="o">&gt;</span> <span class="o">==</span> <span class="s">&#34;&lt;action&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">Complex_</span><span class="o">&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ—¢éœ€è¦åŠ¨ä½œçš„å­—ç¬¦ä¸²è¡¨ç¤ºæ³•ï¼Œä¹Ÿéœ€è¦å°† <code>Complex_</code> æ ‡è®°ä¸åŠ¨ä½œæ ‡è®°æœ¬èº«è¿æ¥èµ·æ¥çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºè¿™ç§æ¨¡å¼å®šä¹‰å¦‚ä¸‹å®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define ACTION(str, name, arg)                  \
</span></span></span><span class="line"><span class="cl"><span class="cp">  if (str == #name)                             \
</span></span></span><span class="line"><span class="cl"><span class="cp">    cout &lt;&lt; Complex_ ## name(arg) &lt;&lt; endl
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ ‡è®°å‰çš„ <code>##</code> æ˜¯å­—ç¬¦ä¸²åŒ–è¿ç®—ç¬¦ï¼Œå°†æ ‡è®°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚<code>Complex_</code> å’Œ <code>name</code> ä¹‹é—´çš„ <code>##</code> æ˜¯æ ‡è®°ç²˜è´´æ“ä½œç¬¦ï¼Œç”¨äºè¿æ¥ä¸¤è¾¹çš„æ ‡è®°ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™å¦‚ä¸‹åº”ç”¨ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">c1</span> <span class="p">{</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ACTION</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">conjugate</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ACTION</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">polar</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡é¢„å¤„ç†å™¨è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°æƒ³è¦çš„ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">Complex</span> <span class="n">c1</span> <span class="p">{</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="s">&#34;conjugate&#34;</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="nf">Complex_conjugate</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="s">&#34;polar&#34;</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="nf">Complex_polar</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="the-macro-namespace">The Macro Namespace<a hidden class="anchor" aria-hidden="true" href="#the-macro-namespace">#</a></h4>
<p>ä½¿ç”¨ CPP å®çš„ä¸€ä¸ªç¼ºé™·æ˜¯ï¼Œå®ƒä»¬ä¸åŒ…å«åœ¨ä»»ä½•ç‰¹å®šçš„å‘½åç©ºé—´ä¸­ã€‚äº‹å®ä¸Šï¼Œåªè¦å®šä¹‰äº†å®ï¼Œå®ƒå°±èƒ½æ›¿æ¢ä»»ä½•ç¬¦åˆæ¡ä»¶çš„æ ‡è¯†ç¬¦ï¼Œæ— è®ºè¯¥æ ‡è¯†ç¬¦ä½äºä½•å¤„ã€‚å› æ­¤ï¼Œå®šä¹‰ä¸€ä¸ªå®å°±ç›¸å½“äºè®©ä¸€ä¸ªç‰¹å®šçš„æ ‡è¯†ç¬¦å……å½“ä¿ç•™å…³é”®å­—ï¼Œç¨‹åºå‘˜æ— æ³•ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¸¸é‡é€šå¸¸æœ€å¥½å®šä¹‰ä¸ºå˜é‡ï¼Œé™å®šä¸º const æˆ– constexprï¼Œè€Œä¸æ˜¯ç±»ä¼¼å¯¹è±¡çš„å®çš„åŸå› ä¹‹ä¸€ã€‚</p>
<p>ä¸ºé¿å…æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ï¼Œä½¿ç”¨äº†å‡ ç§çº¦å®šã€‚</p>
<ul>
<li>ç¬¬ä¸€ç§æ˜¯åœ¨æ‰€æœ‰å®çš„å‰ç¼€åŠ ä¸Šå®šä¹‰å®çš„åº“æ‰€ç‰¹æœ‰çš„å­—ç¬¦ï¼Œä»¥é¿å…ä¸å…¶ä»–åº“å‘ç”Ÿå†²çªã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„å¤æ•°å®å¯ä»¥ç”¨ COMPLEX_ ä½œä¸ºå‰ç¼€ï¼Œä»¥é¿å…ä¸å…¶ä»–å®æˆ–æ ‡è¯†ç¬¦å†²çªã€‚</li>
<li>ç¬¬äºŒç§ç­–ç•¥æ˜¯åœ¨ä¸å†éœ€è¦å®æ—¶ï¼Œä½¿ç”¨ <code>#undef</code> é¢„å¤„ç†å™¨æŒ‡ä»¤å–æ¶ˆå¯¹å®çš„å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œåœ¨åº“ä»£ç çš„æœ«å°¾ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰å¦‚ä¸‹ä»£ç ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#undef COMPLEX_OP
</span></span></span><span class="line"><span class="cl"><span class="cp">#undef REAL_OP
</span></span></span><span class="line"><span class="cl"><span class="cp">#undef CONVERT
</span></span></span><span class="line"><span class="cl"><span class="cp">#undef ACTION
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæ ‡è¯†ç¬¦å°±å¯ä»¥åœ¨ä»¥åçš„ä»£ç ä¸­ç”¨äºå…¶ä»–ç›®çš„ã€‚</p>
<h3 id="code-generation">Code Generation<a hidden class="anchor" aria-hidden="true" href="#code-generation">#</a></h3>
<p>è™½ç„¶ macros å…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸€ç§è¯­è¨€æä¾›çš„å®è®¾æ–½ç”Ÿæˆä»£ç ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§è®¾æ–½æ— æ³•ä½¿ç”¨æˆ–ä¸è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„ç›®çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨å¤–éƒ¨ç¨‹åºä¸­ç”¨åŒä¸€ç§è¯­è¨€æˆ–å¦ä¸€ç§è¯­è¨€ç¼–å†™ä»£ç ç”Ÿæˆå™¨å¯èƒ½ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚è¿™ç§æŠ€æœ¯ä¹Ÿç§°ä¸º <strong>automatic programming</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒR5RS Scheme è§„èŒƒè¦æ±‚å®ç°æä¾› car å’Œ cdr çš„ç»„åˆï¼Œæœ€æ·±å¯è¾¾å››å±‚ã€‚ä¾‹å¦‚ï¼Œ<code>(caar x)</code> åº”ç­‰åŒäº <code>(car (car x))</code>ï¼Œ<code>(caddar x)</code> åº”ç­‰åŒäº <code>(car (cdr (cdr (car x))))</code>ã€‚é™¤äº† <code>car</code> å’Œ <code>cdr</code> æœ¬èº«å¤–ï¼Œè¿˜éœ€è¦æä¾› 28 ç§ç»„åˆï¼Œæ‰‹å·¥ç¼–å†™æ—¢ç¹çåˆå®¹æ˜“å‡ºé”™ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸‹é¢çš„ Python è„šæœ¬æ¥ç”Ÿæˆä¸€ä¸ª Scheme åº“æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">itertools</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cadrify</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;(c</span><span class="si">{0}</span><span class="s1">r </span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cadrify</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;x&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">defun</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;(define (c</span><span class="si">{0}</span><span class="s1">r x) </span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="n">cadrify</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">((</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="n">i</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">defun</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>cadrify()</code> å‡½æ•°æ˜¯ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªåºåˆ—ï¼Œå¦‚ <code>('a','d','a')</code>ï¼Œå¹¶ä½¿ç”¨ç¬¬ä¸€ä¸ªé¡¹ç›®å’Œåºåˆ—å…¶ä½™éƒ¨åˆ†çš„é€’å½’ç»“æœæ„é€ ä¸€ä¸ªè°ƒç”¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œåè€…æ˜¯ <code>(cdr (car x))</code>ï¼Œå› æ­¤ç»“æœæ˜¯ <code>(car (cdr (car x)))</code>ã€‚åŸºæœ¬æƒ…å†µæ˜¯åºåˆ—ä¸ºç©ºï¼Œåªäº§ç”Ÿ <code>x</code>ã€‚</p>
<p><code>defun()</code> å‡½æ•°æ¥æ”¶ä¸€ä¸ªåºåˆ—ï¼Œå¹¶ç”¨å®ƒä¸ºç›¸åº”çš„ç»„åˆæ„å»ºå®šä¹‰ã€‚å®ƒè°ƒç”¨ <code>cadrify()</code> æ„å»ºæ­£æ–‡ã€‚å¯¹äºåºåˆ— <code>('a','d','a')</code>ï¼Œç»“æœæ˜¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(define (cadar x) (car (cdr (car x))))
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œå¾ªç¯ç»“æŸæ—¶ä¼šäº§ç”Ÿæ¯ä¸ªé•¿åº¦çš„ <code>a</code> å’Œ <code>d</code> çš„æ‰€æœ‰ç»„åˆã€‚å®ƒä½¿ç”¨å‡½æ•°åº“ä¸­çš„ <code>itertools.product()</code> å‡½æ•°æ¥è·å¾—ä¸€ä¸ªåºåˆ—ï¼Œè¯¥åºåˆ—æ˜¯å…ƒç»„ <code>('a','d')</code> çš„ç¬¬ <code>i</code> æ¬¡å¹‚ã€‚å¯¹äºæ¯ä¸ªç»„åˆï¼Œå®ƒéƒ½ä¼šè°ƒç”¨ <code>defun()</code> ç”Ÿæˆè¯¥ç»„åˆçš„å‡½æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(define (caar x) (car (car x)))
</span></span><span class="line"><span class="cl">(define (cadr x) (car (cdr x)))
</span></span><span class="line"><span class="cl">(define (cdar x) (cdr (car x)))
</span></span><span class="line"><span class="cl">(define (cddr x) (cdr (cdr x)))
</span></span><span class="line"><span class="cl">(define (caaar x) (car (car (car x))))
</span></span><span class="line"><span class="cl">(define (caadr x) (car (car (cdr x))))
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">(define (cdddar x) (cdr (cdr (cdr (car x)))))
</span></span><span class="line"><span class="cl">(define (cddddr x) (cdr (cdr (cdr (cdr x)))))
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬å¯ä»¥å°†ç”Ÿæˆçš„ä»£ç æ”¾å…¥æ ‡å‡†åº“ä¸­ï¼Œç”± Scheme è§£é‡Šå™¨åŠ è½½ã€‚</p>
<h2 id="template-metaprogramming">Template Metaprogramming<a hidden class="anchor" aria-hidden="true" href="#template-metaprogramming">#</a></h2>
<p>Template metaprogramming æ˜¯ä¸€ç§åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆæºä»£ç çš„æŠ€æœ¯ï¼Œç„¶åå°†æºä»£ç ä¸ç¨‹åºçš„å…¶ä»–ä»£ç ä¸€èµ·ç¼–è¯‘ã€‚å®ƒé€šå¸¸æ˜¯æŒ‡åˆ©ç”¨è¯­è¨€çš„æ¨¡æ¿å®ä¾‹åŒ–è§„åˆ™è¿›è¡Œç¼–è¯‘æ—¶æ‰§è¡Œçš„ä¸€ç§å½¢å¼ã€‚Template metaprogramming åœ¨ C++ ä¸­æœ€ä¸ºå¸¸è§ï¼Œä½†ä¹Ÿæœ‰å°‘æ•°å…¶ä»–è¯­è¨€å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>C++ ä¸­æ¨¡æ¿å…ƒç¼–ç¨‹çš„å…³é”®æ˜¯ template specializationï¼Œå®ƒå…è®¸ç¼–å†™ä¸“é—¨çš„å®šä¹‰æ¥å®ä¾‹åŒ–å¸¦æœ‰ç‰¹å®šå‚æ•°çš„æ¨¡æ¿ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªåŒ…å«é™æ€å€¼åŸŸçš„ç±»æ¨¡æ¿ï¼Œå¦‚æœæ¨¡æ¿å‚æ•°ä¸º intï¼Œè¯¥å€¼åŸŸä¸º trueï¼Œå¦åˆ™ä¸º falseã€‚æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹ç¼–å†™é€šç”¨æ¨¡æ¿ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">template</span> <span class="o">&lt;</span><span class="n">class</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">is_int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰å½“å‚æ•°ä¸º int æ—¶è¯¥æ¨¡æ¿çš„ç‰¹æ®ŠåŒ–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">template</span> <span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">is_int</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç‰¹åŒ–ä¸­çš„æ¨¡æ¿å‚æ•°åˆ—è¡¨åŒ…å«éç‰¹åŒ–å‚æ•°ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œæ‰€ä»¥æ˜¯ç©ºçš„ã€‚ç„¶åï¼Œåœ¨æ¨¡æ¿åç§°ä¹‹åï¼Œæˆ‘ä»¬æä¾›äº†å®ä¾‹åŒ–çš„å…¨éƒ¨å‚æ•°é›†ï¼Œåœ¨æœ¬ä¾‹ä¸­åªæœ‰ <code>int</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬æä¾›å®ä¾‹åŒ–çš„å…¶ä½™å®šä¹‰ã€‚</p>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿æ—¶ï¼Œå¦‚æœæ¨¡æ¿å‚æ•°ä¸ç‰¹åŒ–å…¼å®¹ï¼Œç¼–è¯‘å™¨å°±ä¼šä½¿ç”¨ç‰¹åŒ–ï¼Œå¦åˆ™å°±ä¼šä½¿ç”¨é€šç”¨æ¨¡æ¿ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">is_int</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">is_int</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// output
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">0</span> <span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¨¡æ¿ç‰¹åŒ–ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™ä»¥æ¨¡æ¿å‚æ•°ä¸ºæ¡ä»¶çš„ä»£ç ã€‚ä¸é€’å½’å®ä¾‹åŒ–ç›¸ç»“åˆï¼Œè¿™ä½¿å¾—æ¨¡æ¿å®ä¾‹åŒ–å…·æœ‰å›¾çµå®Œå¤‡æ€§ã€‚æ¨¡æ¿ä¸å¯¹å¯å˜å˜é‡è¿›è¡Œç¼–ç ï¼Œå› æ­¤æ¨¡æ¿å…ƒç¼–ç¨‹å®é™…ä¸Šæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§å½¢å¼ã€‚</p>
<h4 id="pairs">Pairs<a hidden class="anchor" aria-hidden="true" href="#pairs">#</a></h4>
<p>ä¸¾ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬å®šä¹‰å¯åœ¨ç¼–è¯‘æ—¶æ“ä½œçš„ pairs å’Œ listsã€‚è¿™äº›ç»“æ„ä¸­å­˜å‚¨çš„å…ƒç´ å°†æ˜¯ä»»æ„ç±»å‹ã€‚</p>
<p>åœ¨å¼€å§‹å®šä¹‰ pairs ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ„å»ºä¸€ä¸ªæŠ¥å‘Šæœºåˆ¶ï¼Œä»¥ä¾¿åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç»“æœã€‚æˆ‘ä»¬å°†åœ¨ç¼–è¯‘å™¨ç”Ÿæˆçš„é”™è¯¯ä¿¡æ¯ä¸­åŒ…å«ç›¸å…³ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">A</span><span class="p">,</span> <span class="kt">int</span> <span class="n">I</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">report</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">static_assert</span><span class="p">(</span><span class="n">I</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#34;report&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª integer æ¨¡æ¿å‚æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»å‹å¯¹æ•°å­—è¿›è¡Œç¼–ç ã€‚åœ¨å®ä¾‹åŒ– <code>report</code> æ¨¡æ¿æ—¶ï¼Œå¦‚æœæ¨¡æ¿å‚æ•° I ä¸ºéè´Ÿï¼Œ<code>static_assert</code> ä¼šå¼•å‘é”™è¯¯ã€‚è¯·çœ‹ä¸‹é¢çš„å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">report</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">5</span><span class="o">&gt;</span> <span class="n">foo</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ŒæŒ‡å‡ºæ˜¯å“ªä¸ªå®ä¾‹å¯¼è‡´ <code>static_assert</code> å¤±è´¥ã€‚åœ¨ Clang ä¸­ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„é”™è¯¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pair.cpp:64:3: error: static_assert failed <span class="s2">&#34;report&#34;</span>
</span></span><span class="line"><span class="cl">  static_assert<span class="o">(</span>I &lt; 0, <span class="s2">&#34;report&#34;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  ^             ~~~~~
</span></span><span class="line"><span class="cl">pair.cpp:67:16: note: in instantiation of template class <span class="s1">&#39;report&lt;int, 5&gt;&#39;</span>
</span></span><span class="line"><span class="cl">      requested here
</span></span><span class="line"><span class="cl">report&lt;int, 5&gt; foo<span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ GCCï¼Œé”™è¯¯å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pair.cpp: In instantiation of &#39;struct report&lt;int, 5&gt;&#39;:
</span></span><span class="line"><span class="cl">pair.cpp:67:16:   required from here
</span></span><span class="line"><span class="cl">main.cpp:64:3: error: static assertion failed: report
</span></span><span class="line"><span class="cl">   static_assert(I &lt; 0, &#34;report&#34;);
</span></span><span class="line"><span class="cl">   ^
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸¤ä¸ªç¼–è¯‘å™¨éƒ½æŠ¥å‘Šäº†ç›¸å…³ä¿¡æ¯ï¼Œå³æŠ¥å‘Šæ¨¡æ¿çš„å‚æ•°æ˜¯ int å’Œ 5ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ <code>pair</code> æ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">First</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Second</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">pair</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">car</span> <span class="o">=</span> <span class="n">First</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">cdr</span> <span class="o">=</span> <span class="n">Second</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ template ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ç±»å‹åˆ«å <code>car</code> å’Œ <code>cdr</code>ï¼Œç”¨äºæŒ‡ä»£é…å¯¹çš„ç¬¬ä¸€é¡¹å’Œç¬¬äºŒé¡¹ã€‚å› æ­¤ï¼Œ<code>pair&lt;int, double&gt;::car</code> æ˜¯ <code>int</code> çš„åˆ«åï¼Œè€Œ <code>pair&lt;int, double&gt;::cdr</code> æ˜¯ <code>double</code> çš„åˆ«åã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ç±»å‹åˆ«åï¼Œä»¥ä¾¿ä»æ•°æ®å¯¹ä¸­æå–ç¬¬ä¸€é¡¹å’Œç¬¬äºŒé¡¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Pair</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">car_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Pair</span><span class="o">::</span><span class="n">car</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Pair</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">cdr_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Pair</span><span class="o">::</span><span class="n">cdr</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>Pair::car</code> å’Œ <code>Pair::cdr</code> ä¹‹å‰éœ€è¦ä½¿ç”¨ <code>typename</code> å…³é”®å­—ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åµŒå¥—ç±»å‹ï¼Œå…¶å¤–å±‚ç±»å‹ä¾èµ–äºæ¨¡æ¿å‚æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒC++ æ— æ³•ç¡®å®šæˆ‘ä»¬å‘½åçš„æ˜¯ä¸€ä¸ªç±»å‹è€Œä¸æ˜¯ä¸€ä¸ªå€¼ï¼Œå› æ­¤ <code>typename</code> å…³é”®å­—æ˜ç¡®è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç±»å‹ã€‚ä½¿ç”¨ä¸Šè¿°åˆ«åï¼Œ<code>car_t&lt;pair&lt;int, double&gt;&gt;</code> æ˜¯ <code>int</code> çš„åˆ«åï¼Œè€Œ <code>cdr_t&lt;pair&lt;int, double&gt;&gt;</code> æ˜¯ <code>double</code> çš„åˆ«åã€‚</p>
<p>ä¸ºäº†è¡¨ç¤ºé€’å½’åˆ—è¡¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç©ºåˆ—è¡¨çš„è¡¨ç¤ºæ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¨¡æ¿æ¥åˆ¤æ–­ä¸€ä¸ªåˆ—è¡¨æ˜¯å¦ä¸ºç©ºï¼Œè¿™ä¸ªåˆ—è¡¨å¯ä»¥ç”¨ç©ºåˆ—è¡¨ <code>nil</code> æˆ–ä»¥ <code>nil</code> ç»“å°¾çš„å¯¹åºåˆ—æ¥è¡¨ç¤ºã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªé€šç”¨æ¨¡æ¿ï¼Œç„¶åé’ˆå¯¹ä»¥ nil ä½œä¸ºå‚æ•°çš„æƒ…å†µå®šä¹‰äº†ä¸€ä¸ªç‰¹æ®ŠåŒ–æ¨¡æ¿ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">List</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">is_empty</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">is_empty</span><span class="o">&lt;</span><span class="n">nil</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨ <code>value</code>ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ª <code>compile-time constant</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è®¾ç½®ä¸º <code>static</code> å’Œ <code>const</code>ï¼Œå¹¶ä½¿ç”¨ç¼–è¯‘æ—¶å¸¸é‡å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨ C++14 ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰å…¨å±€å˜é‡æ¨¡æ¿ï¼ˆglobal variable templatesï¼‰æ¥ç¼–ç  list çš„é•¿åº¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">List</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">bool</span> <span class="n">is_empty_v</span> <span class="o">=</span> <span class="n">is_empty</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>is_empty_v&lt;nil&gt;</code> çš„å€¼ä¸º trueï¼Œè€Œ <code>is_empty&lt;pair&lt;int, nil&gt;&gt;</code> çš„å€¼ä¸º falseã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šåˆ—è¡¨æ˜¯å¦ä¸ºç©ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">nil</span><span class="o">&gt;&gt;&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">nil</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">z</span> <span class="o">=</span> <span class="n">nil</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">report</span><span class="o">&lt;</span><span class="n">x</span><span class="p">,</span> <span class="n">is_empty_v</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&gt;&gt;</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">report</span><span class="o">&lt;</span><span class="n">y</span><span class="p">,</span> <span class="n">is_empty_v</span><span class="o">&lt;</span><span class="n">y</span><span class="o">&gt;&gt;</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">report</span><span class="o">&lt;</span><span class="n">z</span><span class="p">,</span> <span class="n">is_empty_v</span><span class="o">&lt;</span><span class="n">z</span><span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºåˆ—è¡¨å¼•å…¥äº†ç±»å‹åˆ«åï¼Œä½œä¸ºç¼–è¯‘æ—¶ä¸å¯å˜çš„å˜é‡ã€‚ç„¶åï¼Œæˆ‘ä»¬ç”¨ç±»å‹å’Œæ˜¯å¦ä¸ºç©ºå®ä¾‹åŒ–æŠ¥å‘Šã€‚è¿™æ ·ï¼ŒGCC ä¼šç»™å‡ºä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl">pair.cpp: In instantiation of <span class="s1">&#39;struct report&lt;pair&lt;char, pair&lt;int,
</span></span></span><span class="line"><span class="cl"><span class="s1">  pair&lt;double, nil&gt; &gt; &gt;, 0&gt;&#39;</span>:
</span></span><span class="line"><span class="cl">pair.cpp:82:28:   required from here
</span></span><span class="line"><span class="cl">pair.cpp:73:3: error: static assertion failed: report
</span></span><span class="line"><span class="cl">   static_assert<span class="o">(</span>I &lt; 0, <span class="s2">&#34;report&#34;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   ^~~~~~~~~~~~~
</span></span><span class="line"><span class="cl">pair.cpp: In instantiation of <span class="s1">&#39;struct report&lt;pair&lt;float, pair&lt;bool,
</span></span></span><span class="line"><span class="cl"><span class="s1">  nil&gt; &gt;, 0&gt;&#39;</span>:
</span></span><span class="line"><span class="cl">pair.cpp:83:28:   required from here
</span></span><span class="line"><span class="cl">pair.cpp:73:3: error: static assertion failed: report
</span></span><span class="line"><span class="cl">pair.cpp: In instantiation of <span class="s1">&#39;struct report&lt;nil, 1&gt;&#39;</span>:
</span></span><span class="line"><span class="cl">pair.cpp:84:28:   required from here
</span></span><span class="line"><span class="cl">pair.cpp:73:3: error: static assertion failed: report
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ£€æŸ¥æŠ¥å‘Šçš„æ•´æ•°å‚æ•°ï¼Œæˆ‘ä»¬ä¼šå‘ç°åˆ—è¡¨ <code>pair&lt;charã€pair&lt;intã€pair&lt;doubleã€nil&gt;&gt;</code> å’Œ <code>pair&lt;floatã€pair&lt;boolã€nil&gt;&gt;</code> ä¸æ˜¯ç©ºçš„ï¼Œä½†åˆ—è¡¨ <code>nil</code> æ˜¯ç©ºçš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€’å½’è®¡ç®—åˆ—è¡¨çš„é•¿åº¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">List</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">length</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">length</span><span class="o">&lt;</span><span class="n">cdr_t</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;&gt;::</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">length</span><span class="o">&lt;</span><span class="n">nil</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">List</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">int</span> <span class="n">length_v</span> <span class="o">=</span> <span class="n">length</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>length</code> ç»“æ„é€’å½’å®ä¾‹åŒ–çš„å€¼ã€‚ç”±äº <code>value</code> æ˜¯é€šè¿‡ç”±ç¼–è¯‘æ—¶å¸¸é‡ä¹‹é—´çš„è¿ç®—ç»„æˆçš„è¡¨è¾¾å¼åˆå§‹åŒ–çš„ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å¸¸é‡ã€‚ä¸ <code>is_empty_v</code> ä¸€æ ·ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå˜é‡æ¨¡æ¿ <code>length_v</code> æ¥å¯¹ç»“æœè¿›è¡Œç¼–ç ã€‚æˆ‘ä»¬å¯ä»¥è®¡ç®—å¹¶æŠ¥å‘Š <code>x</code> ç±»å‹åˆ«åçš„é•¿åº¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">report</span><span class="o">&lt;</span><span class="n">x</span><span class="p">,</span> <span class="n">length_v</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&gt;&gt;</span> <span class="n">d</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŠ¥å‘Šçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»»æ„çš„ï¼Œå› ä¸ºæˆ‘ä»¬åªå…³å¿ƒç¬¬äºŒä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªä¼ é€’ x æœ¬èº«ã€‚æˆ‘ä»¬å¾—åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl">pair.cpp: In instantiation of <span class="s1">&#39;struct report&lt;pair&lt;char, pair&lt;int,
</span></span></span><span class="line"><span class="cl"><span class="s1">  pair&lt;double, nil&gt; &gt; &gt;, 3&gt;&#39;</span>:
</span></span><span class="line"><span class="cl">pair.cpp:85:26:   required from here
</span></span><span class="line"><span class="cl">pair.cpp:73:3: error: static assertion failed: report
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç›¸å…³ä¿¡æ¯æ˜¯é•¿åº¦ä¸º 3ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰æ›´å¤æ‚çš„åˆ—è¡¨æ“ä½œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ—è¡¨å€’è½¬å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">List</span><span class="p">,</span> <span class="k">class</span> <span class="nc">SoFar</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">reverse_helper</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">type</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">typename</span> <span class="n">reverse_helper</span><span class="o">&lt;</span><span class="n">cdr_t</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">pair</span><span class="o">&lt;</span><span class="n">car_t</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">SoFar</span><span class="o">&gt;&gt;::</span><span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">SoFar</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">reverse_helper</span><span class="o">&lt;</span><span class="n">nil</span><span class="p">,</span> <span class="n">SoFar</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">using</span> <span class="n">type</span> <span class="o">=</span> <span class="n">SoFar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">List</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">reverse_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">reverse_helper</span><span class="o">&lt;</span><span class="n">List</span><span class="p">,</span> <span class="n">nil</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè¾…åŠ©æ¨¡æ¿æ¥æ‰§è¡Œåè½¬ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ¨¡æ¿å‚æ•°æ˜¯å‰©ä½™åˆ—è¡¨ï¼Œç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°æ˜¯åˆ°ç›®å‰ä¸ºæ­¢çš„åè½¬åˆ—è¡¨ã€‚åœ¨æ¯ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬ä»¥ <code>pair&lt;car_t&lt;List&gt;, SoFar&gt;</code> çš„å½¢å¼è®¡ç®—æ–°çš„éƒ¨åˆ†ç»“æœï¼Œå°†å‰©ä½™åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé¡¹ç›®æ·»åŠ åˆ°å‰ä¸€ä¸ªéƒ¨åˆ†ç»“æœçš„å‰é¢ã€‚ç„¶å <code>cdr_t&lt;List&gt;</code> æ˜¯é™¤å»ç¬¬ä¸€ä¸ªé¡¹ç›®çš„å‰©ä½™åˆ—è¡¨ã€‚</p>
<p>é€’å½’çš„åŸºæœ¬æƒ…å†µæ˜¯å‰©ä½™åˆ—è¡¨ä¸º <code>nil</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€ç»ˆç»“æœä¸éƒ¨åˆ†ç»“æœç›¸åŒã€‚æˆ‘ä»¬ä½¿ç”¨éƒ¨åˆ†ç±»æ¨¡æ¿ç‰¹åŒ–æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå®ƒå…è®¸æˆ‘ä»¬åªç‰¹åŒ–ç±»æ¨¡æ¿çš„éƒ¨åˆ†å‚æ•°ã€‚åœ¨ <code>reverse_helper</code> ä¸­ï¼Œæˆ‘ä»¬å¯¹ç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œäº†ç‰¹æ®ŠåŒ–ï¼Œè¿™æ ·ï¼Œä»»ä½•ç¬¬ä¸€ä¸ªå‚æ•°ä¸º <code>nil</code> çš„ <code>reverse_helper</code> å®ä¾‹éƒ½å°†ä½¿ç”¨ç‰¹æ®ŠåŒ–ã€‚ç‰¹åŒ–ä¿ç•™äº†ä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œè¯¥å‚æ•°åŒ…å«åœ¨å‚æ•°åˆ—è¡¨ä¸­ã€‚å®Œæ•´çš„å‚æ•°åˆ—è¡¨ä¼šå‡ºç°åœ¨æ¨¡æ¿åç§°ä¹‹åï¼ŒåŒ…æ‹¬ç‰¹åŒ–å’Œæœªç‰¹åŒ–çš„å‚æ•°ã€‚</p>
<h2 id="resources">RESOURCES<a hidden class="anchor" aria-hidden="true" href="#resources">#</a></h2>
<ul>
<li><a href="https://eecs390.github.io/notes/metaprogramming.html">https://eecs390.github.io/notes/metaprogramming.html</a></li>
<li><a href="http://philo.top/2021/03/14/metaprogramming/">http://philo.top/2021/03/14/metaprogramming/</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://WFUing.github.io/tags/metaprogramming/">metaprogramming</a></li>
      <li><a href="https://WFUing.github.io/tags/language/">language</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://WFUing.github.io/post/tech/architecture/serverless/serverless-concept-models/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Serverless Concept Models</span>
  </a>
  <a class="next" href="https://WFUing.github.io/post/tech/architecture/iot/state-machine/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>State Machine</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share meta-programming on twitter"
        href="https://twitter.com/intent/tweet/?text=meta-programming&amp;url=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2flanguage%2fmetaprogramming%2f&amp;hashtags=metaprogramming%2clanguage">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share meta-programming on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2flanguage%2fmetaprogramming%2f&amp;title=meta-programming&amp;summary=meta-programming&amp;source=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2flanguage%2fmetaprogramming%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share meta-programming on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2flanguage%2fmetaprogramming%2f&title=meta-programming">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share meta-programming on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2flanguage%2fmetaprogramming%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share meta-programming on whatsapp"
        href="https://api.whatsapp.com/send?text=meta-programming%20-%20https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2flanguage%2fmetaprogramming%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share meta-programming on telegram"
        href="https://telegram.me/share/url?text=meta-programming&amp;url=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2flanguage%2fmetaprogramming%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share meta-programming on ycombinator"
        href="https://news.ycombinator.com/submitlink?t=meta-programming&u=https%3a%2f%2fWFUing.github.io%2fpost%2ftech%2flanguage%2fmetaprogramming%2f">
        <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
            <path
                d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
        </svg>
    </a>
</div>

  </footer>
<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">ğŸ’¬è¯„è®º</span>
        <hr />
    </div>
    <div id="tcomment"></div>
    <script src="https://cdn.staticfile.org/twikoo/1.4.11/twikoo.all.min.js"></script>
    <script>
        twikoo.init({
            envId: "https://twikoo-api-three-gamma.vercel.app/",  
            el: "#tcomment",
            lang: 'zh-CN',
            region: 'ap-guangzhou',  
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        });
    </script>
</div>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://WFUing.github.io/">Waiting For You</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
